<script src="../../../e2e/tests/cloud_application_test.ts"></script>
<div *ngIf="errorMessage != null">
  An Error has occurred. {{errorMessage}}
</div>

<div *ngIf="!isLoaded && errorMessage == null" class="loader"></div>


<div class="animated fadeIn" *ngIf="isLoaded">
  <div class="row">

    <div class="col-12"
         *ngIf="project && !project_application?.hasTerminatedStatus()
         && !project_application?.hasDeclinedStatus()">


      <div class="card" style=" ">
        <div class="card-header">
          <h3>
            <a *ngIf="project?.OpenStackProject" href="https://cloud.denbi.de/openstack/" target="_blank"
               style="font-size: 2em"
               class="project-openstack_plain_white_redbg"
               data-toggle="tooltip"
               title="This is an Openstack project"
            >
              <a class="path1"></a>
              <a class="path2"></a>
            </a>
            <a *ngIf="!project?.OpenStackProject" href="https://cloud.denbi.de/simplevm/" target="_blank"
               style="font-size: 2em"
               class="project-simpleVM_Logo_bluebg"
               data-toggle="tooltip"
               title="This is a Simple VM project">
              <a class="path1"></a>
              <a class="path2"></a>
              <a class="path3"></a>
              <a class="path4"></a>
              <a class="path5"></a>
            </a>
            {{project?.Name}}
          </h3>
        </div>
        <div class="card-body " >
          <div class="rTable" >
            <div class="rTableRow">
              <div class="rTableHead col-2">Project Name</div>
              <div class="rTableHead col-1">Description</div>
              <div class="rTableHead col-1">Date created (d/m/y)</div>
              <div class="rTableHead col-1">Expiration Date (d/m/y)</div>
              <div class="rTableHead col-1">Days running</div>
              <div class="rTableHead col-2" *ngIf="is_vo_admin">Credits Used</div>
              <div class="rTableHead col-1">Lifetime in Days</div>
              <div class="rTableHead col-3">Facility</div>
            </div>


            <div class="rTableRow">
              <!--[ngStyle]="{'color':lifeTimeReached(project?.LifetimeDays,project?.DaysRunning)}"-->
              <div class="rTableCell col-2">{{ project?.Name }}
              </div>

              <div class="rTableCell col-1">
                <button class="btn btn-info"
                        (click)="infoModal.hide();descriptionModal.show();">Show
                  Description
                </button>
              </div>

              <div class="rTableCell col-1">{{ project?.DateCreated }}</div>
              <div class="rTableCell col-1">{{project?.DateEnd}}</div>
              <div class="rTableCell col-1">{{ project?.DaysRunning }}</div>
              <div class="rTableCell col-2" *ngIf="is_vo_admin">{{current_credits}}/{{project?.ApprovedCredits}}</div>
              <div class="rTableCell col-1">{{project?.LifetimeDays}}</div>

              <div class="rTableCell col-3">
                <div class="rTableRowNoBorder">
                  <div class="rTableHeadNoBorder">
                    Name:
                  </div>
                   <div class="rTableCellNoBorder">
                   {{project?.ComputeCenter?.Name}}
                  </div>
                </div>

                <div class="rTableRowNoBorder" *ngIf="project?.OpenStackProject">
                  <div class="rTableHeadNoBorder">
                    Login:
                  </div>
                   <div class="rTableCellNoBorder">
                   <a
                  target="_blank"
                  href="{{project?.ComputeCenter?.Login}}">
                    {{project?.ComputeCenter?.Login}}</a>
                  </div>
                </div>
                <div class="rTableRowNoBorder">
                  <div class="rTableHeadNoBorder">
                    Support:
                  </div>
                   <div class="rTableCellNoBorder">
                   <ul>
                    <li *ngFor="let sup of project?.ComputeCenter?.Support ">
                      <a href="mailto:{{sup}}">{{sup}}</a></li>
                  </ul>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--/.col-->
  </div>

  <div class="row" *ngIf="project_application && (project?.UserIsPi ||project?.UserIsAdmin  || !project)">
    <div class="col">
      <div class="card" style="height: calc(100% - 1.5rem);;">
        <div class="card-header">
          <i class="fa fa-align-justify"></i> Actions
        </div>
        <div class="card-body">
          <div class="row">
            <div class="btn-group col-12">
              <button
                id="remove_application_button"
                *ngIf="project_application?.hasSubmittedStatus()
                || project_application?.hasDeclinedStatus()"
                (click)="deleteModal.show();"
                type="button" style="margin-bottom:5px;"
                class="btn btn-danger">
                Remove Application
              </button>
              <button id="show_credits_extension_modal"
                      *ngIf="!project_application?.hasCreditsRequestedStatus() &&(project_application?.hasApprovedStatus()
                      || project_application?.hasModificationDeclinedStatus() && is_vo_admin )"
                      (click)="newFlavors= {};initExampleFlavors();creditsExtensionModal.show()"
                      class="btn btn-success"
                      type="button" style="margin-bottom:5px;margin-right:5px">
                Request More Credits
              </button>
              <button id="show_extension_modal"
                      *ngIf="project_application?.hasApprovedStatus() &&
                       (!project_application?.hasModificationRequestedStatus()
                       ||!project_application?.hasExtensionRequestedStatus())"
                      (click)="newFlavors= {};selected_ontology_terms=[];doiQuestionModal.show();"
                      class="btn btn-warning" type="button" style="margin-bottom:5px;margin-right:5px;">
                <span *ngIf="!project_application?.hasModificationRequestedStatus()
                 && !project_application?.hasExtensionRequestedStatus()">Request Extension/Modification</span>
                <span *ngIf="project_application?.hasModificationRequestedStatus()
                 && !project_application?.hasExtensionRequestedStatus()">Request Extension</span>
                <span *ngIf="!project_application?.hasModificationRequestedStatus()
                 && project_application?.hasExtensionRequestedStatus()">Request Modification</span>
              </button>
              <button id="show_termination_modal"
                      *ngIf="project_application?.hasApprovedStatus()
                      || project_application?.hasModificationDeclinedStatus()"
                      (click)="terminateModal.show()"
                      class="btn btn-danger"
                      type="button" style="margin-bottom:5px;">
                Request Termination
              </button>

            </div>
          </div>
          <div class="row">
            <div class="btn-group col-12">
              <button id="show_information_btn" (click)="informationModal.show();getFacilityProject();"
                    type="button" class="btn btn-info"  style="margin-top:5px;">
                <i class="fa fa-info-circle"></i>&nbsp;
                <span>Show Information</span>
              </button>
            </div>
          </div>
          <div class="row" style="margin-top:5px;">
            <div class="col" *ngIf="project_application?.hasModificationRequestedStatus()">
              <span class="badge badge-warning">Resource Modification requested</span>
            </div>
            <div class="col" *ngIf="project_application?.hasExtensionRequestedStatus()">
              <span class="badge badge-warning">Lifetime Extension requested</span>
            </div>
            <div class="col" *ngIf="project_application?.hasCreditsRequestedStatus()">
              <span class="badge badge-warning">Extra Credits requested</span>
            </div>
          </div>
          <div class="row" style="margin-top:5px;">
            <div class="col" *ngIf="project_application?.hasCreditsDeclinedStatus()">
              <span class="badge badge-danger">Extra Credits declined</span>
            </div>
            <div class="col" *ngIf="project_application?.hasExtensionDeclinedStatus()">
              <span class="badge badge-danger">Lifetime Extension declined</span>
            </div>
            <div class="col" *ngIf="project_application?.hasModificationDeclinedStatus()">
              <span class="badge badge-danger">Resource Modification declined</span>
            </div>
          </div>


          <div class="alert alert-info" style="margin-top:15px;"
               *ngIf="project_application?.hasApprovedStatus()">
            <p>You can find more information about modification requests
              <a href="https://cloud.denbi.de/wiki/portal/modification/" target="_blank">here</a>.</p>
            <p *ngIf="is_vo_admin">Information about credits are coming soon.</p>
          </div>

        </div>

      </div>
    </div>

    <div class="col"
         *ngIf="project && (project?.UserIsPi ||project?.UserIsAdmin)
         && !project_application?.hasTerminatedStatus()
         && !project_application?.hasDeclinedStatus()">

      <div class="card" style=" ">
        <div class="card-header">
          <i class="fa fa-align-justify"></i>
          <a href="https://cloud.denbi.de/wiki/citation_and_publication/#publications"
             target="_blank">Digital object identifier (DOI)</a>
        </div>


        <div class="card-body">
          <div class="table-responsive">
            <table class="table ">

              <tbody>
              <ng-container
                *ngFor="let doi of dois">
                <tr>
                  <td><a target="_blank" [href]="'https://doi.org/' + doi.identifier">{{doi.identifier}}</a></td>

                  <td>
                    <button
                      class="btn btn-danger" type="button" (click)="deleteDoi(doi);">

                      <i class="fa fa-trash"></i>&nbsp;
                    </button>
                  </td>

                </tr>
              </ng-container>

              <tr>
                <td><input style="width: 100%" type="text" required placeholder="e.g. 10.1000/182"
                           pattern="10.\d{4,9}\/[-._;()\/:a-zA-Z0-9]+" [(ngModel)]="newDoi" #doiInput></td>

                <td>
                  <button id="add_doi_btn"
                          (click)="addDoi();"
                          [disabled]="!doiInput.validity.valid"
                          type="button"
                          class="btn btn-success"><i class="fa fa-plus"></i>&nbsp;
                  </button>
                </td>

              </tr>
              </tbody>
            </table>

          </div>
          <div class="alert alert-info">
            <p>Please note that the publications entered on this page are listed publicly on
              <a href="https://cloud.denbi.de/publications" target="_blank">this page on our website</a>.
              We kindly ask you to list your publications which have been created
              during your work in the de.NBI Cloud and/or this project. </p>
          </div>
        </div>
      </div>

    </div>

  </div>
  <div class="row">
    <div class="col"
         *ngIf="project && (project_application?.hasApprovedStatus()
         || project_application?.hasModificationRequestedStatus()
         || project_application?.hasModificationDeclinedStatus()
         )">

      <div class="card" style=" ">
        <div class="card-header">
          <i class="fa fa-align-justify"></i>Members of the Project {{ project?.Name }}
        </div>

        <div class="card-body">
          <div class="btn-group col-12">
            <button id="add_member_btn_modal"
                    (click)="setAddUserInvitationLink(); addUserModal.show();"

                    type="button" style="margin-bottom:5px;margin-right:5px"
                    class="btn btn-success"><i class="fa fa-plus"></i>&nbsp; Add Member
            </button>

            <button
              type="button" style="margin-bottom:5px;margin-right:5px"
              (click)="applicationModal.show();getUserProjectApplications();"
              class="btn btn-info"><i class="fa fa-list-alt"></i>&nbsp;
              Member Applications
            </button>

            <button (click)="removeCheckedMembers(project_application?.project_application_perun_id)" type="button" style="margin-bottom:5px;"
                    [disabled]="checked_member_list.length <= 0 || remove_members_clicked" class="btn btn-danger"><i
              class="fa fa-trash"></i>&nbsp;Remove
              Members
            </button>

          </div>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
              <tr>
                <th><input type="checkbox" id="selectAll" name="selectAll"
                           (change)="setAllMembersChecked();"
                           [checked]="allSet">
                </th>
                <th>User ID</th>
                <th>Member ID</th>
                <th>Full Name</th>
                <th>Actions</th>

              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let member of project_members" [ngStyle]="{'color':isPi(member)}">
                <td><input *ngIf="userinfo?.MemberId != member.MemberId" type="checkbox" id="{{member.Id}}"
                           name="{{member.Id}}"
                           [checked]="isMemberChecked(member.MemberId)" (change)="checkUnCheckMember(member.MemberId);">
                </td>
                <td>

                  {{ member.Id }}</td>
                <td>{{ member.MemberId }}</td>
                <td>{{ member.Username }}</td>
                <td>
                  <div class="btn-group-vertical" role="group" style="width:100%;">
                    <button *ngIf="!member.IsPi" (click)="promoteAdmin( project?.Id,member.Id,member.Username);
                                                notificationModal.show();
                                               " class="btn btn-secondary" type="button" style="margin: 2px">
                      <i class="fa fa-plus-circle"></i>&nbsp; Set Admin status
                    </button>
                    <button *ngIf="member.IsPi &&  userinfo?.MemberId != member.MemberId" (click)="removeAdmin( project?.Id,member.Id,member.Username);
                                                notificationModal.show();
                                               " class="btn btn-secondary" type="button" style="margin: 2px">
                      <i class="fa fa-minus-circle"></i>&nbsp; Remove Admin status
                    </button>
                    <button [id]="'remove_member_' + member.Username" *ngIf=" userinfo?.MemberId != member.MemberId"
                            (click)="removeMember(project?.Id,member.MemberId,member.Username);
                                                notificationModal.show();
                                               " class="btn btn-danger" type="button" style="margin: 2px">

                      <i class="fa fa-trash"></i>&nbsp; Remove member
                    </button>
                  </div>

                </td>
              </tr>

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

</div>
  <div class="col"
       *ngIf="is_vo_admin && (project_application?.hasApprovedStatus()
           || project_application?.hasModificationRequestedStatus()
           || project_application?.hasModificationDeclinedStatus())">
    <div class="card" style=" ">
      <div class="card-header">
        <i class="fa fa-align-justify"></i> Credit Usage history of {{project?.Name }}
      </div>
      <div class="card-body">
        <canvas #creditsChart
                id="creditsChart" width="400" height="400"
        >
        </canvas>
      </div>
      </div>
    </div>

<div bsModal #addUserModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="Label"
     aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content ">
      <div class="modal-header">
        <h4 class="modal-title">Add member to the project {{project?.Name }}
        </h4>
        <button type="button" class="close" style="cursor:pointer" (click)="addUserModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <div class="container-fluid">
          <div class="row">
            <p style=" margin-bottom: 15px;">Search and add a user to your project by providing at least
              four characters of his name:</p>
          </div>
          <div class="row">
            <div class="col-md-8">
              <input style="width: 100%" placeholder="" id="add_member_input" #searchString>
            </div>
            <div class="col-md-4">
              <button type="button" class="btn btn-primary" id="search_member_btn"
                      (click)="filterMembers(searchString.value )"><i
                class="fa fa-search"></i> Search Member
              </button>
            </div>
          </div>
          <br>
          <div class="row">
            <div class="col-md-12">
              <strong>Please note</strong> that if you can not find the user, he is not registered for a
              a de.NBI Cloud account. In that case you can invite him by sending him the following link:
              <br>
              <br>
              <ul style="list-style-type:none;">

                <li>
                  <pre [hidden]="showLink">{{invitation_link}}</pre>
                  <div class="btn-group-vertical">
                    <button class="btn btn-primary" style="margin-bottom: 5px" (click)="showLink = !showLink">
                      <span [hidden]="!showLink">Show</span>
                      <span [hidden]="showLink">Hide</span>
                      link
                    </button>
                    <button class="btn btn-success" (click)="copyToClipboard(invitation_link)">Copy link
                    </button>
                  </div>
                </li>
              </ul>
              <br>
              After the user registered for ELIXIR/de.NBI and applied for your group, you can approve his application.
              Read more about the process <a target="_blank" href="{{WIKI_GROUP_INVITATIONS}}">here</a>.
            </div>
          </div>

          <div class="table-responsive">
            <table *ngIf="filteredMembers!==null" class="table table-bordered table-striped table-sm">
              <thead>

              <th></th>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Email</th>
              </thead>
              <tbody *ngFor="  let member of filteredMembers">
              <td>
                <button style="padding: 5px; margin: 5px"
                        (click)="addMember(project?.Id,member['member_id'],member['firstName'],member['lastName']);filteredMembers=null; addUserModal.hide();notificationModal.show();"
                        class="btn btn-success" id="add_member_btn"><i class="fa fa-plus"></i> Add Member
                </button>
                <button style="padding: 5px; margin: 5px"
                        (click)="addAdmin(project?.Id,member['member_id'],member['user_id'],member['firstName'],member['lastName']);filteredMembers=null; addUserModal.hide();notificationModal.show();"
                        class="btn btn-primary"><i class="fa fa-plus"></i> Add Admin
                </button>
              </td>
              <td>{{member['firstName']}}</td>
              <td>{{member['lastName']}}</td>
              <td>{{member['mail']}}</td>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <!--  <button type="button" (click)="addUserModal.hide();
                                          notificationModal.show();
                                          addMember(addUserModalProjectID, addMemberID.value)" class="btn btn-success"><i class="fa fa-dot-circle-o"></i>
              Add User
          </button> -->
        <button type="button" (click)="filteredMembers=null; addUserModal.hide();"
                type="reset"
                class="btn  btn-danger"><i class="fa fa-ban"></i> Close
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
  <div bsModal #terminateModal="bs-modal" class="modal fade" tabindex="-1"
       role="dialog" aria-labelledby="Label"
       aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Terminate Project</h4>
          <button type="button" class="close" style="cursor:pointer"
                  (click)="terminateModal.hide()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

          <div class="alert alert-warning" role="alert">
            Are you sure you want to terminate this project?
          </div>
          <app-project-os-details *ngIf="project" [project]="project"></app-project-os-details>
          <div class="alert alert-danger" role="alert">
            All used resources will be scheduled for deletion and then irreversibly terminated!

          </div>
          <div class="alert  form-check"
               [ngClass]="{'alert-danger':!terminate_confirmation_given,'alert-success':terminate_confirmation_given}"
          >

            <label class="form-check-label">
              <input class="form-check-input"
                     name="terminate_confirmation_given"
                     type="checkbox"
                     id="terminate_confirmation_given"
                     [checked]="terminate_confirmation_given"
                     [(ngModel)]="terminate_confirmation_given"

              >
              I hereby confirm that the project shall be terminated.
            </label>
          </div>


        </div>
        <div class="modal-footer">
          <button class="btn  btn-success col-md-4" id="terminate_project_btn"
                  [disabled]="!terminate_confirmation_given"
                  (click)="terminateModal.hide();notificationModal.show();requestProjectTermination();">
            Yes
          </button>
          <button class="btn  btn-danger col-md-4" type="reset"
                  (click)="terminateModal.hide()">Cancel
          </button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->


  <div bsModal #applicationModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Applications for {{project?.Name}}</h4>
          <button type="button" class="close" style="cursor: pointer;" (click)="applicationModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <div *ngIf="!loaded" style="text-align: center"><i class="fa fa-spinner fa-spin"
                                                           style="font-size:100px; margin: auto;margin-left: auto;margin-right: auto"></i>
        </div>

        <div *ngIf="loaded" class="table-responsive">
          <table class="table table-bordered table-striped table-sm">
            <thead>

            <th>Name</th>
            <th>Date Submitted</th>
            <th>Actions </th>
            </thead>
            <tbody *ngFor="  let application of project?.ProjectMemberApplications">

            <td>{{application.Name}}</td>
            <td>{{application.DateCreated}}</td>
            <td>
              <button
                (click)="approveMemberApplication(project?.Id,application.Id,application.Name); "
                class="btn btn-success"><i class="fa fa-check"></i> Approve
              </button>
              <button style="margin-left: 10px"
                      (click)="application_action='rejected';application_member_name=application.Name;rejectMemberApplication(project?.Id,application.Id,application.Name); "
                      class="btn btn-danger"><i class="fa fa-times"></i> Reject
              </button>
            </td>
            </tbody>
          </table>
        </div>
      </div>


      <div class="modal-footer">

        <p *ngIf="application_action_success && application_action_done" class="alert alert-success mr-auto">
          <strong>Success:</strong> Succesfully {{application_action}} the application of
          {{application_member_name}}.
        </p>
        <p *ngIf="!application_action_success && application_action_done && !application_action_error_message"
           class="alert alert-danger mr-auto">
          <strong>Failed:</strong> The application of {{application_member_name}} could not be
          {{application_action}} .
        </p>
        <p *ngIf="!application_action_success && application_action_done && application_action_error_message"
           class="alert alert-danger mr-auto">
          <strong>Failed:</strong> User didn't verify his email address yet. Please wait until the email is
          verified.
        </p>
        <button type="button" class="btn btn-primary"
                (click)="getUserProjectApplications()">
          Refresh
        </button>
        <button type="button" class="btn btn-secondary"
                (click)="application_action_error_message=null;;applicationModal.hide();">
          Close
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>


<div bsModal #notificationModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="Label"
     aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="notification_title">{{ notificationModalTitle }}</h4>
        <button type="button" class="close" style="cursor:pointer" (click)="notificationModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-{{ notificationModalType }}" role="alert">
          {{ notificationModalMessage }}
        </div>
      </div>
      <div class="modal-footer">
        <button *ngIf="notificationModalIsClosable == true" type="button"
                (click)="resetNotificationModal(); notificationModal.hide();" type="reset"
                class="btn  btn-secondary" id="close_notification"> Close
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div bsModal #infoModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-info modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Details</h4>
        <button type="button" class="close" style="cursor: pointer" (click)="infoModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <div *ngIf="!details_loaded" style="text-align: center"><i class="fa fa-spinner fa-spin"
                                                                   style="font-size:100px; margin: auto;margin-left: auto;margin-right: auto"></i>
        </div>
        <div class="table-responsive">
          <table *ngIf="details_loaded" class="table table-striped">
            <thead>
            <th>Description</th>
            <th>Date created (d/m/y)</th>
            <th>Expiration Date (d/m/y)</th>
            <th>Days running</th>
            <th>Lifetime in Days</th>
            </thead>
            <tbody>
            <td>
              <button class="btn btn-info"
                      (click)="infoModal.hide();descriptionModal.show();">Show
                Description
              </button>
            </td>

            <td>{{ project?.DateCreated }}</td>
            <td>{{project?.DateEnd}}</td>
            <td>{{ project?.DaysRunning }}</td>
            <td>{{project?.LifetimeDays}}</td>
            <td>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="infoModal.hide();">
          Close
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>


<div bsModal #descriptionModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-info" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Description</h4>
        <button type="button" class="close" style="cursor: pointer" (click)="descriptionModal.hide()"
                aria-label="Close">

          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <p>{{ project?.Description }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary"
                (click)="descriptionModal.hide();">
          Close
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>


<div bsModal #chooseModal="bs-modal" class="modal fade" tabindex="-1"
     role="dialog" aria-labelledby="Label"
     aria-hidden="true"
     id="choose_request_type_modal">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <div class="jumbotron">
          <h2 style="text-align: center;">Resource Modification / Project Extension</h2>
          <p class="lead"></p>
          <hr class="my-4">
          <p class="lead">
            <span>Please note: If you want to extend your project as well as adjust the required resources,
            you have to submit two separate applications. These two applications will be processed
            independently of each other.
            <br><br>
            Modification Request:
            - Modification of the requested resources, e.g.: number and type of VMs, number and size of persistent storage options.
            <br><br>
            Lifetime Extensions:
              - Extension of the project period</span>
          </p>
          <div class="btn-group btn-group-lg" role="group" style="width:100%;">
            <button (click)="resourceModificationModal.show(); chooseModal.hide();"
              type="button" class="btn btn-primary btn-lg" style="width:50%;"
            id="resource_modification_button">Resource Modification</button>
            <button (click)="projectExtensionModal.show(); chooseModal.hide();"
                    type="button" class="btn btn-success btn-lg" style="width:50%;"
            id="project_extension_button">Project Extension</button>
          </div>
        </div>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

  <div bsModal #deleteModal="bs-modal" class="modal fade" tabindex="-1"
       role="dialog" aria-labelledby="Label"
       aria-hidden="true"
       id="remove_application_modal">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Delete Application</h4>
          <button type="button" class="close" style="cursor:pointer"
                  (click)="deleteModal.hide()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

          <div class="alert alert-warning" role="alert">
            Are you sure you want to remove this application?
          </div>

        </div>
        <div class="modal-footer">
          <button class="btn  btn-success col-md-4" id="confirm_remove_application_button"
                  (click)="deleteApplication();deleteModal.hide();notificationModal.show()">
            Yes
          </button>
          <button class="btn  btn-danger col-md-4" type="reset"
                  (click)="deleteModal.hide()">Cancel
          </button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->


<div bsModal #resourceModificationModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4>Resource Modification request for {{project_application?.project_application_shortname}}</h4>
        <button type="button" class="close" style="cursor: pointer"
                (click)="resourceModificationModal.hide(); setModalOpen(false);" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <div class="alert alert-info">
          <strong>Please be aware:</strong>
          The number of flavors, GBs of storage and storage volumes which you enter within
          this request will be the numbers you will actually get.
          These numbers <strong>will not be added</strong> to your current numbers, but
          will <strong>replace them</strong>.
        </div>
        <form id="resource_modification_application_form" #modificationForm="ngForm"
              class="form-horizontal">

          <div class="form-group row">
            <h6 class="col-md-8 form-control-label">Resources*
              <i data-balloon="Select the number of Virtual Machines you want to run of each specific flavour"
                 data-balloon-pos="down">
                <i class="icon-question"></i></i>
            </h6>
          </div>


          <accordion>
            <ng-container *ngFor="let t of typeList, first as isFirst">
              <accordion-group *ngIf="project_application?.project_application_openstack_project || checkIfTypeGotSimpleVmFlavor(t)"
                               [isOpen]="isFirst" #groupval>
                <div accordion-heading style="width: 100%; cursor: pointer">
                  {{t.long_name}}
                  <i class="pull-right float-right" style="font-size: 25px" [ngClass]="{
                            'icon-arrow-up': groupval.isOpen, 'icon-arrow-down': !groupval.isOpen}"></i>
                </div>
                <div *ngFor="let fl of flavorList" class="form-group row">
                  <div
                    *ngIf="fl.type.shortcut == t.shortcut && (fl.simple_vm || project_application?.project_application_openstack_project)"
                    class="form-group row">
                    <label class="col-md-4 form-control-label"><strong>{{fl.name}}</strong><br>
                      Number of cores: <span
                        id="{{fl.name}}_cores">{{fl.vcpus}}</span><br>
                      RAM: <span id="{{fl.name}}_ram">{{fl.ram}}</span> GB</label>
                    <div class="col">
                      <div class="input-group">
                        <input class="form-control"
                               name="{{fl.name}}_old"
                               id="{{fl.name}}_old"
                               type="text"
                               value="{{project_application| flavorCounter:fl}}"
                               placeholder="0" disabled>
                        <div class="input-group-append"><span class="input-group-text"> VMs</span></div>
                      </div>
                      <span class="help-block">Currently approved of this type </span>
                    </div>
                    <div class="col">
                      <div class="input-group">
                        <input class="form-control"
                               (change)="valuesChanged(fl,name?.value);
                               calculateCreditsModification();"
                               id="{{fl.name}}"
                               name="{{fl.name}}"
                               type="number" min="0" step="1"
                               placeholder="e.g 1"
                               (ngModelChange)="onChangeFlavor(fl,$event)"
                               [ngModel]="project_modification | flavorCounter:fl"
                               #name="ngModel"
                               appMinAmount="0" appIntegerOrNull
                               [ngClass]="{
                                'is-invalid': name?.invalid,
                                'is-valid': name?.valid
                                }">
                        <div class="input-group-append"><span class="input-group-text"> VMs</span></div>
                      </div>
                      <span class="help-block">Number of VMs you would like to run in the future</span>
                    </div>
                  </div>

                </div>
              </accordion-group>
            </ng-container>
          </accordion>
          <div class="form-group row">
            <label class="col-md-4 form-control-label" for="project_application_volume_counter"><strong>Number
              of storage
              volumes*
              <i
                data-balloon="Number of volumes allowed to create. The sum of the volumes size equals the value provided in the storage limit field."
                data-balloon-pos="down" data-balloon-length="large"><i
                class="icon-question"
                style="cursor: pointer;"></i></i></strong></label>
            <div class="col">
              <div class="input-group">
                <input required class="form-control"
                       name="project_application_volume_counter"
                       id="project_application_volume_counter"
                       placeholder="NA"
                       value="{{project_application?.project_application_volume_counter}}"
                       type="text" disabled>
              </div>
              <span class="help-block">Current number of storage volumes</span>
            </div>

            <div class="col">
              <div class="input-group">
                <input required class="form-control"
                       id="id_project_application_renewal_volume_counter"
                       name="project_application_renewal_volume_counter"
                       placeholder="e.g. 20"
                       type="number" min="0" step="1"
                       [(ngModel)]="project_modification.volume_counter"
                       appMinAmount="0" appInteger
                       [ngClass]="{
                                'is-invalid': modificationForm.controls.project_application_renewal_volume_counter?.invalid,
                                'is-valid': modificationForm.controls.project_application_renewal_volume_counter?.valid
                                }">
              </div>
              <span class="help-block">How many storage volumes do you need in the future?</span>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-4 form-control-label" for="project_application_volume_limit"><strong>Storage
              Limit*
              <i
                data-balloon="Storage limit is the sum of extra storage provided by volumes."
                data-balloon-pos="down" data-balloon-length="medium"><i
                class="icon-question"
                style="cursor: pointer;"></i></i></strong></label>
            <div class="col">
              <div class="input-group">
                <input class="form-control"
                       name="project_application_volume_limit"
                       id="project_application_volume_limit"
                       value="{{project_application?.project_application_volume_limit}}"
                       placeholder="NA"
                       type="text" disabled>
                <div class="input-group-append"><span class="input-group-text"> GB
                                    </span></div>
              </div>
              <span class="help-block">Current extra storage</span>
            </div>
            <div class="col">
              <div class="input-group">
                <input class="form-control"
                       id="id_project_application_renewal_volume_limit"
                       name="project_application_renewal_volume_limit"
                       placeholder="e.g. 20"
                       type="number" min="1" step="1"
                       [(ngModel)]="project_modification.volume_limit"
                       appMinAmount="1" appInteger
                       [ngClass]="{
                                'is-invalid': modificationForm.controls.project_application_renewal_volume_limit?.invalid,
                                'is-valid': modificationForm.controls.project_application_renewal_volume_limit?.valid
                                }"
                       [disabled]="modificationForm.controls.project_application_renewal_volume_counter?.value == 0">
                <div class="input-group-append"><span class="input-group-text"> GB
                                    </span></div>
              </div>
              <span class="help-block">How much extra storage do you need in the future?</span>
            </div>
          </div>


          <div *ngIf="project_application?.project_application_openstack_project" class="form-group row">
            <label class="col-md-4 form-control-label" for="textarea-input"><strong>Object
              Storage* </strong><i
              data-balloon="Object storage is a method of storing data that does not use a directory tree internally. Object storage combines files with metadata and places it in a flat structure."
              data-balloon-pos="down" data-balloon-length="large"><i
              class="icon-question"
              style="cursor: pointer;"></i></i></label>

            <div class="col">
              <div class="input-group">
                <input class="form-control"
                       name="project_application_object_storage"
                       id="project_application_object_storage"
                       placeholder="NA"
                       value="{{project_application?.project_application_object_storage}}"
                       type="text" disabled>
                <div class="input-group-append"><span class="input-group-text"> GB
                                    </span></div>
              </div>
              <span class="help-block">Current Object Storage capacity</span>
            </div>

            <div *ngIf="project_application?.project_application_openstack_project" class="col">
              <div class="input-group">
                <input class="form-control"
                       id="id_project_application_renewal_object_storage"
                       name="project_application_renewal_object_storage"
                       placeholder="e.g. 8"
                       [(ngModel)]="project_modification.object_storage"
                       type="number" min="0" step="1"
                       appInteger appMinAmount="0" required
                       [ngClass]="{
                                'is-invalid': modificationForm.controls.project_application_renewal_object_storage?.invalid ,
                                'is-valid': modificationForm.controls.project_application_renewal_object_storage?.valid
                                }">
                <div class="input-group-append"><span class="input-group-text"> GB
                                    </span></div>
              </div>
              <span class="help-block">How much Object Storage do you need in the future?</span>
            </div>
          </div>
          <div
            *ngIf="project_application?.project_application_openstack_project && project_application?.project_application_cloud_service && project_application?.project_application_cloud_service_develop"
            class="form-group row">
            <label class="col-md-4 form-control-label" for="textarea-input"><strong>Service status </strong><i
              data-balloon="Status of your service."
              data-balloon-pos="down" data-balloon-length="large"><i
              class="icon-question"
              style="cursor: pointer;"></i></i></label>

            <div class="col">
            </div>

            <div
              *ngIf="project_application?.project_application_openstack_project && project_application?.project_application_cloud_service && project_application?.project_application_cloud_service_develop"
              class="col">
              <div class="input-group">
                <label id="id_project_application_renewal_cloud_service_develop"
                       class="switch switch-label switch-outline-primary-alt">
                  <input type="checkbox" class="switch-input"
                         name="project_application_renewal_cloud_service_develop"
                         [defaultChecked]="project_application?.project_application_cloud_service_develop"
                         [(ngModel)]="project_modification.cloud_service_develop"
                  >
                  <span class="switch-slider" data-checked="Yes" data-unchecked="No"></span>
                  <span class="switch-handle"></span></label>
              </div>
              <span class="help-block">Is your service still in development?</span>
            </div>
          </div>

          <div
            *ngIf="project_application?.project_application_openstack_project && project_application?.project_application_cloud_service && (!project_application?.project_application_cloud_service_develop)"
            class="form-group row">
            <label class="col-md-4 form-control-label" for="textarea-input"><strong>Cloud Service user
              number </strong><i
              data-balloon="Number of user using your service."
              data-balloon-pos="down" data-balloon-length="large"><i
              class="icon-question"
              style="cursor: pointer;"></i></i></label>

            <div class="col">
              <div class="input-group">
                <input class="form-control"
                       name="project_application_cloud_service_user_number"
                       id="project_application_cloud_service_user_number"
                       placeholder="NA"
                       value="{{project_application?.project_application_cloud_service_user_number}}"
                       type="text" disabled>
              </div>
              <span class="help-block">Current number of users</span>
            </div>

            <div
              *ngIf="project_application?.project_application_openstack_project && project_application?.project_application_cloud_service && !project_application?.project_application_cloud_service_develop"
              class="col">
              <div class="input-group">
                <input class="form-control"
                       id="id_project_application_renewal_cloud_service_user_number"
                       name="project_application_renewal_cloud_service_user_number"
                       placeholder="e.g. 200"
                       [(ngModel)]="project_modification.cloud_service_user_number"
                       type="number" min="0" step="1"
                       appInteger appMinAmount="0" required
                       [ngClass]="{
                                'is-invalid': modificationForm.controls.project_application_renewal_cloud_service_user_number?.invalid ,
                                'is-valid': modificationForm.controls.project_application_renewal_cloud_service_user_number?.valid
                                }">
              </div>
              <span class="help-block">How many users are using your service?
              <br>
              <strong>Note:</strong> we define service users as <strong>unique users per month.</strong></span>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-md-4 form-control-label"
                   for="id_project_application_renewal_comment"><strong>Comment</strong></label>
            <div class="col-md-8">
                <textarea type="text" id="id_project_application_renewal_comment"
                          name="project_application_renewal_comment" class="form-control"
                          maxlength="8192"
                          placeholder=''
                          [(ngModel)]="project_modification.comment"></textarea>
              <span class="help-block">Additional information you want to share?</span>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-4"></label>
            <div class="col-md-8">
              <div class="alert alert-primary" role="alert">
                In case you need additional and/or special resources, which are not available in the flavour selection,
                use the comment field to state so. The same applies to unusually large amounts of resources.
              </div>
            </div>
          </div>


          <strong *ngIf="is_vo_admin">
            <div *ngIf="is_vo_admin" class="form-group row">
              <label #corenumbers id="creditnumber" class="col">Expected number of extra credits: <span
                id="modification_credits">{{project_modification.extra_credits}}</span></label>
            </div>
            <div class="alert alert-primary" role="alert">
              This is the expected number of extra credits that you get for your project. It accounts for an increase in
              requested resources/project lifetime.
            </div>
          </strong>
        </form>
        <!-- TODO: CHECK FOR CONFLICTS -->
        <div *ngIf="modificationForm.invalid" class="alert alert-warning" role="alert">
          <p>Some required fields are incorrect or not filled in yet.
            Please check if all required (*) fields are filled in correctly.</p>
          <p *ngIf="modificationForm.controls.project_application_renewal_volume_counter?.invalid">
            - Number of storage volumes missing
          </p>
          <p *ngIf="modificationForm.controls.project_application_renewal_volume_limit?.invalid">
            - Storage Limit missing
          </p>
          <p *ngIf="modificationForm.controls.project_application_renewal_object_storage?.invalid">
            - Object Storage missing
          </p>
          <p *ngIf="!min_vm">
            - Select at least one Flavor
          </p>

        </div>


        <div class="modal-footer">
          <div class="label">
            By submitting this application you agree to the cloud usage policy.
          </div>
          <button type="button" class="btn  btn-primary"
                  form="resource_modification_application_form" id="submit_modification_btn"
                  (click)="this.request_type = ExtensionRequestType.MODIFICATION;
                  calculateRamCores(); calculateCreditsModification();
                  resourceModificationModal.hide(); submitModal.show();"
                  [disabled]="modificationForm.invalid"><i class="fa fa-dot-circle-o"></i>
            Submit
          </button>
          <button type="button" class="btn btn-danger"
                  (click)="resourceModificationModal.hide(); setModalOpen(false);">
            Close
          </button>

        </div>

      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</div>


  <div bsModal #projectExtensionModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4>Extension request for {{project_application?.project_application_shortname}}</h4>
        <button type="button" class="close" style="cursor: pointer"
                (click)="projectExtensionModal.hide(); setModalOpen(false);" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <form id="extension_application_form" #extensionForm="ngForm"
              class="form-horizontal">


          <div class="form-group row">

            <label class="col-md-4 form-control-label">
              <strong>Lifetime* <i class="icon-question" data-toggle="tooltip"
                                   title="Current timespan of your project. You can extend your project by a maximum of 12 months">
              </i>
              </strong>
            </label>


            <div class="col">
              <div class="input-group">
                <input class="form-control"
                       name="project_application_lifetime" placeholder="NA"
                       type="text" value="{{life_time_string}}"
                       disabled>

              </div>
              <span class="help-block">Current lifetime</span>
            </div>

            <div class="col">
              <div class="input-group">
                <input class="form-control"
                       (change)="calculateCreditsLifeTime();"
                       id="project_extension_application_renewal_lifetime"
                       name="project_extension_application_renewal_lifetime"
                       placeholder="e.g. 3"
                       [(ngModel)]="project_extension.extra_lifetime"
                       type="number" min="1" max="12" step="1" required
                       appInteger appMinAmount="1" appMaxAmount="12"
                       [ngClass]="{
                                'is-invalid': extensionForm.controls.project_application_renewal_lifetime?.invalid
                                && (extensionForm.controls.project_application_renewal_lifetime?.dirty
                                || extensionForm.controls.project_application_renewal_lifetime?.touched),
                                'is-valid': extensionForm.controls.project_application_renewal_lifetime?.valid
                                && (extensionForm.controls.project_application_renewal_lifetime?.dirty
                                || extensionForm.controls.project_application_renewal_lifetime?.touched)}">
                <div class="input-group-append">
                  <span class="input-group-text" style="padding: 0 !important;"> months</span>
                </div>
              </div>
              <span class="help-block">Number of months you want to extend the project </span>
            </div>
          </div>
          <div class="form-group row" *ngIf="project_application?.project_application_edam_terms.length == 0 ">
            <label class="col-md-4 form-control-label"><strong>Research Topics* </strong></label>
            <div class="col-md-8">
              <div [ngClass]="{
                                'danger-border': selected_ontology_terms?.length <=0,
                                'success-border':selected_ontology_terms?.length >0
                                }">
                <ng-autocomplete #edam_ontology id="edam_input"
                                 [data]="edam_ontology_terms"
                                 [searchKeyword]="ontology_search_keyword"
                                 (selected)='selectEvent($event)'
                                 placeHolder="Please add your research topics"

                                 [itemTemplate]="itemTemplate"
                                 [notFoundTemplate]="notFoundTemplate">
                </ng-autocomplete>

                <ng-template #itemTemplate let-item>
                  <a [id]="item.term" [innerHTML]="item.term"></a>
                </ng-template>

                <ng-template #notFoundTemplate let-notFound>
                  <div [innerHTML]="notFound"></div>
                </ng-template>


              </div>
              <h5><span

                *ngFor="let term of selected_ontology_terms"
                style="margin-right: 5px; "
                class="badge badge-info"> {{term.term}}
                <span class="badge" style="cursor: pointer;" (click)="removeEDAMterm(term)">&#10060;</span>
 </span>

              </h5>
            </div>
          </div>


          <div class="form-group row">
            <label class="col-md-4 form-control-label"
                   for="id_project_application_renewal_comment"><strong>Comment</strong></label>
            <div class="col-md-8">
                <textarea type="text" id="project_extension_application_renewal_comment"
                          name="project_application_renewal_comment" class="form-control"
                          maxlength="8192"
                          placeholder=''
                          [(ngModel)]="project_extension.comment"></textarea>
              <span class="help-block">Additional information you want to share?</span>
            </div>
          </div>


          <strong *ngIf="is_vo_admin">
            <div *ngIf="is_vo_admin" class="form-group row">
              <label #corenumbers id="creditnumber_extension" class="col">Expected number of extra credits: <span
                id="extension_credits">{{project_extension.extra_credits}}</span></label>
            </div>
            <div class="alert alert-primary" role="alert">
              This is the expected number of extra credits that you get for your project. It accounts for an increase in
              requested resources/project lifetime.
            </div>
          </strong>


        </form>

        <div *ngIf="extensionForm.invalid" class="alert alert-warning" role="alert">
          <p>Some required fields are incorrect or not filled in yet.
            Please check if all required (*) fields are filled in correctly.</p>
          <p *ngIf="extensionForm.controls.project_application_renewal_lifetime?.invalid">
            - Lifetime missing
          </p>

          <p  *ngIf="project_application?.project_application_edam_terms.length == 0 && selected_ontology_terms.length < 1">
            - Select at least one Research Topic
          </p>
        </div>


        <div class="modal-footer">
          <div class="label">
            By submitting this extension application you agree to the cloud usage policy.
          </div>
          <button type="button" class="btn  btn-primary"
                  form="extension_application_form" id="submit_extension_btn"
                  (click)="calculateCreditsLifeTime(); projectExtensionModal.hide();
                  this.request_type = ExtensionRequestType.EXTENSION; submitModal.show();"
                  [disabled]="extensionForm.invalid || (((project_application?.project_application_edam_terms?.length == 0)
                  || !project_application?.project_application_edam_terms) && selected_ontology_terms.length < 1)">
            <i class="fa fa-dot-circle-o"></i>
            Submit
          </button>
          <button type="button" class="btn btn-danger"
                  (click)="projectExtensionModal.hide(); setModalOpen(false);">
            Close
          </button>

        </div>

      </div>
</div>
</div>
</div>


<div bsModal #creditsExtensionModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4>Extra credits request for {{project_application?.project_application_shortname}}</h4>
        <button type="button" class="close" style="cursor: pointer"
                (click)="creditsExtensionModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="credits_application_form" #f2="ngForm"
              class="form-horizontal">

          <div class="form-group row">
            <label class="col-md-4 form-control-label"
                   for="text-input"><strong>Reasons for Extension</strong></label>
            <div class="col-md-8">
                <textarea required type="text" id="project_application_extra_credits_comment"
                          name="project_application_extra_credits_comment" class="form-control"
                          maxlength="8192"
                          placeholder=''
                          [(ngModel)]="project_credit_request.comment" minlength="10"
                          [ngClass]="{
                                'is-invalid': f2.controls.project_application_extra_credits_comment?.invalid && (f2.controls.project_application_extra_credits_comment?.dirty || f2.controls.project_application_extra_credits_comment?.touched),
                                'is-valid': f2.controls.project_application_extra_credits_comment?.valid && (f2.controls.project_application_extra_credits_comment?.dirty || f2.controls.project_application_extra_credits_comment?.touched)
                                }"
                ></textarea>
              <span class="help-block">Please state why you need extra credits.</span>
              <div class="alert alert-info">
                As more credits are requested we require a more detailed description of the reasons!
              </div>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-4 form-control-label" for="textarea-input"><strong>Amount of extra credits needed</strong></label>
            <div class="col-md-8">

            <div class="input-group">
              <input required class="form-control"
                     id="project_application_extra_credits"
                     name="project_application_extra_credits"
                     placeholder="e.g. 5000"
                     (change)="updateExampleCredits(project_credit_request.extra_credits);"
                     [(ngModel)]="project_credit_request.extra_credits" min="100" step="100" type="number"
                     appInteger appMinAmount="100"
                     [ngClass]="{
                                'is-invalid': f2.controls.project_application_extra_credits?.invalid && (f2.controls.project_application_extra_credits?.dirty || f2.controls.project_application_extra_credits?.touched),
                                'is-valid': f2.controls.project_application_extra_credits?.valid && (f2.controls.project_application_extra_credits?.dirty || f2.controls.project_application_extra_credits?.touched)
                                }">
              <div class="input-group-append"><span class="input-group-text"> Credits
                                    </span></div>
            </div>
            <span class="help-block">How many credits do you need for your project? You need 1 credit for 1 cpu core per hour and 0.28 credits for 1 GB of ram per hour.</span>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-4 form-control-label"><strong>Example</strong></label>
            <div class="col-md-8">
              <tr>
                <strong>
                  Runtime of exemplary VMs with the entered credits.
                  </strong>
              </tr>
              <tr>
                <td>Enough Credits to run 4 {{smallExampleFlavor?.name}} for {{smallExamplePossibleDays}} {{smallExamplePossibleHours}} hours <strong>non-stop</strong></td>
              </tr>
              <tr>
                <td>Enough Credits to run 1 {{largeExampleFlavor?.name}} for {{largeExamplePossibleDays}} {{largeExamplePossibleHours}} hours <strong>non-stop</strong></td>
              </tr>
            </div>
          </div>
        </form>
        <div *ngIf="f2.invalid" class="alert alert-warning" role="alert">
          <p>Some required fields are incorrect or not filled in yet.
            Please check if all required (*) fields are filled in correctly.</p>
          <p *ngIf="project_credit_request.comment.length <10">
            - No reason specified (at least 10 characters)
          </p>
          <p *ngIf="project_credit_request.extra_credits < 1">
            - Number of extra credits not specified
          </p>
        </div>


        <div class="modal-footer">
          <div class="label">
            By submitting this application you agree to the cloud usage policy.
          </div>
          <button type="button" class="btn  btn-primary" adm
                  form="credits_application_form" id="submit_extra_credits_btn"
                  (click)="creditsExtensionModal.hide(); this.request_type = ExtensionRequestType.CREDIT;
                  submitModal.show();" [disabled]="f2.invalid"><i class="fa fa-dot-circle-o"></i>
            Submit
          </button>
          <button type="button" class="btn btn-danger"
                  (click)="creditsExtensionModal.hide();">
            Close
          </button>

        </div>

      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</div>

<div bsModal #submitModal="bs-modal" class="modal fade" tabindex="-1"
     role="dialog" aria-labelledby="Label"
     aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">{{projectName}}</h4>
        <button type="button" class="close" style="cursor: pointer;"
                (click)="submitModal.hide(); setModalOpen(false);"
                data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>

      </div>
      <div class="modal-body">
        <div class="alert alert-info">
          <strong>Please check the data you have entered and confirm your application
            below.</strong><br>
          If the entered data mismatches with your requirements cancel this confirmation
          and take changes.
        </div>
        <div class="table-responsive">
          <table class="table table-striped">
            <ng-container *ngIf="this.request_type === ExtensionRequestType.MODIFICATION">
              <tr *ngFor="let flav of this.project_modification.flavors">
                <td>{{flav.name + ': ' + flav.counter + ' VMs'}}</td>
              </tr>
              <tr *ngIf="this.project_modification.volume_counter > 0">
                <td>Number of storage volumes: {{this.project_modification.volume_counter}}</td>
              </tr>
              <tr *ngIf="(this.project_modification.volume_counter > 0) && (this.project_modification.volume_limit > 0)">
                <td>Amount of storage space: {{this.project_modification.volume_limit}} GBs</td>
              </tr>

              <tr *ngIf="this.project_application.project_application_openstack_project
            && this.project_modification.object_storage > 0">
                <td>Amount of object storage: {{this.project_modification.object_storage}} GB</td>
              </tr>
            </ng-container>

            <tr *ngIf="this.selected_ontology_terms?.length > 0">
              <td>Selected Terms:
                <span *ngFor="let term of this.selected_ontology_terms" class="badge badge-info">{{term.term}}</span></td>
            </tr>

            <tr *ngIf="(this.request_type === ExtensionRequestType.EXTENSION)
            && this.project_extension.comment?.length > 0">
              <td>Comment : {{this.project_extension.comment}}</td>
            </tr>

            <tr *ngIf="(this.request_type === ExtensionRequestType.MODIFICATION)
            && this.project_modification.comment?.length > 0">
              <td>Comment : {{this.project_modification.comment}}</td>
            </tr>

            <tr *ngIf="(this.request_type === ExtensionRequestType.CREDIT)
            && this.project_credit_request.comment?.length > 0">
              <td>Comment : {{this.project_credit_request.comment}}</td>
            </tr>

            <tr *ngIf="request_type == ExtensionRequestType.MODIFICATION">
              <td><strong>Number of cores in total:
                {{project_modification?.total_cores}}</strong>
              </td>
            </tr>
            <tr *ngIf="request_type == ExtensionRequestType.MODIFICATION">
              <td><strong>Value of RAM in
                total: {{project_modification?.total_ram}}
                GBs</strong>
              </td>
            </tr>
            <tr *ngIf="request_type == ExtensionRequestType.EXTENSION" >
              <td><strong>Additional lifetime in months: {{project_extension.extra_lifetime}}</strong></td>
            </tr>
            <tr *ngIf="request_type == ExtensionRequestType.CREDIT">
              <td>Amount of requested extra credits: {{project_credit_request.extra_credits}}</td>
            </tr>
            <tr *ngIf="is_vo_admin" >
              <td><strong>Approximate number of extra credits:{{project_modification?.extra_credits}}</strong></td>
            </tr>
          </table>
        </div>
      </div>


      <div class="modal-footer">


        <button id="confirm_extension_btn" class="btn btn-success col-md-4" type="button"
                *ngIf="request_type==ExtensionRequestType.EXTENSION"
                (click)="submitModal.hide(); requestExtension(); resultModal.show();
                ">Confirm Application
        </button>
        <button id="confirm_modification_btn" class="btn btn-success col-md-4" type="button"
                *ngIf="request_type==ExtensionRequestType.MODIFICATION"
                (click)="submitModal.hide(); requestModification(); resultModal.show();
               ">Confirm Application
        </button>
        <button id="confirm_credits_btn" class="btn btn-success col-md-4" type="button"
                *ngIf="request_type==ExtensionRequestType.CREDIT"
                (click)="submitModal.hide(); requestCreditsModification(); resultModal.show();
                ">Confirm Application
        </button>
        <button class="btn btn-primary col-md-4" type="reset"
                (click)="submitModal.hide();">Cancel
        </button>

      </div>
    </div><!-- /.modal-content -->L
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


  <div bsModal #doiModal="bs-modal" class="modal fade" tabindex="-1"
       role="dialog" aria-labelledby="Label"
       aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Digital object identifier (DOI)</h4>
          <button type="button" class="close" style="cursor: pointer;"
                  (click)="doiModal.hide(); setModalOpen(false);"
                  data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>

        </div>
        <div class="modal-body">
          <div class="alert alert-info">
            <p>Please add the DOIs of new publications in this form. For more information on DOIs, please look <a
            href="https://cloud.denbi.de/wiki/citation_and_publication/"
            target="_blank">here</a>.
              You can also add the publications at a later date on the project overview page.</p>
            <p>The addition or non-addition of publications/DOIs <strong>does not affect the renewal request procedure!</strong></p>
          </div>
          <div class="table-responsive">
            <table class="table ">

              <tbody>
              <ng-container
                *ngFor="let doi of dois">
                <tr>
                  <td><a target="_blank" [href]="'https://doi.org/' + doi.identifier">{{doi.identifier}}</a></td>

                  <td>
                    <button
                      class="btn btn-danger" type="button" (click)="deleteDoi(doi);">
                      <i class="fa fa-trash"></i>&nbsp;
                    </button>
                  </td>

                </tr>
              </ng-container>

              <tr>
                <td><input style="width: 100%" type="text" required placeholder="e.g. 10.1000/182"
                           pattern="10.\d{4,9}\/[-._;()\/:a-zA-Z0-9]+" [(ngModel)]="newDoi" #doiInput></td>

                <td>
                  <button id="add_doi_btn_in_modal"
                          (click)="addDoi();"
                          [disabled]="!doiInput.validity.valid"
                          type="button"
                          class="btn btn-success"><i class="fa fa-plus"></i>&nbsp;
                  </button>
                </td>

              </tr>
              </tbody>
            </table>

          </div>


          <div *ngIf="!project_application?.hasModificationRequestedStatus()
                 && project_application?.hasExtensionRequestedStatus()"
               class="modal-footer" style="text-align:center;">
            <button id="doi_continue_btn" class="btn btn-success col-md-6" type="button"
                    style="margin:auto;"
                    (click)="doiModal.hide(); resourceModificationModal.show(); setModalOpen(true);">
              Continue
            </button>
          </div>
          <div *ngIf="project_application?.hasModificationRequestedStatus()
                 && !project_application?.hasExtensionRequestedStatus()"
               class="modal-footer" style="text-align:center;">
            <button id="doi_continue_btn" class="btn btn-success col-md-6" type="button"
                    style="margin:auto;" (click)="doiModal.hide(); projectExtensionModal.show(); setModalOpen(true);">
              Continue
            </button>
          </div>
          <div *ngIf="!project_application?.hasModificationRequestedStatus()
                 && !project_application?.hasExtensionRequestedStatus()"
               class="modal-footer" style="text-align:center;">
            <button id="doi_continue_btn" class="btn btn-success col-md-6" type="button"
                    style="margin:auto;" (click)="doiModal.hide(); chooseModal.show(); setModalOpen(true);">Continue
            </button>
          </div>
        </div><!-- /.modal-content -->L
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
  </div>


  <div bsModal #doiQuestionModal="bs-modal" class="modal fade" tabindex="-1"
       role="dialog" aria-labelledby="Label"
       aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Publications</h4>
          <button type="button" class="close" style="cursor: pointer;"
                  (click)="doiQuestionModal.hide(); setModalOpen(false);"
                  data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>

        </div>
        <div class="modal-body">
          <div>
          <p><strong>Do you have any new publications that were made during your work with the de.NBI Cloud or
            in which the de.NBI Cloud is mentioned?</strong></p>
          </div>
          <div class="modal-footer">
            <div class="row" style="margin:auto">
              <div class="col-6">
                <button id="new_dois_btn" class="btn btn-success" type="button"
                        (click)="doiQuestionModal.hide(); doiModal.show(); setModalOpen(true)">Yes
                </button>
              </div>


              <div class="col-6">
                <button *ngIf="!project_application?.hasModificationRequestedStatus()
                 && project_application?.hasExtensionRequestedStatus()" id="no_new_dois_btn" class="btn btn-primary"
                        type="reset"
                        (click)="doiQuestionModal.hide(); resourceModificationModal.show(); setModalOpen(true);">No
                </button>
                <button *ngIf="project_application?.hasModificationRequestedStatus()
                 && !project_application?.hasExtensionRequestedStatus()" id="no_new_dois_btn" class="btn btn-primary"
                        type="reset"
                        (click)="doiQuestionModal.hide(); projectExtensionModal.show(); setModalOpen(true);">No
                </button>
                <button *ngIf="!project_application?.hasModificationRequestedStatus()
                 && !project_application?.hasExtensionRequestedStatus()" id="no_new_dois_btn" class="btn btn-primary"
                        type="reset"
                        (click)="doiQuestionModal.hide(); chooseModal.show(); setModalOpen(true);">No
                </button>
              </div>
            </div>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
  </div>


  <div bsModal #resultModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
         aria-labelledby="Label"
         aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" *ngIf="extension_status == 0">
              Waiting </h4>
            <h4 class="modal-title" *ngIf="extension_status == 1"> Success </h4>
            <h4 class="modal-title" *ngIf="extension_status == 2"> Error </h4>
            <button type="button" class="close" style="cursor: pointer"
                    (click)="resultModal.hide();extension_status= 0; setModalOpen(false);"
                    aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

          <div class="modal-body">
            <div class="alert alert-info" role="alert" *ngIf="extension_status==0">
              Waiting... <i class="fa fa-spinner fa-spin"
                            style="font-size:24px"></i>
            </div>


            <div id="extension result_submitted" class="alert alert-success" role="alert" *ngIf="extension_status == 1">

              Modify request successfully submitted!
            </div>
            <div id="extension result_approved" class="alert alert-success" role="alert" *ngIf="extension_status == 3">
              Modify request successfully approved!
            </div>
            <div id="extension result_declined" class="alert alert-success" role="alert" *ngIf="extension_status == 4">
              Modify request successfully declined!
            </div>
            <div id="extension result_forwarded" class="alert alert-success" role="alert" *ngIf="extension_status == 5">
              Modify request successfully approved and forwarded to facility!
            </div>

            <div id="extension result_error" class="alert alert-warning" role="alert" *ngIf="extension_status == 2">
              An error occured.

            </div>


            <div class="modal-footer">
              <button type="button" class="btn btn-secondary"
                      (click)="resultModal.hide();extension_status= 0; setModalOpen(false);">
                Close
              </button>
            </div>

          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
  </div>

    <div bsModal #informationModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
         aria-labelledby="infomodallabel"
         aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="information_modal_title">Information for {{project?.Name}}</h4>
            <button type="button" class="close" id="close_info_modal" style="cursor:pointer" (click)="informationModal.hide(); setModalOpen(false);"
                    aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                <tr>
                  <th></th>
                  <th>Project Name</th>
                  <th>Short Name</th>
                  <th>Lifetime</th>
                  <th>Date submitted</th>
                  <th>Status</th>
                </tr>
                </thead>
                <tbody>
                <ng-container>
                  <tr>
                    <td>  <span *ngIf="project_application?.project_application_openstack_project"
                                style="font-size: 20px"
                                class="project-openstack_plain_white_redbg"
                                data-toggle="tooltip"
                                title="This is an Openstack project">
                                                <span class="path1"></span>
                                                <span class="path2"></span>
                                  </span>
                      <span *ngIf="!project_application?.project_application_openstack_project"
                            style="font-size: 20px"
                            class="project-simpleVM_Logo_bluebg"
                            data-toggle="tooltip"
                            title="This is a Simple VM project">
                      <span class="path1"></span>
                      <span class="path2"></span>
                      <span class="path3"></span>
                      <span class="path4"></span>
                      <span class="path5"></span>
                    </span></td>
                    <td>{{ project_application?.project_application_name }}
                    </td>
                    <td>{{project_application?.project_application_shortname}}</td>
                    <td>{{ project_application?.project_application_lifetime }} months</td>
                    <td>{{ project_application?.project_application_date_submitted }}</td>
                    <td><span class="badge bg-secondary" *ngFor="let st of project_application?.project_application_status ">{{
                      getStatusById(st)  }}</span></td>
                  </tr>


                </ng-container>
                </tbody>
              </table>
              <app-application-detail [application]="project_application"></app-application-detail>

            </div>
          </div>
          <div class="modal-footer">
            <div class="row" style="margin:auto;">
              <button type="button" class="btn btn-secondary"
                      (click)="informationModal.hide(); setModalOpen(false);">Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
</div>

