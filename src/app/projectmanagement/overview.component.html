<div *ngIf="isLoaded==false" class="loader"></div>
<div *ngIf="isLoaded" class="animated fadeIn" ng-app>
    <div class="row">
        <!--/.col-->
        <h1>Projects Overview</h1>
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <i class="fa fa-align-justify"></i> Projects
                </div>
                <div class="card-block">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>Project ID</th>
                                <th>Project Name</th>
                                <th>Details</th>
                                <th>Facility</th>
                                <!--th>Date created (d/m/y)</th>
                                <!--th>Expiration Date (d/m/y)</th-->
                                <!--th>Days running</th-->
                                <!--th>Lifetime in Days</th-->
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr *ngFor="let project of projects">
                                <!--[ngStyle]="{'color':lifeTimeReached(project.LifetimeDays,project.DaysRunning)}"-->
                                <td>{{ project.Id }}</td>
                                <td>{{ project.Name }}</td>
                                <td>
                                    <button class="btn btn-secondary"
                                            (click)="getProjectLifetime(project);selectedProject=project;infoModal.show();">
                                        Show Details
                                    </button>
                                </td>

                                <td>
                                    <p *ngIf="project.ComputeCenter?.Name">{{project.ComputeCenter.Name}}</p>
                                    <ul *ngIf="project.ComputeCenter?.Name">
                                        <li *ngIf="project.OpenStackProject"> Login: <a target="_blank"
                                                                                        href="{{project.ComputeCenter.Login}}">
                                            {{project.ComputeCenter.Login}}</a></li>
                                        <li>Support: {{project.ComputeCenter.Support}}</li>

                                        <!--button (click)="verifyModal.show();UserModalFacilityDetails=project.ComputeCenterDetails;UserModalFacility=project.ComputeCenter;"
                                                class="btn btn-primary">Set your OpenStack API password
                                        </button-->

                                    </ul>

                                </td>

                                <!--td>{{ project.DateCreated }}</td>
                                <!--td>{{project.DateEnd}}</td-->
                                <!--td>{{ project.DaysRunning }}</td-->
                                <!--td>{{project.LifetimeDays}}</td-->
                                <td>
                                    <div class="btn-group-vertical">
                                        <button type="button" style="margin-bottom: 5px" class="btn btn-secondary"
                                                data-toggle="modal"
                                                (click)="this.usersModalProjectMembers = [];showMembersOfTheProject(project.Id, project.Name,project.ComputeCenter); usersModal.show(); "


                                                *ngIf="(project.UserIsPi == true) || (project.UserIsAdmin == true)">
                                            <i class="fa fa-users"></i>&nbsp;Show Members
                                        </button>
                                        <button
                                                (click)="resetAddUserModal(); showAddUserToProjectModal(project.Id, project.Name,project.RealName,project.ComputeCenter); addUserModal.show();"
                                                *ngIf="(project.UserIsPi == true) || (project.UserIsAdmin == true)"
                                                type="button" style="margin-bottom: 5px"
                                                class="btn btn-secondary"><i class="fa fa-plus"></i>&nbsp; Add Member
                                        </button>
                                        <button
                                                *ngIf="(project.UserIsPi == true) || (project.UserIsAdmin == true)"
                                                type="button" style="margin-bottom: 5px"
                                                (click)="selectedProject = project;applicationModal.show();loadProjectApplications(selectedProject?.Id);application_action_done=false;"
                                                class="btn btn-secondary"><i class="fa fa-list-alt"></i>&nbsp;
                                            Applications
                                        </button>
                                        <h4 *ngIf="(project.UserIsPi == false) && (project.UserIsAdmin == false)"><span
                                                class="badge badge-default">Project Member </span></h4>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!--/.col-->
    </div>
</div>


<div bsModal #usersModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="Label"
     aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Members of the Project {{ usersModalProjectID }}
                    ({{ usersModalProjectName }})</h4>
                <button type="button" class="close" style="cursor: pointer;" (click)="usersModal.hide()"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-striped" style="margin: 5px">
                        <thead>
                        <tr>
                            <th>User ID</th>
                            <th>Member ID</th>
                            <th>Full Name</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let member of usersModalProjectMembers" [ngStyle]="{'color':isPi(member)}">
                            <td>{{ member.Id }}</td>
                            <td>{{ member.MemberId }}</td>
                            <td>{{ member.Username }}</td>
                            <td>

                                <button *ngIf="UserModalFacility === null" (click)="usersModal.hide();
                                                removeMemberModal.show();
                                                " class="btn btn-secondary" type="button" style="margin: 2px">
                                    <i class="fa fa-trash"></i>&nbsp; Remove member
                                </button>

                                <button *ngIf="!member.IsPi" (click)="usersModal.hide();promoteAdmin( usersModalProjectID,member.Id,member.Username);
                                                notificationModal.show();
                                               " class="btn btn-secondary" type="button" style="margin: 2px">
                                    <i class="fa fa-plus-circle"></i>&nbsp; Set Admin status
                                </button>
                                <button *ngIf="member.IsPi" (click)="usersModal.hide();removeAdmin( usersModalProjectID,member.Id,member.Username);
                                                notificationModal.show();
                                               " class="btn btn-secondary" type="button" style="margin: 2px">
                                    <i class="fa fa-minus-circle"></i>&nbsp; Remove Admin status
                                </button>
                                <button *ngIf="UserModalFacility !== null" (click)="usersModal.hide();removeMember(usersModalProjectID,member.MemberId,member.Username);
                                                notificationModal.show();
                                               " class="btn btn-secondary" type="button" style="margin: 2px">

                                    <i class="fa fa-trash"></i>&nbsp; Remove member
                                </button>
                            </td>
                        </tr>

                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="usersModal.hide()">Close</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div bsModal #addUserModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="Label"
     aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content ">
            <div class="modal-header">
                <h4 class="modal-title">Add member to the project {{ addUserModalProjectID }}
                    ({{ addUserModalProjectName }})</h4>
                <button type="button" class="close" style="cursor:pointer" (click)="addUserModal.hide()"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div *ngIf="UserModalFacility === null"><p>In order to add a new user to the project please do the

                    following</p>

                    <ol>

                        <li>Send one of the following links to the user you would like to add:

                            <ul>

                                <li>If the user does have an elixir account, please send him the following link:

                                    <pre>{{voRegistrationLink}}</pre>

                                </li>

                                <li>If the user does not have an elixir account, please send him the following link:

                                    <pre>https://perun.elixir-czech.cz/registrar/?vo=elixir&targetnew={{voRegistrationLink}}</pre>

                                </li>

                            </ul>

                        </li>

                        <li>As soon as the user went through the registration process, he can enter
                            https://cloud.denbi.de/portal/
                            and report you his user id (User Information tab).
                        </li>

                        <li>Please send the following information to cloud@denbi.de

                            <ul>

                                <li>Your User Id and the user id of the user you would like to add.</li>

                                <li>Project name and project description.</li>

                            </ul>

                        </li>

                        <li>You will be notified when the user is member of your project.</li>

                    </ol>
                </div>
                <div *ngIf="UserModalFacility !== null">

                    <div>
                        <p style=" margin-bottom: 15px;">Search and add a user to your project by providing at least
                            four characters of his name or the exact name:</p>

                        <input placeholder="" #searchString>
                        <button style="margin-left: 10px" type="button" class="btn btn-primary"
                                (click)="filterMembers(searchString.value,addUserModalProjectID )"><i
                                class="fa fa-search"></i> Search Member
                        </button>

                        <br>
                        <br>
                        <strong>Please note</strong> that if you can not find the user, he is not a member of the de.NBI
                        vo. In that case you can invite him by sending him
                        the following link:
                        <br>
                        <br>
                        <ul>
                            <li>Invite Member
                                <pre>{{invitation_group_pre}}{{addUserModalRealName }}</pre>
                            </li>
                        </ul>
                    </div>

                    <div class="table-responsive">
                        <table *ngIf="filteredMembers!==null" class="table table-bordered table-striped table-sm">
                            <thead>

                            <th></th>
                            <th>first name</th>
                            <th>last name</th>
                            <th>Email</th>
                            </thead>
                            <tbody *ngFor="  let member of filteredMembers">
                            <td>
                                <button
                                        (click)="addMember(addUserModalProjectID,member['member_id'],member['firstName'],member['lastName']);filteredMembers=null;addUserModalProjectID = -1; addUserModal.hide();notificationModal.show();"
                                        class="btn btn-primary"><i class="fa fa-plus"></i> Add Member
                                </button>
                                <button style="padding-left: 10px;margin-left: 10px"
                                        (click)="addAdmin(addUserModalProjectID,member['member_id'],member['user_id'],member['firstName'],member['lastName']);filteredMembers=null;addUserModalProjectID = -1; addUserModal.hide();notificationModal.show();"
                                        class="btn btn-primary"><i class="fa fa-plus"></i> Add Admin
                                </button>
                            </td>
                            <td>{{member['firstName']}}</td>
                            <td>{{member['lastName']}}</td>
                            <td>{{member['mail']}}</td>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <!--  <button type="button" (click)="addUserModal.hide();
                                                  notificationModal.show();
                                                  addMember(addUserModalProjectID, addMemberID.value)" class="btn btn-success"><i class="fa fa-dot-circle-o"></i>
                      Add User
                  </button> -->
                <button type="button" (click)="addUserModalProjectID = -1;filteredMembers=null; addUserModal.hide();"
                        type="reset"
                        class="btn  btn-danger"><i class="fa fa-ban"></i> Close
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #removeMemberModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="Label"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"></h4>
                <button type="button" class="close" style="cursor:pointer" (click)="removeMemberModal.hide()"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div *ngIf="UserModalFacility == null ">
                    In order to remove a user of your project please send the following information to cloud@denbi.de:
                    <ul>
                        <li>Projekt name</li>
                        <li>Projekt description</li>
                        <li>Your user id</li>
                        <li>The user id of the project member you would like to remove</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" (click)="removeMemberModal.hide();" type="reset"
                            class="btn  btn-secondary"> Close
                    </button>
                </div>

            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #notificationModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="Label"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">{{ notificationModalTitle }}</h4>
                <button type="button" class="close" style="cursor:pointer" (click)="notificationModal.hide()"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert alert-{{ notificationModalType }}" role="alert">
                    {{ notificationModalMessage }}
                </div>
            </div>
            <div class="modal-footer">
                <button *ngIf="notificationModalIsClosable == true" type="button"
                        (click)="resetNotificaitonModal(); notificationModal.hide();" type="reset"
                        class="btn  btn-secondary"> Close
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #verifyModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="Label"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Change Password</h4>
                <button type="button" class="close" style="cursor:pointer" (click)="verifyModal.hide()"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div class="alert alert-warning" role="alert">
                    Are you sure you want to change your password?
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn  btn-success mr-auto col-md-4"
                        (click)="verifyModal.hide();setUserFacilityPassword(UserModalFacility[0],UserModalFacilityDetails);passwordModal.show(); resetFacilityDetailsModal();">
                    Yes
                </button>
                <button class="btn  btn-danger col-md-4" type="reset"
                        (click)="verifyModal.hide()">Cancel
                </button>
            </div>

        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div bsModal #passwordModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="Label"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">{{ passwordModalTitle }}</h4>
                <button type="button" class="close" style="cursor:pointer" (click)="passwordModal.hide()"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert alert-{{ passwordModalType }}" role="alert">
                    <div *ngIf="passwordModalType=='info'">
                        Please wait...
                    </div>
                    <div *ngIf="passwordModalType=='success'">
                        <h5>Password successfully set!</h5>
                        <p> Your new password for the {{passwordModalFacility}} facility is:</p>
                        <pre>{{passwordModalPassword}}</pre>
                        <p>Please be aware that you have to remember this password.</p>
                        <p>However you can always request a new one.</p>
                    </div>
                    <div *ngIf="passwordModalType=='warning'">
                        <p>Please contact {{passwordModalEmail}} in order to set or change your password.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button"
                        (click)="resetPasswordModal(); passwordModal.hide();" type="reset"
                        class="btn  btn-secondary"> Close
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div bsModal #descriptionModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-info" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Description</h4>
                <button type="button" class="close" style="cursor: pointer" (click)="descriptionModal.hide()"
                        aria-label="Close">

                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <p>{{ selectedProject?.Description }}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary"
                        (click)="selectedProject=undefined;descriptionModal.hide();">
                    Close
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>

<div bsModal #infoModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-info modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Details</h4>
                <button type="button" class="close" style="cursor: pointer" (click)="infoModal.hide()"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <div *ngIf="!details_loaded" style="text-align: center"><i class="fa fa-spinner fa-spin"
                                                                           style="font-size:100px; margin: auto;margin-left: auto;margin-right: auto"></i>
                </div>
                <div class="table-responsive">
                    <table *ngIf="details_loaded" class="table table-striped">
                        <thead>
                        <th>Description</th>
                        <th>Date created (d/m/y)</th>
                        <th>Expiration Date (d/m/y)</th>
                        <th>Days running</th>
                        <th>Lifetime in Days</th>
                        </thead>
                        <tbody>
                        <td>
                            <button class="btn btn-secondary"
                                    (click)="infoModal.hide();descriptionModal.show();">Show
                                Description
                            </button>
                        </td>

                        <td>{{ selectedProject?.DateCreated }}</td>
                        <td>{{selectedProject?.DateEnd}}</td>
                        <td>{{ selectedProject?.DaysRunning }}</td>
                        <td>{{selectedProject?.LifetimeDays}}</td>
                        <td>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" (click)="selectedProject=undefined;infoModal.hide();">
                    Close
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>


<div bsModal #applicationModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Applications for {{selectedProject?.Name}}</h4>
                <button type="button" class="close" style="cursor: pointer;" (click)="applicationModal.hide()"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div *ngIf="!loaded" style="text-align: center"><i class="fa fa-spinner fa-spin"
                                                                   style="font-size:100px; margin: auto;margin-left: auto;margin-right: auto"></i>
                </div>

                <div *ngIf="loaded" class="table-responsive">
                    <table class="table table-bordered table-striped table-sm">
                        <thead>

                        <th>Name</th>
                        <th>Date Submitted</th>
                        <th>Actions</th>
                        </thead>
                        <tbody *ngFor="  let application of selectedProject?.ProjectMemberApplications">

                        <td>{{application.Name}}</td>
                        <td>{{application.DateCreated}}</td>
                        <td>
                            <button
                                    (click)="approveMemberApplication(selectedProject?.Id,application.Id,application.Name); "
                                    class="btn btn-success"><i class="fa fa-check"></i> Approve
                            </button>
                            <button style="margin-left: 10px"
                                    (click)="application_action='rejected';application_member_name=application.Name;rejectMemberApplication(selectedProject?.Id,application.Id,application.Name); "
                                    class="btn btn-danger"><i class="fa fa-times"></i> Reject
                            </button>
                        </td>
                        </tbody>
                    </table>
                </div>
            </div>


            <div class="modal-footer">

                <p *ngIf="application_action_success && application_action_done" class="alert alert-success mr-auto">
                    <strong>Success:</strong> Succesfully {{application_action}} the application of
                    {{application_member_name}}.
                </p>
                <p *ngIf="!application_action_success && application_action_done && !application_action_error_message"
                   class="alert alert-danger mr-auto">
                    <strong>Failed:</strong> The application of {{application_member_name}} could not be
                    {{application_action}} .
                </p>
                <p *ngIf="!application_action_success && application_action_done && application_action_error_message"
                   class="alert alert-danger mr-auto">
                    <strong>Failed:</strong> User didn't verify his email address yet. Please wait until the email is
                    verified.
                </p>
                <button type="button" class="btn btn-primary"
                        (click)="loadProjectApplications(selectedProject?.Id)">
                    Refresh
                </button>
                <button type="button" class="btn btn-secondary"
                        (click)="application_action_error_message=null;application_action_done=false;selectedProject=undefined;applicationModal.hide();">
                    Close
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>

