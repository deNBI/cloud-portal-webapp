<div class="animated fadeIn">
  <div class="card" style=" ">

    <div class="card-header">
      <div class="row">
        <div *ngIf="is_vo_admin || is_facility_manager" class="col-6">


          <button style="margin: 5px"
                  class="btn btn-primary"
                  (click)="toggleTab('own');applyFilter();">Own Machines
          </button>

          <button *ngIf="is_vo_admin" style="margin: 5px"
                  class="btn btn-primary"
                  (click)="toggleTab('all');applyFilter();">All Machines
          </button>
          <button style="margin: 5px"
                  class="btn btn-primary"
                  (click)="toggleTab('facility');applyFilter();">Machines of your facilities
          </button>


        </div>
        <div *ngIf="tab=='facility'" class="col-4"><select [(ngModel)]="selectedFacility"
                                                           class="form-control " name="selectedFacility">
          <option *ngFor="  let facility of managerFacilities"
                  [ngValue]="facility">
            {{facility['Facility']}}
          </option>

        </select></div>
      </div>

    </div>
    <div class="row justify-content-end" style="margin-bottom: 5px !important;padding-right: 15px;padding-left: 15px;">
      <div class="col container-fluid" style="margin: 10px 0 0 0;" *ngIf="total_pages > 1">
        <pagination
          [totalItems]="total_items" [itemsPerPage]="items_per_page"
          (pageChanged)="pageChanged($event)" [(ngModel)]="currentPage"
          [boundaryLinks]="true" [maxSize]="5" [rotate]="false" #pagination>
        </pagination>
      </div>
      <div class="input-group col-3">
        <input id="vm_per_site" class="form-control" style="margin: 10px 0 0 0;"
               name="vm_per_site" placeholder="e.g 3"
               type="number" min="1" max="25" step="1"
               appMinAmount="1" appMaxAmount="25" appInteger
               pattern="^([1-9]|1[012])$" [(ngModel)]="vm_per_site" (ngModelChange)="vmPerPageChange.next($event)">
        <div class="input-group-append mb-3" style="margin: 10px 0 0 0;"><span class="input-group-text"> VMs per page
                                    </span></div>
      </div>
    </div>

    <div class="container-fluid">

        <div class="row">

          <div class="col-10 input-group">
            <div class="input-group-prepend">
              <div class="input-group-text" *ngIf="is_vo_admin || cluster_allowed">
                <input type="checkbox" [checked]="filter_cluster" style="margin:2px;"
                       (change)="filter_cluster=!filter_cluster">
                <span class="badge badge-info">Cluster</span>
              </div>
              <div class="input-group-text">
                <input type="checkbox" [checked]="filter_set_for_termination" style="margin:2px;"
                       (change)="filter_set_for_termination=!filter_set_for_termination">
                <span class="badge badge-info">Set for termination</span>
              </div>
              <div class="input-group-text">
                <input type="checkbox" checked style="margin:2px;"
                       (change)="changeFilterStatus(VirtualMachineStates.staticACTIVE)">
                <span class="badge badge-success">{{VirtualMachineStates.staticACTIVE}}</span>
              </div>
              <div class="input-group-text">
                <input type="checkbox" checked style="margin:2px;"
                       (change)="changeFilterStatus(VirtualMachineStates.staticSHUTOFF)">
                <span class="badge badge-warning">{{VirtualMachineStates.staticSHUTOFF}}</span>
              </div>
              <div class="input-group-text">
                <input type="checkbox" style="margin:2px;"
                       (change)="changeFilterStatus(VirtualMachineStates.staticDELETED)">
                <span class="badge badge-danger">{{VirtualMachineStates.staticDELETED}}</span>
              </div>
            </div>
              <div class="input-group-text col-5">
                <input type="text" checked style="margin:2px;" placeholder="user,project,elixir_id,openstackid,name,flavor"
                       [(ngModel)]="filter" style="width:100%">
              </div>
            <div class="input-group-append">
              <button class="btn btn-outline-primary"(click)="applyFilter()">Filter</button>
            </div>

          </div>

          <div class="col-2">
            <div *ngIf="vms_content.length > 0">
              <div class="dropdown" dropdown>
                <button class="btn btn-secondary dropdown-toggle" type="button" id="actionDropdownMenu" data-toggle="dropdown"
                        type="button" aria-haspopup="true" aria-expanded="false" aria-controls="dropdown-split"
                        dropdownToggle id="vmActionsDropdown" style="width:100%">
                  Actions
                </button>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu" role="menu"
                     *dropdownMenu id="dropdownMenu">
                  <button class="dropdown-item btn btn-secondary" id="deleteAllSelectedVMsButton"
                          (click)="setToBeDeletedVms(); verifyAllModal.show()">
                    Delete selected VMs</button>
                </div>
              </div>
            </div>
          </div>

        </div>

      <div *ngIf="isSearching" id="search_spinner" style="margin:10px; padding:10px;">
        <div class="spinner-border text-primary" style="display:block; margin:auto;"></div>
      </div>

      <div class="row" *ngFor="let vm of vms_content; first as isFirst;"
           [formGroup]="actionsForm"
           id="vm_overview_table">
        <div class="col-md-12">
          <div class="card instance-card" style="margin-bottom:15px;" [id]="'instanceCard_' + vm?.name">
            <div class="card-header" *ngIf="isFirst">
              <div class="row">
                <div class="col-5"><strong>Instance Name</strong></div>
                <div class="col-3" style="text-align: center"><strong>Project</strong></div>
                <div class="col-2" style="text-align: center"><strong>Created (by/at)</strong></div>
                <div class="col-1" style="left:50px;">
                  <input class="form-check-input" type="checkbox" formControlName="selectAll" style="bottom: 3px;"><strong style="margin-left: 2px;">Select all</strong>
                </div>

              </div>
            </div>
            <div class="card-block">
              <div class="row" style="margin-top: 5px">
                <div class="col-5" style="margin: auto;">

                  <a class="h5 text-primary"  style="margin-left: 10px" id="detail_{{vm.name}}"
                     *ngIf="vm?.status == VirtualMachineStates.staticACTIVE
                     || vm?.status == VirtualMachineStates.staticSHUTOFF;
                      else statusElseBlock"
                     [routerLink]="['/virtualmachines/detail/' + vm?.openstackid]">{{vm?.name}}  </a>
                  <ng-template #statusElseBlock><span class="h5 text-primary" id="detail_{{vm.name}}"
                                                      style="margin-left: 10px">{{vm?.name}}  </span></ng-template>
                  <app-vmstatus [vm]="vm"></app-vmstatus>

                </div>

                <div class="col-3" style="margin: auto; text-align: center">
                  <a [routerLink]="['/project-management/' + vm?.application_id]" target="_blank"><strong>{{vm?.project}}</strong></a>
                </div>
                <div class="col-2" style="margin: auto; text-align: center">
                  {{vm?.userlogin}}
                  <br>
                  {{vm?.created_at}}
                </div>
                <div class="col-1">
                  <div class="form-check">

                    <ng-container formArrayName="vmActions" *ngFor="let genre of actionsForm.controls['vmActions'].controls; let i = index">

                      <input type="checkbox" [formControlName]="i.toString()" *ngIf="vmActions[i].name == vm?.name
                      && (vm?.status == VirtualMachineStates.staticACTIVE || vm?.status == VirtualMachineStates.staticSHUTOFF)"
                             [id]="'selectCheckBox_'+ i">
                    </ng-container>
                  </div>
                </div>
                <div class="col-1" style="text-align: center"></div>
              </div>
              <div style="margin-top: 10px; margin-bottom:5px;">
                <div class="row" style="margin-left: 10px; font-size: 18px; line-height: 27px; height: 27px"
                  *ngIf="vm.status === VirtualMachineStates.staticACTIVE || vm.status === VirtualMachineStates.staticSHUTOFF">
                  <div *ngIf="vm.volumes?.length > 0" class="col-md-1">
                      <span class="fas fa-hdd" style="font-size: 18px;"
                            data-toggle="tooltip" data-placement="right"
                            title="{{'Volumes mounted: ' + vm?.volumes?.length}}">
                        <span class="badge badge-pill badge-secondary"
                              style="font-size: 10px; position: relative; top: -12px; left: -10px;">
                          {{vm?.volumes.length}}</span>
                      </span>
                  </div>
                  <div *ngIf="vm?.res_env_url" class="col-md-1">
                      <span class="fas fa-globe" style="font-size: 18px; cursor: pointer;" data-toggle="tooltip" data-placement="right"
                         title="{{'Research Environment installed: ' + resenvInformationByVM[vm.name]}}"
                            (click)="this.copyToClipboard(vm?.res_env_url); this.showCopiedMessage(vm.name);">
                          <span class="badge badge-pill badge-secondary" id="{{vm.name + 'resenvSpan'}}"
                              style="font-size: 10px; position: relative; top: -12px; left: -10px;">
                            <i class="fas fa-check" *ngIf="vm.status === VirtualMachineStates.staticACTIVE"></i>
                            <i class="fas fa-times" *ngIf="vm.status === VirtualMachineStates.staticSHUTOFF"></i>
                          </span>
                      </span>
                  </div>
                  <div *ngIf="condaPackagesByVM[vm?.openstackid]" class="col-md-1">
                      <span class="fas fa-box" style="font-size: 18px;" data-toggle="tooltip" data-placement="right"
                            title="One installed Conda-Package" *ngIf="condaPackagesByVM[vm?.openstackid] === 1">
                          <span class="badge badge-pill badge-secondary"
                                style="font-size: 10px; position: relative; top: -12px; left: -10px;">
                          {{this.condaPackagesByVM[vm.openstackid].toString()}}
                          </span>
                      </span>
                      <span class="fas fa-boxes" style="font-size: 18px;" data-toggle="tooltip" data-placement="right"
                          title="{{'Number of Conda Packages installed: ' + this.condaPackagesByVM[vm.openstackid].toString()}}"
                          *ngIf="condaPackagesByVM[vm?.openstackid] > 1">
                          <span class="badge badge-pill badge-secondary"
                                style="font-size: 10px; position: relative; top: -12px; left: -10px;">
                          {{this.condaPackagesByVM[vm.openstackid].toString()}}
                          </span>
                      </span>
                  </div>
                  <div *ngIf="vm?.cluster.cluster_id" class="col-md-1">
                      <span class="fas fa-network-wired" style="font-size: 18px;" data-toggle="tooltip" data-placement="right"
                            title="{{'Master node of cluster with ' + vm?.cluster.worker_instances?.length.toString() + ' slaves'}}" (click)="this.copyToClipboard(vm?.res_env_url)">
                          <span class="badge badge-pill badge-secondary"
                                style="font-size: 10px; position: relative; top: -12px; left: -10px;">
                            {{vm?.cluster.worker_instances?.length.toString()}}
                          </span>
                      </span>
                  </div>


                </div>
                <div class="col-1"></div>
                <div class="col-11" style="margin-left: 10px">
                  <div style="font-size: small">
                    <strong>{{vm?.flavor?.name}}</strong>: {{vm?.flavor?.vcpus + ' VCPUs - ' }}{{vm?.flavor?.ram + ' GB RAM - '}}{{vm?.flavor?.rootdisk + ' GB root disk'}}
                  </div>
                </div>
                <div class="col-12" style="margin-left: 10px">
                  <div style="font-size: small">
                    <strong>Image</strong>: {{vm?.image}}
                  </div>
                </div>
                <div *ngIf="vm?.error_msg !== '' && vm?.error_msg !== undefined && vm?.error_msg !== null" class="col-12" style="margin-left: 10px">
                  <div style="font-size: small">
                    <strong>Error: {{vm?.error_msg}}</strong>
                  </div>
                </div>
                <div *ngIf="vm?.cluster?.cluster_id" class="col-12" style="margin-left: 10px" [ngSwitch]="vm?.cluster?.status">
                  <div style="font-size: small">
                    <strong>Cluster</strong>:


                    <a style="margin-left: 10px"

                       [routerLink]="['/virtualmachines/cluster/' + vm?.cluster.cluster_id]">{{vm?.cluster.cluster_id}}  </a>

                    <ng-container *ngSwitchCase="'Running'">
                      <div [id]="'running_cluster_' + vm?.name"
                           class="dot-colorless bg-success">
                      </div>
                    </ng-container>
                    <ng-container *ngSwitchCase="'Creating'">
                      <div [id]="'creating_cluster_' + vm?.name"
                           class="dot-colorless bg-warning">
                      </div>
                    </ng-container>
                    <ng-container *ngSwitchCase="'Configuring'">
                      <div [id]="'configuring_cluster_' + vm?.name"
                           class="dot-colorless bg-info">
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-body p-x-1 py-h"
                 *ngIf="vm?.status == this.VirtualMachineStates.staticACTIVE || vm?.status == this.VirtualMachineStates.staticSHUTOFF">
              <div class="row">
                <div class="col-4">
                  <a class="font-weight-bold font-xs btn-block text-muted btn btn-outline-secondary"
                     [id]="'showDetailsButton_'+vm?.name"
                     [routerLink]="['/virtualmachines/detail/' + vm?.openstackid]">Show VM details</a>
                </div>
                <div class="col-4"
                     *ngIf="vm.status != this.VirtualMachineStates.staticDELETED && vm.status != this.VirtualMachineStates.staticSHUTOFF">
                  <a class="font-weight-bold font-xs btn-block text-muted btn btn-outline-secondary" *ngIf="vm.cardState!= 1"
                     [id]="'showHowToConnectButton_'+vm?.name"
                     (click)="selectedVm=vm; vm.cardState=1" href="#" onClick="return false;">
                    How to connect ...</a>

                  <a class="font-weight-bold font-xs btn-block btn btn-secondary" *ngIf="vm.cardState==1"
                     [id]="'hideHowToConnectButton_'+vm?.name"
                     (click)="selectedVm=vm; vm.cardState=0;" href="#" onClick="return false;">
                    ... Hide information</a>
                </div>
                <div class="col-4" *ngIf="vm.status != this.VirtualMachineStates.staticDELETED">
                  <a class="font-weight-bold font-xs btn-block text-muted btn btn-outline-secondary" *ngIf="vm.cardState!=2"
                     [id]="'showActionsButton_'+vm?.name"
                     (click)="selectedVm=vm; vm.cardState=2;" href="#" onClick="return false;">
                    Show actions ...</a>

                  <a class="font-weight-bold font-xs btn-block btn btn-secondary" *ngIf="vm.cardState==2"
                     [id]="'hideActionsButton_'+vm?.name"
                     (click)="selectedVm=vm; vm.cardState=0;" href="#" onClick="return false;">
                    ... Hide actions</a>
                </div>


              </div>
            </div>
            <div class="card-footer p-x-1 py-h"
                 *ngIf="(vm?.status ==  this.VirtualMachineStates.staticACTIVE|| vm?.status == this.VirtualMachineStates.staticSHUTOFF) && vm?.cardState != 0">
              <div *ngIf="vm?.cardState == 1">
                <div class="row" *ngFor="let mode of vm?.modes">
                  <div class="col-md-1">
                    <span class="font-weight-bold font-xs btn-block text-muted">{{mode.name}}:</span>
                  </div>
                  <div class="col-md-9">
                    <span class="font-weight-bold font-xs btn-block text-muted"  [innerHTML]="mode.description"></span></div>

                  <div class="col-md-2" style="margin: auto" *ngIf="mode.copy_field && mode.copy_field!=''">
                    <div class="font-weight-bold font-xs btn-block text-muted btn btn-outline-secondary"
                    (click)="copyToClipboard(mode.copy_field)">Copy command</div>
                  </div>
                </div>


                <div class="row" *ngIf="vm?.res_env_url != '' && vm?.res_env_url != null && vm?.res_env_url != undefined && resenv_by_play(vm)">
                  <div class="col-md-1">
                    <span class="font-weight-bold font-xs btn-block text-muted">Research Environment:</span>
                  </div>
                  <div class="col-md-11 font-weight-bold font-xs btn-block text-muted">
                    <a href="{{vm?.res_env_url}}" target="_blank">{{vm?.res_env_url}}</a>
                    <br>
                    For RStudio credentials please visit: <a href="{{WIKI_RSTUDIO_LINK}}" target="_blank">{{WIKI_RSTUDIO_LINK}}</a>
                    <br>
                    For Apache Guacamole credentials please visit: <a href="{{WIKI_GUACAMOLE_LINK}}" target="_blank">{{WIKI_GUACAMOLE_LINK}}</a>
                  </div>
                </div>
              </div>

              <div *ngIf="vm?.cardState == 2">
                <div class="row">
                  <div class="col-md-2"
                       *ngIf="vm.status != this.VirtualMachineStates.staticSHUTOFF && vm.status != this.VirtualMachineStates.staticDELETED">
                    <div class="font-weight-bold font-xs btn-block text-muted btn btn-outline-secondary"
                         [id]="'checkStatusVMButton_' + vm?.name" (click)="checkStatus(vm);">
                      Check status
                    </div>
                  </div>
                  <div class="col-md-2" *ngIf="vm.status ==this.VirtualMachineStates.staticACTIVE">
                    <div class="font-weight-bold font-xs btn-block text-muted btn btn-outline-secondary"
                         [id]="'attachVolume' + vm?.name"
                         (click)="selectedVm=vm;volume_to_attach == undefined;getDetachedVolumesByVSelectedMProject();attachModal.show();">
                      Attach Volume
                    </div>
                  </div>
                  <div class="col-md-2"
                       *ngIf="vm.status ==this.VirtualMachineStates.staticACTIVE && vm?.volumes.length > 0">
                    <div class="font-weight-bold font-xs btn-block text-muted btn btn-outline-secondary"
                         [id]="'attachVolume' + vm?.name"
                         (click)="selectedVm=vm;volume_to_detach == undefined;detachModal.show();">
                      Detach Volume
                    </div>
                  </div>
                  <div class="col-md-2" *ngIf="vm.status ==this.VirtualMachineStates.staticACTIVE">
                    <div class="font-weight-bold font-xs btn-block text-muted btn btn-outline-secondary"
                         [id]="'stopVMButton_' + vm?.name" (click)="selectedVm=vm;submitStopVmModal.show();">
                      Stop VM
                    </div>
                  </div>
                  <div class="col-md-2" *ngIf="vm.status ==this.VirtualMachineStates.staticSHUTOFF">
                    <div class="font-weight-bold font-xs btn-block text-muted btn btn-outline-secondary"
                         [id]="'restartVMButton_' + vm?.name" (click)="selectedVm=vm;submitRestartModal.show();">
                      Resume VM
                    </div>
                  </div>
                  <div class="col-md-2"
                       *ngIf="vm.client.features['VM_REBOOT'] && vm.status != this.VirtualMachineStates.staticDELETED">
                    <div class="font-weight-bold font-xs btn-block text-muted btn btn-outline-secondary"
                       [id]="'chooseRebootVMButton_' + vm?.name" (click)="selectedVm=vm; chooseRebootOptionModal.show();">
                      Reboot VM
                    </div>
                  </div>
                  <div class="col-md-2" *ngIf="vm.status != this.VirtualMachineStates.staticDELETED">
                    <div class="font-weight-bold font-xs btn-block text-muted btn btn-outline-secondary"
                       [id]="'createSnapshotVMButton_' + vm?.name"
                       (click)="snapshot_vm=vm;resetSnapshotResult();snapshotModal.show();">
                      Create Snapshot
                    </div>
                  </div>
                  <div class="col-md-2" *ngIf="vm.status != this.VirtualMachineStates.staticDELETED">
                    <div class="font-weight-bold font-xs btn-block text-muted btn btn-outline-secondary"
                         style="margin-top: 5px;"
                         [id]="'deleteVMButton_' + vm?.name" (click)="selectedVm=vm;verifyModal.show();">
                      Delete VM
                    </div>
                  </div>


                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
      <div *ngIf="vms_content?.length === 0 && !isSearching" class="row col-md-10 alert alert-info" style="margin:10px;">There are no machines to show.</div>
    </div>
  </div>

</div>

<div bsModal #stopModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true"
     id="stop_modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" *ngIf="status_changed == 0"> Waiting </h4>
        <h4 class="modal-title" *ngIf="status_changed == 1"> Success </h4>
        <h4 class="modal-title" *ngIf="status_changed == 2"> Error </h4>
        <button type="button" class="close" style="cursor:pointer"
                (click)="stopModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info" role="alert"
             *ngIf="status_changed == 0 &&  selectedVm?.status != this.VirtualMachineStates.staticSHUTOFF">
          Stopping {{selectedVm?.name}}... <i class="fa fa-spinner fa-spin"
                                              style="font-size:24px"></i>
        </div>
        <div class="alert alert-success" role="alert"
             *ngIf="status_changed == 1 || selectedVm?.status == this.VirtualMachineStates.staticSHUTOFF"
             id="stop_success_div">
          {{selectedVm?.name}} was successfully stopped.
        </div>
      </div>
      <div class="alert alert-warning" role="alert" *ngIf="status_changed == 2">
        When stopping {{selectedVm?.name}} an error occurred.<br>
        {{ERROR_MSG}}
      </div>


      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="close_stop_modal"
                (click)="status_changed=0;selectedVm=null;stopModal.hide()">Close
        </button>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #rebootModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title"><strong>{{reboot_type}}</strong> reboot
          {{selectedVm?.name}} </h4>

        <button type="button" class="close" style="cursor:pointer"
                (click)="rebootModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning" role="alert">

          Restarted instances will lose any data not saved in persistent storage.
          Are you sure to <strong>{{reboot_type}}</strong> reboot {{selectedVm?.name}}?
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn  btn-success col-md-4"
                (click)="rebootVm(selectedVm,reboot_type);rebootModal.hide();rebootResultModal.show()">
          Yes
        </button>
        <button class="btn  btn-danger col-md-4" type="reset"
                (click)="selectedVm=null;rebootModal.hide();">Cancel
        </button>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #rebootResultModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title"><strong>{{reboot_type}}</strong> reboot
          {{selectedVm?.name}} </h4>

        <button type="button" class="close" style="cursor:pointer"
                (click)="rebootResultModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div *ngIf="!reboot_done">
          <div class="alert alert-info" role="alert">

            Waiting until rebooted..
          </div>
        </div>
        <div *ngIf="reboot_done">
          <div class="alert alert-success" role="alert">

            Successfully {{reboot_type}} rebooted {{selectedVm?.name}}.
          </div>
        </div>
        <div *ngIf="status_check_error">
          <div class="alert alert-warning" role="alert">

            An error occurred when checking the status of {{selectedVm?.name}}.<br>
            {{ERROR_MSG}}
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn  btn-success col-md-4"
                (click)="selectedVm=null;rebootResultModal.hide();">
          Close
        </button>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #resumeModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true"
     id="resume_modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" *ngIf="status_changed == 0"> Waiting </h4>
        <h4 class="modal-title" *ngIf="status_changed == 1"> Success </h4>
        <h4 class="modal-title" *ngIf="status_changed == 2"> Error </h4>
        <button type="button" class="close" style="cursor:pointer"
                (click)="resumeModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info" role="alert"
             *ngIf="status_changed == 0  && selectedVm?.status !== this.VirtualMachineStates.staticACTIVE">
          Starting {{selectedVm?.name}}... <i class="fa fa-spinner fa-spin"
                                              style="font-size:24px"></i>
        </div>
        <div class="alert alert-success" role="alert"
             *ngIf="status_changed == 1  || selectedVm?.status == this.VirtualMachineStates.staticACTIVE"
             id="resume_success_div">
          {{selectedVm?.name}} was successfully started.
        </div>
      </div>
      <div class="alert alert-warning" role="alert" *ngIf="status_changed == 2">
        When starting {{selectedVm?.name}} an error occurred:<br>
        {{ERROR_MSG}}
      </div>


      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="close_resume_modal"
                (click)="status_changed=0;resumeModal.hide()">Close
        </button>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #deleteModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true"
     id="delete_modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" *ngIf="status_changed == 0"> Waiting </h4>
        <h4 class="modal-title" *ngIf="status_changed == 1"> Success </h4>
        <h4 class="modal-title" *ngIf="status_changed == 2"> Error </h4>
        <button type="button" class="close" style="cursor:pointer"
                (click)="selectedVm=null;deleteModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info" role="alert" *ngIf="status_changed == 0">
          Deleting {{selectedVm?.name}}... <i class="fa fa-spinner fa-spin"
                                              style="font-size:24px"></i>
        </div>
        <div class="alert alert-success" role="alert" *ngIf="status_changed == 1"
             id="delete_success_div">
          {{selectedVm?.name}} was succesfully deleted.
        </div>
      </div>
      <div class="alert alert-warning" role="alert" *ngIf="status_changed == 2">
        When deleting {{selectedVm?.name}} an error occured:<br>
        {{ERROR_MSG}}
      </div>


      <div class="modal-footer">
        <button type="button" class="btn btn-secondary"
                (click)="selectedVm=null;status_changed=0;deleteModal.hide()"
                id="close_delete_modal">Close
        </button>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #verifyAllModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true"
     id="verify_all_modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Delete the following VM</h4>
        <button type="button" class="close" style="cursor: pointer"
                (click)="verifyAllModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning" role="alert">
          Are you sure you want to delete:
          <div *ngFor="let vm of selectedMachines">
            {{vm?.name}}
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button class="btn  btn-success col-md-4"
                (click)="deleteAll();verifyAllModal.hide();"
                id="confirm_delete_all_button">
          Yes
        </button>
        <button class="btn  btn-danger col-md-4" type="reset"
                (click)="verifyAllModal.hide();">Cancel
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #deleteAllModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true"
     id="delete_all_modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" *ngIf="status_changed == 0"> Waiting </h4>
        <h4 class="modal-title" *ngIf="status_changed == 1"> Success </h4>
        <button type="button" class="close" style="cursor:pointer"
                (click)="selectedVm=null;deleteAllModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Deletion status:
        <ng-container *ngFor="let vm of selectedMachines">
          <div class="alert alert-warning" *ngIf="vm?.status != VirtualMachineStates.staticDELETED">
            Deleting {{vm?.name}} <i class="fa fa-spinner fa-spin"
                                     style="font-size:24px"></i>
          </div>
          <div class="alert alert-success" *ngIf="vm?.status == VirtualMachineStates.staticDELETED">
            Deleted {{vm?.name}}
          </div>
        </ng-container>
      </div>


      <div class="modal-footer">
        <button type="button" class="btn btn-secondary"
                (click)="status_changed=0;deleteAllModal.hide()"
                id="close_delete_all_modal">Close
        </button>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #verifyModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true"
     id="verify_modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Delete VM</h4>
        <button type="button" class="close" style="cursor: pointer"
                (click)="verifyModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning" role="alert">
          Are you sure you want to delete {{selectedVm?.name}}?
          </div>

         <div class="alert alert-danger" *ngIf="selectedVm?.openstackid == selectedVm?.cluster?.master_instance_openstack_id" role="alert">
          If you delete the master of a cluster, your worker machines become useless!
        </div>

      </div>
      <div class="modal-footer">
        <button class="btn  btn-success col-md-4"
                (click)="deleteVm(selectedVm);verifyModal.hide()"
                id="confirm_delete_button">
          Yes
        </button>
        <button class="btn  btn-danger col-md-4" type="reset"
                (click)="selectedVm=null;verifyModal.hide();">Cancel
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #snapshotModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true"
     id="snapshot_name_modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Create Snapshot</h4>
        <button type="button" class="close" style="cursor:pointer"
                (click)="snapshotModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <div
        ><strong>Snapshot Name*</strong></div>

        <div>
          <input type="text" style="width: 100%" placeholder="Snapshot Name" [(ngModel)]="snapshotName"
                 (ngModelChange)="snapshotSearchTerm.next($event);" id="snapshot_name_input">

        </div>
        <div>
          <p *ngIf="!validSnapshotNameBool && snapshotName.length > 0 && snapshotNameCheckDone"
             style="color: red">This name is already in use, please use a different
            one.</p></div>

        <br>
        <div
        ><strong>Description</strong></div>
        <div><textarea style="width: 100%" type="textfield" placeholder="Description"
                       #snapshotDescription></textarea></div>
        <div class="alert alert-info" role="alert">
          A snapshot is an image which preserves the disk state of a running instance.
        </div>


      </div>
      <div class="modal-footer">
        <button class="btn  btn-success col-md-4" id="snapshot_create_modal_button"
                [disabled]="!validSnapshotNameBool"
                (click)="createSnapshot(snapshot_vm,snapshotName,snapshotDescription.value);snapshotModal.hide();snapshotResult.show()">
          Create Snapshot
        </button>
        <button class="btn  btn-danger col-md-4" type="reset"
                (click)="snapshotName=''; validSnapshotNameBool=false;snapshotModal.hide()">
          Cancel
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div bsModal #snapshotResult="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true"
     id="snapshot_result_modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Snapshot</h4>
        <button type="button" class="close" style="cursor:pointer"
                (click)="snapshotResult.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info" role="alert" *ngIf="snapshotDone == 'Waiting' ">
          Wait until Snapshot is queued....
        </div>


        <div class="alert alert-success" role="alert" *ngIf="snapshotDone == 'true' " id="snapshot_done">
          Successfully queued Snapshot.
          It might take some minutes till you can use it for starting a new instance at the "New Instance" tab.
          You can see the current status in the<a
          routerLinkActive="active"
          [routerLink]="['/virtualmachines/snapshotOverview']"> Snapshot Overview </a>.
        </div>
        <div class="alert alert-danger" role="alert"
             *ngIf="snapshotDone != 'true' && snapshotDone != 'Waiting'">
          An error occured when creating the snapshot.<br>
          {{ERROR_MSG}}

          <pre>{{snapshotDone}}</pre>
        </div>


      </div>
      <div class="modal-footer">
        <button class="btn  btn-danger col-md-4" type="reset" id="snapshot_result_modal_close"
                (click)="snapshotName=''; validSnapshotNameBool=false;snapshotResult.hide();">
          Close
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<!--<div bsModal #infoModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-info modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">How to connect</h4>
        <button type="button" class="close" style="cursor:pointer"
                (click)="infoModal.hide();"
                aria-label="Close">
          <span aria-hidden="true"></span>
        </button>
      </div>
      <div class="modal-body">
        <app-how-to-connect *ngIf="selectedVm" [selectedVirtualMachine]="selectedVm"></app-how-to-connect>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="infoModal.hide();">Close
        </button>
      </div>
    </div>&lt;!&ndash; /.modal-content &ndash;&gt;
  </div>&lt;!&ndash; /.modal-dialog &ndash;&gt;
</div>
-->
<div bsModal #chooseRebootOptionModal="bs-modal" class="modal fade" tabindex="1" role="dialog"
     [id]="chooseRebootOptionModal"
     aria-labeledby="cromlabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Choose Reboot Type for: {{selectedVm?.name}}</h4>
        <button type="button" class="close" style="cursor:pointer"
                (click)="chooseRebootOptionModal.hide();" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <div class="row" style="margin:auto; text-align:left; padding: 5px;">The following Reboot types are available
          for machine {{selectedVm?.name}}:
        </div>
        <div class="row" style="margin:5px; text-align: center; padding: 10px;">
          <div class="col-md-6">
            <button type="button" class="btn btn-primary"
                    *ngIf="selectedVm?.status != this.VirtualMachineStates.staticDELETED && selectedVm?.status != this.VirtualMachineStates.staticSHUTOFF && selectedVm?.client.features['VM_REBOOT']"
                    [id]="'softRebootVM_' + selectedVm?.name"
                    (click)="status_check_error=false;reboot_done=false;reboot_type='SOFT';chooseRebootOptionModal.hide();rebootModal.show();">
              Soft Reboot
            </button>
          </div>
          <div class="col-md-6">
            <button type="button" class="btn btn-primary"
                    [id]="'hardRebootVM_' + selectedVm?.name"
                    *ngIf="selectedVm?.status != this.VirtualMachineStates.staticDELETED && selectedVm?.client.features['VM_REBOOT']"
                    (click)="status_check_error=false;reboot_done=false;reboot_type='HARD'; chooseRebootOptionModal.hide(); rebootModal.show();"
            >
              Hard Reboot
            </button>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="chooseRebootOptionModal.hide();"
                [id]="'closeRebootOptionModalButton'">Close
        </button>
      </div>
    </div>
  </div>
</div>

<div bsModal #submitStopVmModal="bs-modal" class="modal fade" tabindex="1" role="dialog" id="submitStopVmModal"
     aria-labeledby="cromlabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Stop VM</h4>
        <button type="button" class="close" style="cursor: pointer"
                (click)="submitStopVmModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning" role="alert">
          Are you sure you want to stop {{selectedVm?.name}}?
        </div>

      </div>
      <div class="modal-footer">
        <button class="btn  btn-success col-md-4"
                (click)="stopVm(selectedVm);submitStopVmModal.hide();"
                [id]="'verifyStopButton'">
          Yes
        </button>
        <button class="btn  btn-danger col-md-4" type="reset" [id]="'verifyStopCancelButton'"
                (click)="submitStopVmModal.hide();">Cancel
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>

<div bsModal #submitRestartModal="bs-modal" class="modal fade" tabindex="1" role="dialog" id="submitRestartModal"
     aria-labeledby="cromlabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Restart VM</h4>
        <button type="button" class="close" style="cursor: pointer"
                (click)="submitRestartModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning" role="alert">
          Are you sure you want to restart {{selectedVm?.name}}?
        </div>

      </div>
      <div class="modal-footer">
        <button class="btn  btn-success col-md-4"
                (click)="resumeVM(selectedVm);submitRestartModal.hide();"
                [id]="'verifyRestartButton'">
          Yes
        </button>
        <button class="btn  btn-danger col-md-4" type="reset" [id]="'verifyRestartCancelButton'"
                (click)="submitRestartModal.hide();">Cancel
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>

<div bsModal #detachModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Detach Volume</h4>
        <button type="button" class="close" style="cursor: pointer"
                (click)="detachModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <strong>Which volume should be detached from {{selectedVm?.name}}?</strong>

        <select class="form-control col-md-6" name="selected_vm"
                [(ngModel)]="volume_to_detach">
          <option value="undefined" disabled selected hidden> Please Select</option>
          <option *ngFor="let vol of selectedVm?.volumes" [ngValue]="vol"> {{vol.volume_name}} ({{vol.volume_storage}}
            GB)
          </option>

        </select>


      </div>
      <div class="modal-footer">
        <button class="btn  btn-success col-md-4"
                [disabled]="selectedVm== undefined || volume_to_detach == undefined"
                (click)="detachVolume(volume_to_detach,selectedVm);detachModal.hide();">
          Detach Volume
        </button>

        <button class="btn  btn-danger col-md-4" type="reset"
                (click)="selectedVm=undefined;volume_to_detach=undefined;detachModal.hide();">Cancel
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div bsModal #attachModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="Label"
     aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Attach Volume</h4>
        <button type="button" class="close" style="cursor: pointer"
                (click)="attachModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div

          class="alert alert-warning" role="alert">

          The volume must still be <a
          href="{{WIKI_MOUNT_VOLUME}}" target="_blank"> mounted </a> after the attaching to use it.
        </div>
        <strong>Which volume should be attached?</strong>

        <select class="form-control col-md-6" name="selected_vm"
                [(ngModel)]="volume_to_attach">
          <option value="undefined" disabled selected hidden> Please Select</option>
          <option *ngFor="let vol of detached_project_volumes" [ngValue]="vol"> {{vol.volume_name}}
            ({{vol.volume_storage}} GB)
          </option>

        </select>


      </div>
      <div class="modal-footer">
        <button class="btn  btn-success col-md-4"
                [disabled]="selectedVm== undefined || volume_to_attach == undefined"
                (click)="attachVolume(volume_to_attach,selectedVm);attachModal.hide();">
          Attach Volume
        </button>

        <button class="btn  btn-danger col-md-4" type="reset"
                (click)="selectedVm=undefined;volume_to_attach == undefined;attachModal.hide();">Cancel
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
