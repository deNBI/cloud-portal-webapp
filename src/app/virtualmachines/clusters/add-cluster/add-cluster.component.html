<div *ngIf="isLoaded && userinfo?.PublicKey == 'None'">
  <div>
    <div class="card">
      <div class="card-header">
        <i class="fa fa-align-justify"></i> Public Key
      </div>

      <div class="card-body">

        <div style="padding:5px" class="alert alert-info"><strong>Info: </strong>
          You need to set a valid SSH Key before you can start a machine. Please set a
          valid key below or on
          your <a
            href="#/userinfo">personal data page</a>.
        </div>
        <div style="width: 100%" class="table-responsive">
          <table class="table table-striped">

            <tr app-public-key [userinfo]="userinfo"></tr>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf=" isLoaded==false" class="loader"></div>
<div *ngIf=" isLoaded && userinfo?.PublicKey != 'None' && projects.length == 0">
  <div class="alert alert-warning" role="alert">
    You are not a member of any Simple VM project.
  </div>
</div>
<div *ngIf=" isLoaded && userinfo?.PublicKey != 'None' && projects.length > 0" class="animated fadeIn">

  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header">
          <strong>New Cluster</strong>
          â€“ Form
        </div>

        <div class="card-body">


          <form id="application_form" #f="ngForm"
                class="form-horizontal">
            <div class="form-group row">
              <label class="col-md-2 form-control-label"><strong>Project*</strong></label>
              <span *ngIf="client_avaiable && !projectDataLoaded" class="spinner-border text-info"></span>


              <div class="col-md-8">
                <select required class="form-control" name="projectSelect"
                        [(ngModel)]="selectedProject" id="projectSelect"
                        (ngModelChange)="getSelectedProjectClient(); resetChecks();"
                >
                  <option value="undefined" disabled selected hidden> Please
                    Select
                  </option>
                  <option *ngFor="let project of projects" [ngValue]="project"
                          id="id_option_{{project[0]}}">
                    {{project[0]}}
                  </option>

                </select>


              </div>

            </div>
            <div *ngIf="client_avaiable && projectDataLoaded">
              <app-resource-overview [selectedProjectCoresMax]="selectedProjectCoresMax"
                                     [selectedProjectCoresUsed]="selectedProjectCoresUsed"
                                     [selectedProjectDiskspaceMax]="selectedProjectDiskspaceMax"
                                     [selectedProjectDiskspaceUsed]="selectedProjectDiskspaceUsed"
                                     [selectedProjectGPUsMax]="selectedProjectGPUsMax"
                                     [selectedProjectGPUsUsed]="selectedProjectGPUsUsed"
                                     [selectedProjectRamMax]="selectedProjectRamMax"
                                     [selectedProjectRamUsed]="selectedProjectRamUsed"
                                     [selectedProjectVmsMax]="selectedProjectVmsMax"
                                     [selectedProjectVmsUsed]="selectedProjectVmsUsed"
                                     [selectedProjectVolumesMax]="selectedProjectVolumesMax"
                                     [selectedProjectVolumesUsed]="selectedProjectVolumesUsed"></app-resource-overview>
              <div class="alert alert-primary" role="alert"
                   *ngIf="selectedProject && selectedProjectVmsUsed >= selectedProjectVmsMax">
                The limit for virtual machines has been reached for this project.
                Your principal investigator can request more
                resources if necessary.

              </div>
              <div class="alert alert-primary" role="alert"
                   *ngIf="selectedProject && selectedProjectVmsUsed < selectedProjectVmsMax && flavors_loaded && flavors.length == 0 && !selectedFlavor">
                There are too few cores and not enough ram available for this project to start a new machine.
                Your principal investigator can request more
                resources if necessary.
              </div>


              <div *ngIf="selectedProjectVmsUsed < selectedProjectVmsMax && (flavors?.length > 0 || selectedFlavor)">
                <accordion class="col-md-12">

                  <accordion-group #masterInstanceGroup
                                   *ngIf="selectedProject && projectDataLoaded && selectedProjectVmsUsed < selectedProjectVmsMax && (flavors.length != 0 || selectedFlavor)">
                    <div accordion-heading style="width: 100%; cursor: pointer"><strong>Master Instance</strong>
                      <i class="pull-right float-right" style="font-size: 25px" [ngClass]="{
                            'icon-arrow-up': masterInstanceGroup.isOpen, 'icon-arrow-down': !masterInstanceGroup.isOpen}"></i>
                    </div>
                    <div *ngIf="selectedProject" class="form-group row col-md-12">
                      <label class="col-md-2 form-control-label"><strong>Flavor*</strong></label>
                      <div class="col-md-10">


                        <app-flavor-detail [selectedFlavor]="selectedMasterFlavor"
                                           [flavors]="flavors"
                                           (selectedFlavorChange)="selectedMasterFlavor=$event"
                                           id="id_flavor_detail"></app-flavor-detail>

                      </div>


                    </div>


                    <div *ngIf="selectedProject" class="form-group row col-md-12">
                      <label class="col-md-2 form-control-label"><strong>Image*</strong></label>
                      <div class="col-md-10">


                        <app-image-detail [selectedImage]="selectedMasterImage"
                                          [images]="images"
                                          (selectedImageChange)="selectedMasterImage=$event"
                                          id="id_image_detail"></app-image-detail>
                      </div>
                    </div>


                  </accordion-group>
                </accordion>
              </div>
            </div>

          </form>

        </div>

        <div
          *ngIf="((!gaveOkay && hasTools) || !selectedImage || (!selectedFlavor && flavors.length != 0 ))&& projectDataLoaded  && flavors_loaded  && selectedProjectVmsUsed < selectedProjectVmsMax"
          class="alert alert-danger" role="alert" style="max-width: 600px;margin: 0 auto;">
          <p>Please choose the following before starting a VM:</p>
          <p *ngIf="!selectedFlavor">- The flavor type of your VM
          </p>
          <p *ngIf="!selectedImage">- The image you want to run on your VM
          </p>
          <p *ngIf="diskspace > 0 && !volumeName">- A name for your storage volume
          </p>
          <p *ngIf="!gaveOkay && hasTools">- Give your okay to the Bioconda install process

          </p>
        </div>
        <div class="form-group row"
             *ngIf="projectDataLoaded && selectedProjectVmsUsed < selectedProjectVmsMax && (flavors?.length > 0  || selectedFlavor)">

          <button style=" margin-left: auto;margin-top: 25px;
    margin-right: auto;
    width: 8em" id="startVMButton"

                  type="button"

                  [disabled]="!vm_name || started_machine || !selectedFlavor || !selectedImage|| (diskspace > 0 && volumeName == '')"
                  class="btn btn-primary  .btn-lg offset-md-8"
                  data-toggle="modal"
                  (click)="startVM(selectedFlavor.name,selectedImage.name,f.controls.instance_name.value,selectedProject[0],selectedProject[1]);resetData();resetProgressBar;infoModal.show();">
            Start VM
          </button>
        </div>


        <div class="alert alert-danger"
             *ngIf="isLoaded && !client_avaiable && selectedProject && client_checked">The
          corresponding client is currently offline.
          If you have any questions please contact cloud@denbi.de.
        </div>


      </div>

      <!--/.col-->

    </div>
  </div>
  <div class="col-md-6">

  </div>

</div>

