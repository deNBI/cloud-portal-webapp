<div class="card-body">
	<h5 class="card-title">Add testimonial draft</h5>
	<div class="row">
		<div class="col-md-auto mx-auto">
			<div class="alert alert-info">
				An overview of the testimonials already published can be found
				<a href="{{ TESTIMONIAL_PAGE_LINK }}" target="_blank" rel="noopener norefferer">here</a>. For both the text and
				the excerpt, you can use the examples found there as a guide.
				<hr />
				<strong>On the procedure:</strong>
				<p>
					All information entered here is verified before the testimonial is available online. We reserve the right to
					adjust the information entered. In this case, the responsible person will be contacted and the adjusted
					information must be accepted by mutual consent. In the case of adjustments, no testimonial will be published
					without the explicit consent of the author or an appropriately responsible person.
				</p>
				<hr />
				<p>
					<strong>Note</strong>: The information entered in this form will be publicly available after it was
					successfully reviewed.
				</p>
			</div>
		</div>
	</div>
</div>
<div class="card-body" *ngIf="!testimonialSent && testimonialFormGroup && !this.hideTestimonialForm">
	<form id="testimonialForm" [formGroup]="testimonialFormGroup" class="form-horizontal">
		<div class="form-group row">
			<div class="col-md-4">
				<label class="col-md-4 form-control-label">
					<strong
						>Title*
						<i class="icon-question" data-toggle="tooltip" title="The title of your testimonial"> </i>
					</strong>
				</label>
			</div>

			<div class="col-md-8">
				<div class="input-group">
					<input
						class="form-control"
						name="testimonial_title"
						required
						id="testimonial_title"
						formControlName="testimonial_title"
						placeholder="NA"
						type="text"
						[ngClass]="{
							'is-invalid': testimonialFormGroup.controls.testimonial_title?.invalid,
							'is-valid': testimonialFormGroup.controls.testimonial_title?.valid
						}"
					/>
				</div>
			</div>
		</div>
		<div class="form-group row">
			<div class="col-md-4">
				<label class="col-md-4 form-control-label">
					<strong
						>Text*
						<i class="icon-question" data-toggle="tooltip" title="The text of your testimonial"> </i>
					</strong>
				</label>
			</div>

			<div class="col-md-8">
				<div class="input-group">
					<textarea
						required
						[ngClass]="{
							'is-invalid': testimonialFormGroup.controls.testimonial_text?.invalid,
							'is-valid': testimonialFormGroup.controls.testimonial_text?.valid
						}"
						class="form-control"
						name="testimonial_text"
						formControlName="testimonial_text"
						id="testimonial_text"
					></textarea>
				</div>
			</div>
		</div>

		<div class="form-group row">
			<div class="col-md-4">
				<label class="col-md-4 form-control-label">
					<strong
						>Excerpt*
						<i class="icon-question" data-toggle="tooltip" title="The excerpt of your testimonial"> </i>
					</strong>
				</label>
			</div>

			<div class="col-md-8">
				<div class="input-group">
					<textarea
						class="form-control"
						name="testimonial_excerpt"
						formControlName="testimonial_excerpt"
						id="testimonial_excerpt"
						required
						[ngClass]="{
							'is-invalid': testimonialFormGroup.controls.testimonial_excerpt?.invalid,
							'is-valid': testimonialFormGroup.controls.testimonial_excerpt?.valid
						}"
					></textarea>
				</div>
			</div>
		</div>

		<div class="form-group row">
			<div class="col-md-4">
				<label class="col-md-4 form-control-label">
					<strong
						>Contributor*
						<i
							class="icon-question"
							data-toggle="tooltip"
							title="The responsible person in whose name the testimonial is to be published."
						>
						</i>
					</strong>
				</label>
			</div>

			<div class="col-md-8">
				<div class="input-group">
					<input
						class="form-control"
						name="testimonial_contributor"
						formControlName="testimonial_contributor"
						id="testimonial_contributor"
						placeholder="NA"
						type="text"
						required
						[ngClass]="{
							'is-invalid': testimonialFormGroup.controls.testimonial_contributor?.invalid,
							'is-valid': testimonialFormGroup.controls.testimonial_contributor?.valid
						}"
					/>
				</div>
			</div>
		</div>

		<div class="form-group row">
			<div class="col-md-4">
				<label class="col-md-4 form-control-label">
					<strong
						>Institute*
						<i
							class="icon-question"
							data-toggle="tooltip"
							title="The institute at which the working group is active in whose name the testimonial is to be published."
						>
						</i>
					</strong>
				</label>
			</div>

			<div class="col-md-8">
				<div class="input-group">
					<input
						class="form-control"
						name="testimonial_institution"
						formControlName="testimonial_institution"
						id="testimonial_institution"
						placeholder="NA"
						type="text"
						required
						[ngClass]="{
							'is-invalid': testimonialFormGroup.controls.testimonial_instituton?.invalid,
							'is-valid': testimonialFormGroup.controls.testimonial_institution?.valid
						}"
					/>
				</div>
			</div>
		</div>

		<div class="form-group row">
			<div class="col-md-4">
				<label class="col-md-4 form-control-label">
					<strong
						>Workgroup*
						<i class="icon-question" data-toggle="tooltip" title="The working group behind the project."> </i>
					</strong>
				</label>
			</div>

			<div class="col-md-8">
				<div class="input-group">
					<input
						class="form-control"
						name="testimonial_workgroup"
						formControlName="testimonial_workgroup"
						id="testimonial_workgroup"
						placeholder="NA"
						type="text"
						required
						[ngClass]="{
							'is-invalid': testimonialFormGroup.controls.testimonial_workgroup?.invalid,
							'is-valid': testimonialFormGroup.controls.testimonial_workgroup?.valid
						}"
					/>
				</div>
			</div>
		</div>

		<div class="form-group row">
			<div class="col-md-4">
				<label class="col-md-4 form-control-label">
					<strong
						>Photography*
						<i
							class="icon-question"
							data-toggle="tooltip"
							title="An image of the working group, the PI or the person in whose name the testimonial is to be published."
						>
						</i>
					</strong>
				</label>
			</div>

			<div class="col-md-8">
				<div class="input-group">
					<div class="custom-file">
						<input
							type="file"
							class="custom-file-input"
							(change)="adjustFile($event)"
							accept="image/png, image/jpeg"
							lang="en"
							id="testimonialPhotoInput"
						/>
						<label class="custom-file-label" for="testimonialPhotoInput">{{ file ? file.name : 'Choose Image' }}</label>
					</div>
				</div>
			</div>
		</div>
	</form>
</div>
<div class="card-body" *ngIf="hideTestimonialForm">
	<div class="alert alert-info">
		Another user of your project is making changes to this form. To avoid inconsistencies, several people cannot work on
		this form at the same time. If the user does not make any further changes to the entries, this form is released
		again.
		<strong>You may try again in a few minutes - reload the page for this.</strong>
	</div>
</div>
<div class="card-body" *ngIf="testimonialSent">
	<div class="alert alert-info">
		As a testimonial has already been submitted for your project, we ask for your understanding that you cannot submit
		another draft here. If you would still like to submit a testimonial, please contact the helpdesk via
		<a class="alert-link" href="mailto:{{ CLOUD_PORTAL_SUPPORT_MAIL }}">{{ CLOUD_PORTAL_SUPPORT_MAIL }}</a
		>.
	</div>
</div>
<div
	class="card-body"
	*ngIf="!testimonialSent && !this.hideTestimonialForm && (testimonialFormGroup?.invalid || !this.file)"
>
	<hr />
	<ul class="list-group list-group-flush">
		<li class="list-group-item" *ngIf="testimonialFormGroup?.controls['testimonial_title'].invalid">
			Please provide a title.
		</li>
		<li class="list-group-item" *ngIf="testimonialFormGroup?.controls['testimonial_text'].invalid">
			Please provide a longer text.
		</li>
		<li class="list-group-item" *ngIf="testimonialFormGroup?.controls['testimonial_excerpt'].invalid">
			Please provide an excerpt, which is at least 50 characters long but does not exceed 1000 characters.
		</li>
		<li class="list-group-item" *ngIf="testimonialFormGroup?.controls['testimonial_contributor'].invalid">
			Please provide a contributor.
		</li>
		<li class="list-group-item" *ngIf="testimonialFormGroup?.controls['testimonial_institution'].invalid">
			Please provide an institution.
		</li>
		<li class="list-group-item" *ngIf="testimonialFormGroup?.controls['testimonial_workgroup'].invalid">
			Please provide a workgroup.
		</li>
		<li class="list-group-item" *ngIf="!this.file">Please provide a valid image file.</li>
	</ul>
</div>
<div class="card-footer">
	<div class="row">
		<div class="col-md-auto">
			<div class="btn-group">
				<button
					class="btn btn-success"
					[disabled]="testimonialSent || testimonialFormGroup?.invalid || !this.file"
					(click)="sendTestimonial()"
				>
					Submit testimonial
				</button>
			</div>
		</div>
		<div class="col-md-auto align-content-end mt-2" *ngIf="autoSaveInProgress">
			<span class="badge badge-dark">
				<div class="spinner-border spinner-border-sm text-success" role="status">
					<span class="sr-only">Autosaving...</span>
				</div>
				<span class="p-2 mb-2">Autosaving ...</span>
			</span>
		</div>
		<div class="col-md-auto align-content-end mt-2" *ngIf="showAutosaveSucess">
			<span class="badge badge-success">
				<span class="p-2 mb-2">Autosaving successfull</span>
			</span>
		</div>
	</div>
</div>

<div
	bsModal
	#testimonialModal="bs-modal"
	class="modal fade"
	tabindex="-1"
	role="dialog"
	aria-labelledby="Label"
	aria-hidden="true"
>
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<div class="modal-title">
					{{ submissionSuccessful ? 'Testimonial submitted successfully' : 'Submission of testimonial failed!' }}
				</div>
				<button
					type="button"
					class="close"
					style="cursor: pointer"
					(click)="testimonialModal.hide()"
					aria-label="Close"
				>
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="alert alert-{{ submissionSuccessful ? 'success' : 'danger' }}">
					{{
						submissionSuccessful
							? 'Thank you for the submission! The submission of the testimonial was successful. The corresponding data will now be checked.'
							: 'An error has occurred. Check the data you entered and try again at a different time.'
					}}
				</div>
			</div>
			<div class="modal-footer">
				<button class="btn btn-{{ submissionSuccessful ? 'success' : 'danger' }}" (click)="testimonialModal.hide()">
					Close
				</button>
			</div>
		</div>
	</div>
</div>
