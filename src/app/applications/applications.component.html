<div class="animated fadeIn" ng-app>
    <div class="row">
        <!--/.col-->
        <h1>Applications Overview</h1>
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <i class="fa fa-align-justify"></i> Your applications
                </div>
                <div class="card-block" *ngIf="user_applications.length == 0">
                    <div class="alert alert-success" role="alert">
                        <strong>No Applications!</strong> You have no applications in review.
                    </div>
                </div>
                <div *ngIf="user_applications.length > 0" class="card-block">
                  <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Short Name</th>
                            <th>Lifetime</th>
                            <th>Date submitted</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <ng-container *ngFor="let application of user_applications">
                            <tr>
                                <td>{{ application.Name }}</td>
                                <td>{{application.Shortname}}</td>
                                <td>{{ application.Lifetime }}</td>
                                <td>{{ application.DateSubmitted }}</td>
                                <td>{{ application.Status }}</td>
                                <td>

                                    <button (click)="switchCollapseStatus('user_application-' + application.Id)"
                                            type="button" class="btn btn-secondary">
                                        <i class="fa fa-info-circle"></i>&nbsp;
                                        <span [hidden]="!getCollapseStatus('user_application-' + application.Id)">Show</span><span
                                            [hidden]="getCollapseStatus('user_application-' + application.Id)">Hide</span>
                                        Information
                                    </button>

                                    <button (click)="deleteModal.show();setDeleteId(application.Id)" type="button"
                                            class="btn btn-secondary">
                                        Remove Application
                                    </button>
                                </td>
                            </tr>

                            <tr>
                                <td [class.collapse_no_margin]="getCollapseStatus('user_application-' + application.Id)"
                                    colspan="6">
                                    <div id="user_application-{{ application.Id }}"
                                         [class.collapse]="getCollapseStatus('user_application-' + application.Id)">
                                        <div class="table-responsive">
                                        <table class="table table-striped">
                                            <tr>
                                                <td>Description</td>
                                                <td>{{ application.Description }}</td>
                                            </tr>
                                            <tr>
                                                <td>Comment</td>
                                                <td>{{ application.Comment }}</td>
                                            </tr>
                                            <tr>
                                                <td>VMs</td>
                                                <td>{{ application.VMsRequested }} VMs</td>
                                            </tr>
                                            <tr *ngIf="application.OpenStackProject">
                                                <td>Cores/VM</td>
                                                <td>{{ application.CoresPerVM }} Cores per VM</td>
                                            </tr>
                                            <tr  *ngIf="application.OpenStackProject">
                                                <td>RAM</td>
                                                <td>{{ application.RamPerVM }} GB</td>
                                            </tr>
                                            <tr>
                                                <td>Storage Limit</td>
                                                <td>{{ application.VolumeLimit }} GB</td>
                                            </tr>
                                            <tr>
                                                <td>Volume Counter</td>
                                                <td>{{ application.VolumeCounter }} GB</td>
                                            </tr>
                                            <tr  *ngIf="application.OpenStackProject">
                                                <td>ObjectStorage</td>
                                                <td>{{ application.ObjectStorage }} GB</td>
                                            </tr>
                                            <tr  *ngIf="application.OpenStackProject">
                                                <td>Special Hardware</td>
                                                <td><span style="margin-right: 5px;" class="badge badge-primary"
                                                          *ngFor="let sh of application.SpecialHardware">{{ sh["special_hardware_name"] }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>OpenStackProject</td>
                                                <td>{{application.OpenStackProject}}</td>
                                            </tr>
                                        </table>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </ng-container>
                        </tbody>
                    </table>
                  </div>
                </div>

            </div>
        </div>

        <div *ngIf="is_vo_admin == true" class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <i class="fa fa-align-justify"></i> Applications for review
                </div>
                <div class="card-block" *ngIf="this.activeApplicationsAvailable() == false">
                    <div class="alert alert-success" role="alert">
                        <strong>No new Applications!</strong> There are no new project applications for review.
                    </div>
                </div>

                <div *ngIf="this.activeApplicationsAvailable() == true" class="card-block">
                  <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Short Name</th>
                            <th>Date submitted</th>
                            <th>User</th>
                            <th>Institute</th>
                            <th>Compute Center</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <ng-container *ngFor="let application of all_applications">
                            <ng-container *ngIf="application.Status == 1">
                                <tr>
                                    <td>{{ application.Name }}</td>
                                    <td>{{application.Shortname}}</td>
                                    <td>{{ application.DateSubmitted }}</td>
                                    <td style="word-wrap: break-word;min-width: 110px; max-width: 130px; white-space: normal">
                                        {{ application.User }}
                                    </td>
                                    <td>{{application.Institute}}</td>

                                    <td>
                                        <select class="form-control" #selectedComputeCenter>
                                            <option value="undefined" selected> no center</option>
                                            <option *ngFor="let computeCenter of computeCenters"
                                                    value="{{computeCenter[1]}}"> {{computeCenter[0]}}
                                            </option>
                                        </select>
                                    </td>


                                    <td>
                                        <button

                                                (click)='resetNotificationModal();createGroup(application.Shortname, application.Description, application.UserEmail, application.Id,selectedComputeCenter.value,application.OpenStackProject,application.VMsRequested,application.VolumeLimit,application.Lifetime,application.Name,application.VolumeCounter ); notificationModal.show();'


                                                type="button" class="btn btn-secondary"><i class="fa fa-check"></i>&nbsp;
                                            Approve
                                            & Create
                                        </button>

                                        <button (click)='declineApplication(application.Id)'
                                                type="button" class="btn btn-secondary"><i class="fa fa-close"></i>&nbsp;
                                            Decline
                                        </button>


                                        <button (click)="switchCollapseStatus('application_review-' + application.Id)"
                                                type="button" class="btn btn-secondary">
                                            <i class="fa fa-info-circle"></i>&nbsp;
                                            <span [hidden]="!getCollapseStatus('application_review-' + application.Id)">Show</span><span
                                                [hidden]="getCollapseStatus('application_review-' + application.Id)">Hide</span>
                                            Information
                                        </button>
                                    </td>
                                </tr>

                                <tr>
                                    <td [class.collapse_no_margin]="getCollapseStatus('application_review-' + application.Id)"
                                        colspan="6">
                                        <div id="application_review-{{ application.Id }}"
                                             [class.collapse]="getCollapseStatus('application_review-' + application.Id)">
                                          <div class="table-responsive">
                                            <table class="table table-striped">
                                                <tr>
                                                    <td>Description</td>
                                                    <td>{{ application.Description }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Comment</td>
                                                    <td>{{ application.Comment }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Workgroup</td>
                                                    <td>{{ application.Workgroup }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Lifetime</td>
                                                    <td>{{ application.Lifetime }} months</td>
                                                </tr>
                                                <tr>
                                                    <td>VMs</td>
                                                    <td>{{ application.VMsRequested }} VMs</td>
                                                </tr>
                                                <tr  *ngIf="application.OpenStackProject">
                                                    <td>Cores/VM</td>
                                                    <td>{{ application.CoresPerVM }} Cores per VM</td>
                                                </tr>
                                                <tr  *ngIf="application.OpenStackProject">
                                                    <td>RAM</td>
                                                    <td>{{ application.RamPerVM }} GB</td>
                                                </tr>
                                                <tr>
                                                    <td>Storage Limit</td>
                                                    <td>{{ application.VolumeLimit }} GB</td>
                                                </tr>
                                                <tr>
                                                    <td>Volume Counter</td>
                                                    <td>{{ application.VolumeCounter }} GB</td>
                                                </tr>
                                                <tr  *ngIf="application.OpenStackProject">
                                                    <td>ObjectStorage</td>
                                                    <td>{{ application.ObjectStorage }} GB</td>
                                                </tr>
                                                <tr  *ngIf="application.OpenStackProject">
                                                    <td>Special Hardware</td>
                                                    <td><span style="margin-right: 5px;" class="badge badge-primary"
                                                              *ngFor="let sh of application.SpecialHardware">{{ sh["special_hardware_name"] }}</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>OpenStackProject</td>
                                                    <td>{{application.OpenStackProject}}</td>
                                                </tr>
                                                <tr>
                                                    <td>Last status changed</td>
                                                    <td>{{ application.DateStatusChanged }}</td>
                                                </tr>


                                            </table>
                                          </div>
                                        </div>
                                    </td>
                                </tr>
                            </ng-container>
                        </ng-container>
                        </tbody>
                    </table>
                  </div>
                </div>

            </div>
        </div>

        <div *ngIf="is_vo_admin == true" class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <i class="fa fa-align-justify"></i> Application history
                </div>
                <div class="card-block" *ngIf="all_applications.length == 0">
                    <div class="alert alert-warning" role="alert">
                        <strong>No Applications!</strong> There are no applications at all!
                    </div>
                </div>

                <div *ngIf="all_applications.length > 0" class="card-block">
                  <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                        <tr>

                            <th>Project Name</th>
                            <th>Short Name</th>
                            <th>Date submitted</th>
                            <th>User</th>
                            <th>Institute</th>
                            <th>Facility</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <ng-container *ngFor="let application of all_applications">
                            <ng-container *ngIf="application.Status != 1">
                                <tr [ngStyle]="{'color':lifeTimeReached(application.Lifetime,application.DaysRunning,application.DateStatusChanged)}">
                                    <td>{{ application.Name }}</td>
                                    <td>{{application.Shortname}}</td>
                                    <td>{{ application.DateSubmitted }}</td>
                                    <td>{{ application.User }}</td>
                                    <td>{{ application.Institute }}</td>
                                    <td>{{application.ComputeCenter[0]}}</td>
                                    <td>{{ getStatusById(application.Status) }}</td>
                                    <td>
                                        <button (click)="switchCollapseStatus('application_history-' + application.Id)"
                                                type="button" class="btn btn-secondary">
                                            <i class="fa fa-info-circle"></i>&nbsp;
                                            <span [hidden]="!getCollapseStatus('application_history-' + application.Id)">Show</span><span
                                                [hidden]="getCollapseStatus('application_history-' + application.Id)">Hide</span>
                                            Information
                                        </button>
                                    </td>
                                </tr>
                                <tr [ngStyle]="{'color':lifeTimeReached(application.Lifetime,application.DaysRunning)}">
                                    <td [class.collapse_no_margin]="getCollapseStatus('application_history-' + application.Id)"
                                        colspan="6">
                                        <div id="application_history-{{ application.Id }}"
                                             [class.collapse]="getCollapseStatus('application_history-' + application.Id)">
                                          <div class="table-responsive">
                                            <table class="table table-striped">
                                                <tr>
                                                    <td>Description</td>
                                                    <td>{{ application.Description }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Comment</td>
                                                    <td>{{ application.Comment }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Workgroup</td>
                                                    <td>{{ application.Workgroup }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Lifetime</td>
                                                    <td>{{ application.Lifetime }}</td>
                                                </tr>
                                                <tr>
                                                    <td>VMs</td>
                                                    <td>{{ application.VMsRequested }}</td>
                                                </tr>
                                                <tr  *ngIf="application.OpenStackProject">
                                                    <td>Cores/VM</td>
                                                    <td>{{ application.CoresPerVM }}</td>
                                                </tr>
                                                <tr  *ngIf="application.OpenStackProject">
                                                    <td>RAM</td>
                                                    <td>{{ application.RamPerVM }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Storage Limit</td>
                                                    <td>{{ application.VolumeLimit }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Volume Counter</td>
                                                    <td>{{ application.VolumeCounter }} GB</td>
                                                </tr>
                                                <tr  *ngIf="application.OpenStackProject">
                                                    <td>ObjectStorage</td>
                                                    <td>{{ application.ObjectStorage }}</td>
                                                </tr>

                                                <tr  *ngIf="application.OpenStackProject">
                                                    <td>Special Hardware</td>
                                                    <td><span style="margin-right: 5px;" class="badge badge-primary"
                                                              *ngFor="let sh of application.SpecialHardware">{{ sh["special_hardware_name"] }}</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Last status changed</td>
                                                    <td>{{ application.DateStatusChanged }}</td>
                                                </tr>
                                                <tr *ngIf="application.Status == 2">
                                                    <td>DaysRunning</td>

                                                    <td>{{application.DaysRunning}}</td>

                                                </tr>
                                                <tr *ngIf="application.ComputeCenterDetails">

                                                    <td>Facility Details</td>
                                                    <td>
                                                        <ul>
                                                            <li>Name: {{application.ComputeCenter[0]}}</li>
                                                            <li *ngFor="let details of application.ComputeCenterDetails">
                                                                {{details[0]}}: <a target="_blank"
                                                                                   *ngIf="details[0] == 'Login'"
                                                                                   href="{{details[1]}}">{{details[1]}}</a>
                                                                <span *ngIf="details[0] != 'Login'">{{details[1]}}</span>
                                                            </li>
                                                        </ul>
                                                    </td>

                                                </tr>

                                            </table>
                                          </div>

                                        </div>
                                    </td>
                                </tr>

                            </ng-container>


                        </ng-container>
                        </tbody>
                    </table>
                  </div>
                </div>

            </div>
        </div>
        <!--/.col-->
    </div>
</div>

<div bsModal #notificationModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="Label"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">{{ notificationModalTitle }}</h4>
            </div>
            <div class="modal-body">
                <div class="alert alert-{{ notificationModalType }}" role="alert">
                    {{ notificationModalMessage }}
                </div>
            </div>
            <div class="modal-footer">
                <button *ngIf="notificationModalIsClosable == true" type="button"
                        (click)="notificationModal.hide();" type="reset"
                        class="btn  btn-secondary"> Close
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #deleteModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="Label"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Delete Application</h4>
            </div>
            <div class="modal-body">

                <div class="alert alert-warning" role="alert">
                    Are you sure you want to remove this application?
                </div>

            </div>
            <div class="modal-footer">
                <button class="btn  btn-success col-md-4"
                        (click)="deleteApplication(deleteId);deleteModal.hide();notificationModal.show()">
                    Yes
                </button>
                <button class="btn  btn-danger col-md-4" type="reset"
                        (click)="deleteModal.hide()">Cancel
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
