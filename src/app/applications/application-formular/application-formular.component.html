<div *ngIf="!isLoaded" class="loader"></div>

<div class="animated fadeIn" *ngIf="isLoaded">
	<div class="row">
		<div class="col-md-12">
			<!--<h1>SimpleVM Application</h1>-->
			<div class="card" style="">
				<div class="card-header">
					<strong>{{ title }}</strong>
					â€“ Form
				</div>
				<div class="card-body">
					<div class="alert alert-primary">
						<strong>Please be aware:</strong> Only applications approved by a principal investigator of a german
						university or research facility will be accepted!
					</div>
					<div class="alert alert-primary" *ngIf="openstack_project">
						If you would like to learn more about Openstack,
						<a href="{{ OPENSTACK_LINK }}" target="_blank" rel="noopener noreferrer">Click Here! </a>
					</div>
					<div *ngIf="simple_vm_project">
						<div class="alert alert-primary">
							This project mode is a beta version. Virtual machines might get lost or can not be started temporarily.
						</div>
						<div class="alert alert-primary">
							If you would like to learn more about Simple VM,
							<a href="{{ SIMPLE_VM_LINK }}" target="_blank" rel="noopener noreferrer">Click Here!</a>
						</div>
					</div>

					<div *ngIf="!production">
						<button
							type="button"
							[disabled]="test_name.length < 5"
							class="btn btn-primary"
							(click)="sendTestApplication(test_name); notificationModal.show()"
						>
							Test Application
						</button>
						<input name="test_name" placeholder="TestAppName" [(ngModel)]="test_name" />
					</div>

					<div class="form-row text-muted">
						<span><strong>*</strong> Mandatory fields</span>
					</div>

					<form id="application_form" #form="ngForm" class="form-horizontal">
						<div class="form-group row">
							<h5 class="col-md-6 form-control-label">General Information</h5>
						</div>
						<div class="form-group row" *ngIf="openstack_project">
							<label class="col-md-4"
								><strong
									>Cloud Project
									<i
										data-balloon="By choosing this project type you will have your own OpenStack project. This allows you to use any framework available in the cloud computing context."
										data-balloon-pos="right"
										data-balloon-length="large"
										><i class="icon-question menu_links" style="cursor: pointer"></i
									></i>
								</strong>
							</label>
							<div class="col-md-8">
								A cloud project is represented by an Openstack project which allows you to manage your virtual machines,
								storage and network configurations.
							</div>
						</div>
						<div class="form-group row" *ngIf="simple_vm_project">
							<label class="col-md-4">
								<strong
									>Simple Virtual Machines Project

									<i
										data-balloon="You will be able to start virtual machines through the portal with minimal
                                    effort and access them via ssh. This project type does not demand knowlegde in cloud
                                    computing."
										data-balloon-pos="right"
										data-balloon-length="large"
										><i class="icon-question" style="cursor: pointer"></i
									></i>
								</strong>
							</label>
							<div class="col-md-8">This type of project allows you to start virtual machines with SSH access.</div>
						</div>

						<div class="form-group row">
							<label
								class="col-md-4 form-control-label"
								data-test-id="project_application_name_input"
								for="id_project_application_name"
								><strong
									>Project Name<i class="fa fa-asterisk" aria-hidden="true"></i>
									<i data-balloon="Full name of your project" data-balloon-pos="right"
										><i class="icon-question" style="cursor: pointer"></i></i></strong
							></label>
							<div class="col-md-8">
								<div *ngIf="invalid_longname">
									<strong style="color: red">Please enter a name which only contains ASCII-Characters.</strong>
								</div>
								<input
									required
									type="text"
									id="id_project_application_name"
									name="project_application_name"
									pattern="[\x00-\x7F]+"
									(keyup)="checkLongname(application.project_application_name)"
									class="form-control"
									maxlength="128"
									placeholder="e.g. Assembler benchmarking based on A. thaliana genome"
									[(ngModel)]="application.project_application_name"
									[ngClass]="{
										'is-invalid':
											form.controls.project_application_name?.invalid &&
											(form.controls.project_application_name?.dirty ||
												form.controls.project_application_name?.touched),
										'is-valid':
											form.controls.project_application_name?.valid &&
											(form.controls.project_application_name?.dirty || form.controls.project_application_name?.touched)
									}"
								/>
								<span class="help-block">Name your project.</span>
							</div>
						</div>

						<div class="form-group row">
							<label
								class="col-md-4 form-control-label"
								data-test-id="project_application_shortname_input"
								for="id_project_application_shortname"
								><strong
									>Project Short Name<i class="fa fa-asterisk" aria-hidden="true"></i>
									<i
										data-balloon="Shortname of your project. This name will be referenced in OpenStack and also when you start a new virtual machine. Use between 5 and 15 characters"
										data-balloon-pos="right"
										data-balloon-length="large"
										><i class="icon-question" style="cursor: pointer"></i></i></strong
							></label>
							<div class="col-md-8">
								<div *ngIf="invalid_shortname">
									<strong
										><font color="red">Umlauts and special characters are prohibited in the shortname.</font></strong
									>
								</div>
								<input
									required
									type="text"
									id="id_project_application_shortname"
									name="project_application_shortname"
									#shortname
									(keyup)="checkShortname(shortname.value)"
									class="form-control"
									maxlength="15"
									[(ngModel)]="application.project_application_shortname"
									minlength="5"
									placeholder="e.g. ThalianaBench"
									pattern="[a-zA-Z0-9]+"
									[ngClass]="{
										'is-invalid':
											form.controls.project_application_shortname?.invalid &&
											(form.controls.project_application_shortname?.dirty ||
												form.controls.project_application_shortname?.touched),
										'is-valid':
											form.controls.project_application_shortname?.valid &&
											(form.controls.project_application_shortname?.dirty ||
												form.controls.project_application_shortname?.touched)
									}"
								/>

								<span class="help-block">Enter a short name (between 5 and 15 characters).</span>
							</div>
						</div>

						<div class="form-group row">
							<label
								class="col-md-4 form-control-label"
								data-test-id="project_application_description_input"
								for="id_project_application_description"
								><strong
									>Project Description<i class="fa fa-asterisk" aria-hidden="true"></i>
									<i
										data-balloon="Full description of your project including tools you might are going to use."
										data-balloon-pos="right"
										data-balloon-length="large"
										><i class="icon-question" style="cursor: pointer"></i></i></strong
							></label>
							<div class="col-md-8">
								<div *ngIf="invalid_description">
									<strong style="color: red">Please enter a description which only contains ASCII-Characters.</strong>
								</div>
								<textarea
									required
									id="id_project_application_description"
									name="project_application_description"
									rows="9"
									pattern="[\x00-\x7F]+"
									(keyup)="checkDescription(application.project_application_description)"
									class="form-control"
									maxlength="8192"
									placeholder="Full description. Consider to name tools you want to use."
									[(ngModel)]="application.project_application_description"
									[ngClass]="{
										'is-invalid':
											form.controls.project_application_description?.invalid &&
											(form.controls.project_application_description?.dirty ||
												form.controls.project_application_description?.touched),
										'is-valid':
											form.controls.project_application_description?.valid &&
											(form.controls.project_application_description?.dirty ||
												form.controls.project_application_description?.touched)
									}"
								></textarea>
								<span class="help-block">Describe what would you want to do in your project.</span>
								<div class="alert alert-primary">
									As more resources are requested we require a more detailed description of your project, data and used
									tools!
								</div>
							</div>
						</div>

						<div class="form-group row">
							<label class="col-md-4 form-control-label" for="id_project_application_lifetime"
								><strong
									>Desired lifetime<i class="fa fa-asterisk" aria-hidden="true"></i>
									<i data-balloon="Lifetime in months of your project" data-balloon-pos="right">
										<i class="icon-question" style="cursor: pointer"></i></i></strong
							></label>
							<div class="col-md-8">
								<div class="input-group">
									<input
										class="form-control"
										data-test-id="project_application_lifetime_input"
										id="id_project_application_lifetime"
										name="project_application_lifetime"
										placeholder="e.g 3"
										[(ngModel)]="application.project_application_lifetime"
										max="{{ max_lifetime }}"
										min="1"
										required
										step="1"
										type="number"
										appMinAmount="1"
										appMaxAmount="{{ max_lifetime }}"
										appInteger
										pattern="^([1-9]|1[012])$"
										[ngClass]="{
											'is-invalid':
												form.controls.project_application_lifetime?.invalid &&
												(form.controls.project_application_lifetime?.dirty ||
													form.controls.project_application_lifetime?.touched),
											'is-valid':
												form.controls.project_application_lifetime?.valid &&
												(form.controls.project_application_lifetime?.dirty ||
													form.controls.project_application_lifetime?.touched)
										}"
									/>
									<div class="input-group-append"><span class="input-group-text"> months </span></div>
								</div>
								<span class="help-block">How long would you like to run this project?</span>
								<div class="alert alert-primary">
									The maximum possible initial lifetime to be requested is
									<strong>{{ max_lifetime }} months.</strong> Under certain conditions, longer initial terms can also be
									granted, for example in the case the project is an <strong>NFDI</strong> project. Please click the
									corresponding options in the further course of the form and enter further information in the available
									comment and description fields if necessary. Please consider: After initially approved, you are able
									to extend your project lifetime by sending extension requests.
								</div>
							</div>
						</div>

						<div class="form-group row">
							<label
								data-test-id="project_application_workshop_input"
								class="col-md-4 form-control-label"
								for="id_project_application_workshop"
								><strong
									>Workshop
									<i
										data-balloon="Please indicate whether a workshop is to be held as part of this project."
										data-balloon-pos="right"
									>
										<i class="icon-question" style="cursor: pointer"></i></i></strong
							></label>
							<div class="col-md-8">
								<div class="input-group">
									<div class="form-check">
										<input
											class="form-check-input"
											type="checkbox"
											id="id_project_application_workshop"
											name="project_application_workshop"
											[(ngModel)]="application.project_application_workshop"
										/>
										<span class="help-block">
											Would you like to conduct a workshop with the requested resources in the context of this project?
											<span *ngIf="!openstack_project"
												>Learn more about workshops
												<a [href]="WIKI_WORKSHOPS" target="_blank" rel="noopener noreferrer">here</a>.</span
											>
										</span>
									</div>
								</div>
							</div>
						</div>

						<div class="form-group row">
							<h5 class="col-md-12 form-control-label">Resources</h5>
						</div>

						<div class="row">
							<div class="col-md-12">
								<div class="alert alert-primary" role="alert">
									<span class="fa-stack fa-lg">
										<i class="fas fa-circle fa-stack-2x"></i>
										<i class="fas fa-info fa-stack-1x fa-inverse"></i>
									</span>
									<strong
										>Note: The amount of resources requested here is not definite. You are able to request more
										resources after the approval of the project.</strong
									>
									<hr />
									Please fill in an appropriate estimation of the resources required for your project.
									<br /><strong>Please Consider:</strong> In terms of flavors, there may be slight, location-dependent
									differences in the number of VCPUs and the amount of RAM per VM, depending on the data centre
									ultimately assigned.
									<hr />
									If you are not sure how to enter the resources or need help with the terms, please look
									<a href="{{ WIKI_CLOUD_TERMS_LINK }}" rel="noopener noreferrer" target="_blank">here.</a>
								</div>
							</div>
						</div>

						<accordion>
							<ng-container *ngFor="let t of typeList; first as isFirst">
								<accordion-group *ngIf="checkIfTypeGotSimpleVmFlavor(t)" [isOpen]="isFirst" #groupval>
									<div accordion-heading style="width: 100%; cursor: pointer">
										<strong>{{ t.long_name }}</strong>
										<i
											class="pull-right float-right"
											style="font-size: 25px"
											[ngClass]="{
												'icon-arrow-up': groupval.isOpen,
												'icon-arrow-down': !groupval.isOpen
											}"
										></i>
									</div>
									<div *ngIf="isFirst" class="alert alert-primary">
										You will have default access to all flavors in the standard category.<br />
										However, your selection will determine how many machines, how many cores and how much RAM will be
										available for your project.
									</div>
									<div *ngFor="let f of flavorList; let i = index">
										<div *ngIf="f.type.shortcut === t.shortcut && f.simple_vm" class="form-group row">
											<label class="col-md-4 form-control-label" for="{{ f.name }}"
												><strong>{{ f.name }}</strong
												><br />
												Number of cores: {{ f.vcpus }}<br />
												RAM: {{ f.ram_gib }} GB<br />
												<span *ngIf="f.type.shortcut === GPU_SHORTCUT"> GPU: {{ f.gpu }} </span></label
											>
											<div class="col-md-8">
												<div class="input-group">
													<input
														class="form-control"
														id="{{ f.name }}"
														name="{{ f.name }}"
														attr.data-test-id="{{ f.type.shortcut + '_' + i }}"
														type="number"
														min="0"
														step="1"
														placeholder="0"
														[ngModel]="application?.getFlavorCounter(f)"
														#name="ngModel"
														(ngModelChange)="onChangeFlavor(f, $event)"
														appMinAmount="0"
														appInteger
														[ngClass]="{
															'is-invalid': name?.invalid,
															'is-valid': name?.valid
														}"
													/>
													<div class="input-group-append"><span class="input-group-text"> VMs </span></div>
												</div>
												<span class="help-block">Number of VMs you would like to run of this particular flavor</span>
												<div *ngIf="f?.comment" class="alert alert-primary">{{ f.comment }}</div>
											</div>
										</div>
									</div>
									<div *ngIf="t.shortcut === GPU_SHORTCUT" class="alert alert-light">
										You can check which CUDA drivers are currently supported here:<br />
										<div *ngFor="let link of gpuInformationLinks">
											<a href="{{ link[0] }}" target="_blank" rel="noopener noreferrer">{{ link[1] }}</a>
										</div>
									</div>
								</accordion-group>
							</ng-container>
						</accordion>
						<div class="form-group row">
							<label class="col-md-4 form-control-label" for="id_project_application_volume_counter"
								><strong
									>Number of storage volumes<i class="fa fa-asterisk" aria-hidden="true"></i>
									<i
										data-balloon="The number of storage volumes allowed to create. Multiple storage volumes can be attached to one VM. The sum of the volumes size equals the value provided in the storage limit field"
										data-balloon-pos="right"
										data-balloon-length="large"
										><i class="icon-question" style="cursor: pointer"></i></i></strong
							></label>
							<div class="col-md-8">
								<div class="input-group">
									<input
										required
										class="form-control"
										id="id_project_application_volume_counter"
										name="project_application_volume_counter"
										placeholder="e.g. 20"
										type="number"
										min="0"
										step="1"
										appMinAmount="0"
										appInteger
										[(ngModel)]="application.project_application_volume_counter"
										[ngClass]="{
											'is-invalid': form.controls.project_application_volume_counter?.invalid,
											'is-valid': form.controls.project_application_volume_counter?.valid
										}"
									/>
								</div>
								<span class="help-block">How many storage volumes do you want to use?</span>
							</div>
						</div>
						<div class="form-group row" [hidden]="form.controls.project_application_volume_counter?.value === 0">
							<label class="col-md-4 form-control-label" for="id_project_application_volume_limit"
								><strong>
									Volume Storage Total Limit<i class="fa fa-asterisk" aria-hidden="true"></i>
									<i
										data-balloon="Storage limit is the sum of extra storage provided by volumes."
										data-balloon-pos="right"
										data-balloon-length="large"
										><i class="icon-question" style="cursor: pointer"></i></i></strong
							></label>
							<div class="col-md-8">
								<div class="input-group">
									<input
										required
										class="form-control"
										id="id_project_application_volume_limit"
										name="project_application_volume_limit"
										data-test-id="project_application_volume_limit_input"
										placeholder="e.g. 20"
										[(ngModel)]="application.project_application_volume_limit"
										min="1"
										step="1"
										type="number"
										appInteger
										appMinAmount="1"
										[ngClass]="{
											'is-invalid': form.controls.project_application_volume_limit?.invalid,
											'is-valid': form.controls.project_application_volume_limit?.valid
										}"
										[disabled]="form.controls.project_application_volume_counter?.value === 0"
									/>
									<div class="input-group-append"><span class="input-group-text"> GB </span></div>
								</div>
								<span class="help-block">How much total extra storage do you need for your VMs?</span>
							</div>
						</div>
						<div class="form-group row" *ngIf="openstack_project">
							<label class="col-md-4 form-control-label" for="id_project_application_object_storage"
								>Object Storage
								<i
									data-balloon="Object storage is a method of storing data that does not use a directory tree internally. Object storage combines files with metadata and places it in a flat structure."
									data-balloon-pos="right"
									data-balloon-length="large"
									><i class="icon-question" style="cursor: pointer"></i></i
							></label>
							<div class="col-md-8">
								<div class="input-group">
									<input
										class="form-control"
										id="id_project_application_object_storage"
										name="project_application_object_storage"
										placeholder="e.g. 8"
										[(ngModel)]="application.project_application_object_storage"
										min="0"
										step="1"
										type="number"
										appInteger
										appMinAmount="0"
										[ngClass]="{
											'is-invalid': form.controls.project_application_object_storage?.invalid,
											'is-valid': form.controls.project_application_object_storage?.valid
										}"
									/>
									<div class="input-group-append"><span class="input-group-text"> GB </span></div>
								</div>
								<span class="help-block">How much object storage would you need?</span>
							</div>
						</div>
						<br />
						<div class="form-group row" *ngIf="extraResourceCommentRequired">
							<label class="col-md-4"></label>
							<div class="col-md-8">
								<div class="alert alert-warning" role="alert">
									<p>
										Since you have opted for GPU and/or high memory flavors which are limited resources, please explain
										why you need these specific resources and try to answer the following questions:
									</p>
									<ul>
										<li>Which of your tools require these resources?</li>
										<li>
											Why did you request the number of VMs that you specified on the form? Would it be sufficient for
											you to start with less GPU/high memory VMs?
										</li>
										<li>
											If you have chosen one of the following flavors: de.NBI highmem large/de.NBI highmem xlarge/de.NBI
											2 GPU large, please explain why it would not be possible for you to use a flavor of the same
											category with less RAM (e.g. de.NBI highmem medium).
										</li>
										<li>Did you test your tools on machines with less RAM?</li>
									</ul>
								</div>
								<div class="alert alert-danger" role="alert">
									Please note that failure to answer the questions above may result in your application being processed
									with smaller flavors.
								</div>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-md-4 form-control-label" for="id_project_application_comment"
								><strong
									>Comment<span *ngIf="extraResourceCommentRequired"
										><i class="fa fa-asterisk" aria-hidden="true"></i></span></strong
							></label>
							<div class="col-md-8">
								<textarea
									type="text"
									id="id_project_application_comment"
									name="project_application_comment"
									class="form-control"
									maxlength="8192"
									[required]="extraResourceCommentRequired"
									placeholder=""
									[(ngModel)]="application.project_application_comment"
									[ngClass]="{
										'is-invalid': form.controls.project_application_comment?.invalid || !checkValidityComment(),
										'is-valid': form.controls.project_application_comment?.valid && checkValidityComment()
									}"
								></textarea>
								<div id="project_application_comment_feedback" class="invalid-feedback" *ngIf="!checkValidityComment()">
									Please provide a more detailed description. At least 50 characters must be entered.
								</div>
								<span class="help-block">Additional information you want to share?</span>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-md-4"></label>
							<div class="col-md-8">
								<div class="alert alert-primary" role="alert">
									In case you need additional and/or special resources, which are not available in the flavor selection,
									use the comment field to state so. The same applies to unusually large amounts of resources.
								</div>
							</div>
						</div>
						<br />
						<div class="form-group row">
							<h5 class="col-md-6 form-control-label">Institutional Information</h5>
						</div>

						<div class="form-group row">
							<label
								class="col-md-4 form-control-label"
								data-test-id="project_application_institute_input"
								for="id_project_application_institute"
								><strong
									>Institute Name<i class="fa fa-asterisk" aria-hidden="true"></i>
									<i data-balloon="Your institute" data-balloon-pos="right"
										><i class="icon-question" style="cursor: pointer"></i></i></strong
							></label>
							<div class="col-md-8">
								<input
									required
									type="text"
									id="id_project_application_institute"
									name="project_application_institute"
									class="form-control"
									maxlength="256"
									placeholder="e.g. Center for Biotechnology, Bielefeld"
									[(ngModel)]="application.project_application_institute"
									[ngClass]="{
										'is-invalid':
											form.controls.project_application_institute?.invalid &&
											(form.controls.project_application_institute?.dirty ||
												form.controls.project_application_institute?.touched),
										'is-valid':
											form.controls.project_application_institute?.valid &&
											(form.controls.project_application_institute?.dirty ||
												form.controls.project_application_institute?.touched)
									}"
								/>
								<span class="help-block">To which institute do you belong? (Up to 256 characters allowed)</span>
							</div>
						</div>

						<div class="form-group row">
							<label class="col-md-4 form-control-label" for="id_project_application_workgroup"
								><strong
									>Workgroup Name<i class="fa fa-asterisk" aria-hidden="true"></i>
									<i data-balloon="Your Workgroup" data-balloon-pos="right"
										><i class="icon-question" style="cursor: pointer"></i></i></strong
							></label>
							<div class="col-md-8">
								<input
									required
									type="text"
									data-test-id="project_application_workgroup_input"
									id="id_project_application_workgroup"
									name="project_application_workgroup"
									class="form-control"
									maxlength="256"
									[(ngModel)]="application.project_application_workgroup"
									placeholder="e.g. Computational Metagenomics"
									[ngClass]="{
										'is-invalid':
											form.controls.project_application_workgroup?.invalid &&
											(form.controls.project_application_workgroup?.dirty ||
												form.controls.project_application_workgroup?.touched),
										'is-valid':
											form.controls.project_application_workgroup?.valid &&
											(form.controls.project_application_workgroup?.dirty ||
												form.controls.project_application_workgroup?.touched)
									}"
								/>
								<span class="help-block">To which workgroup do you belong? (Up to 256 characters allowed)</span>
							</div>
						</div>
						<br />
						<div class="form-group row">
							<h5 class="col-md-6 form-control-label">Additional Information</h5>
						</div>
						<div class="form-group row">
							<label class="col-md-4 form-control-label"
								><strong>Research Topics<i class="fa fa-asterisk" aria-hidden="true"></i> </strong
							></label>
							<div class="col-md-8" style="z-index: 999">
								<div
									[ngClass]="{
										'danger-border':
											application?.project_application_edam_terms?.length <= 0 ||
											application?.project_application_edam_terms?.length > 10,
										'success-border':
											application?.project_application_edam_terms?.length > 0 &&
											application?.project_application_edam_terms?.length <= 10
									}"
								>
									<ng-select
										#edam_ontology
										id="edam_input"
										data-test-id="edam_input"
										[items]="edam_ontology_terms"
										[multiple]="true"
										bindLabel="term"
										maxSelectedItems="10"
										placeholder="Please select at least one topic"
										dropdownPosition="bottom"
										[(ngModel)]="application.project_application_edam_terms"
										name="selected_edam_terms"
									>
									</ng-select>
								</div>

								<div
									*ngIf="application?.project_application_edam_terms?.length > 10"
									class="alert alert-warning"
									role="alert"
								>
									You can at most choose 10 research topics for your project.
								</div>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-md-4 form-control-label" for="id_project_application_person_related_data"
								><strong>Person Related Data<i class="fa fa-asterisk" aria-hidden="true"></i></strong
							></label>
							<div class="col-md-8">
								<div class="form-check">
									<input
										class="form-check-input"
										type="checkbox"
										id="id_project_application_person_related_data"
										name="project_application_person_related_data"
										data-test-id="project_application_person_related_data_switch"
										#personalData
										[(ngModel)]="application.project_application_person_related_data"
										(click)="togglePersonalDataType(personalData.checked, 'person_related')"
									/>
									<span class="help-block" *ngIf="!personalData.checked">
										My project processes data of human subjects</span
									>
									<span class="help-block" *ngIf="personalData.checked">
										My project processes data of human subjects containing:</span
									>
								</div>
								<div class="form-check" *ngIf="personalData.checked">
									<div class="form-check">
										<input
											class="form-check-input"
											type="checkbox"
											id="id_project_application_no_personal_data"
											name="project_application_no_personal_data"
											#noPersonalData
											data-test-id="project_application_no_personal_data_switch"
											(click)="togglePersonalDataType(noPersonalData.checked, 'no_personal_data')"
											[(ngModel)]="application.project_application_no_personal_data"
										/>
										<span class="help-block">a) no personal data or sufficiently anonymized data only</span>
									</div>
									<div class="form-check">
										<input
											class="form-check-input"
											type="checkbox"
											id="id_project_application_nonsensitive_data"
											name="project_application_nonsensitive_data"
											#nonsensitiveData
											data-test-id="project_application_nonsensitive_data_switch"
											(click)="togglePersonalDataType(nonsensitiveData.checked, 'nonsensitive')"
											[(ngModel)]="application.project_application_nonsensitive_data"
										/>
										<span class="help-block"
											>b) personal data [Article 4 (1) GDPR] (e.g. name, e-mail, other online identifiers,
											geolocation)</span
										>
									</div>
									<div class="form-check">
										<input
											class="form-check-input"
											type="checkbox"
											id="id_project_application_sensitive_data"
											name="project_application_sensitive_data"
											#sensitiveData
											data-test-id="project_application_sensitive_switch"
											(click)="togglePersonalDataType(sensitiveData.checked, 'sensitive')"
											[(ngModel)]="application.project_application_sensitive_data"
										/>
										<span class="help-block"
											>c) sensitive personal data [Articles 4 (13,14,15), 9 GDPR and Recital 51] (e.g. racial or ethnic
											origin, political opinions, religious or philosophical beliefs, genetic data, biometric data,
											health data and other special categories of personal data)</span
										>
									</div>
								</div>
							</div>
						</div>

						<div class="form-group row">
							<label class="col-md-4"></label>
							<div class="col-md-8">
								<div class="alert alert-primary" role="alert" *ngIf="!personalData.checked">
									According to our usage policy it is not allowed to process person related data in the de.NBI Cloud
									with the exception that an additional agreement is made with the corresponding cloud site operator. If
									you want to process person related data please click on the checkbox!
								</div>
								<div class="alert alert-primary" role="alert" *ngIf="personalData.checked">
									Options b) and c) require that an additional agreement is made with the corresponding cloud site
									operator. They will contact you to gather the necessary details.<br />
									Data under option c) is only permitted to be processed in the following cases:<br />
									1. Subjects have given explicit consent (manifestly) for their data to be used publicly [<a
										class="alert-link"
										href="{{ GDPR_LINK }}"
										>Art. 9</a
									>
									(2e)]<br />
									2. Processing is necessary for reasons of substantial public interest [<a
										class="alert-link"
										href="{{ GDPR_LINK }}"
										>Art. 9</a
									>
									(2g)]<br />
									3. Processing is necessary for reasons of public interest in the area of public health [<a
										class="alert-link"
										href="{{ GDPR_LINK }}"
										>Art. 9</a
									>
									(2i)]<br />
									4. Processing is necessary for archiving purposes in the public interest, scientific or historic
									research purposes or statistical purposes [<a class="alert-link" href="{{ GDPR_LINK }}">Art. 9</a>
									(2j)]<br />
									Further information regarding the processing of sensitive data can be found on our
									<a class="alert-link" href="{{ WIKI_PERSONAL_DATA }}">Wiki</a>.
								</div>
							</div>
						</div>

						<div class="form-group row" *ngIf="openstack_project">
							<label class="col-md-4 form-control-label" for="id_project_application_openstack_basic_introduction"
								><strong>Training</strong></label
							>
							<div class="col-md-8">
								<div class="form-check">
									<input
										class="form-check-input"
										type="checkbox"
										[ngClass]="{ 'ng-valid': application.project_application_openstack_basic_introduction }"
										id="id_project_application_openstack_basic_introduction"
										name="project_application_openstack_basic_introduction"
										[(ngModel)]="application.project_application_openstack_basic_introduction"
									/>
									<label class="help-block"
										>Are you interested in a short OpenStack introduction workshop? You and your project members will be
										notified as soon as a workshop is organized.</label
									>
								</div>
							</div>
						</div>

						<div class="form-group row" *ngIf="openstack_project">
							<label class="col-md-4 form-control-label" for="id_project_application_cloud_service"
								><strong>Service</strong></label
							>
							<div class="col-md-8">
								<div class="form-check">
									<input
										class="form-check-input"
										type="checkbox"
										id="id_project_application_cloud_service"
										name="project_application_cloud_service"
										[defaultChecked]="
											application?.project_application_cloud_service_user_number > 0 ||
											application?.project_application_cloud_service_develop
										"
										[(ngModel)]="application.project_application_cloud_service"
									/>
									<label class="help-block">Do you plan to offer a service?</label>
								</div>
							</div>
						</div>

						<div class="form-group row" *ngIf="application?.project_application_cloud_service">
							<label class="col-md-4 form-control-label" for="id_project_application_cloud_service_develop"
								><strong>New service*</strong></label
							>
							<div class="col-md-8">
								<div class="form-check">
									<input
										class="form-check-input"
										type="checkbox"
										id="id_project_application_cloud_service_develop"
										name="project_application_cloud_service_develop"
										[defaultChecked]="
											application?.project_application_cloud_service_user_number > 0 ||
											application?.project_application_cloud_service
										"
										[(ngModel)]="application.project_application_cloud_service_develop"
									/>
									<label class="help-block"> Are you developing a new service? </label>
								</div>
								<div class="alert alert-primary" role="alert">
									<strong>Note:</strong> if you plan to offer an existing service, please set this switch to No.
								</div>
							</div>
						</div>

						<div
							class="form-group row"
							*ngIf="
								!application?.project_application_cloud_service_develop &&
								application?.project_application_cloud_service
							"
						>
							<label class="col-md-4 form-control-label" for="id_project_application_cloud_service_user_number"
								><strong>Number of service users*</strong></label
							>
							<div class="col-md-8">
								<div class="input-group">
									<input
										required
										class="form-control"
										id="id_project_application_cloud_service_user_number"
										name="project_application_cloud_service_user_number"
										placeholder="e.g. 200"
										type="number"
										min="1"
										step="1"
										appMinAmount="1"
										appInteger
										[(ngModel)]="application.project_application_cloud_service_user_number"
										[ngClass]="{
											'is-invalid': form.controls.project_application_cloud_service_user_number?.invalid,
											'is-valid': form.controls.project_application_cloud_service_user_number?.valid
										}"
									/>
								</div>
								<span class="help-block"
									>How many service users will probably use your service?
									<br />
									<strong>Note:</strong> we define service users as <strong>unique users per month.</strong></span
								>
							</div>
						</div>

						<div class="form-group row">
							<label class="col-md-4 form-control-label" for="id_project_application_horizon_switch"
								><strong>Horizon 2020</strong></label
							>
							<div class="col-md-8">
								<div class="form-check">
									<input
										class="form-check-input"
										type="checkbox"
										id="id_project_application_horizon_switch"
										data-test-id="project_application_horizon_switch"
										#part_horizon
										[defaultChecked]="application?.project_application_horizon2020?.length > 1"
										(click)="toggleProjectPart(part_horizon.checked, 'horizon')"
									/>
									<span class="help-block">Is your project part of a Horizon 2020 project?</span>
								</div>

								<input
									type="text"
									id="id_project_application_horizon2020"
									*ngIf="part_horizon.checked"
									name="project_application_horizon2020"
									class="form-control"
									data-test-id="project_application_horizon2020_input"
									maxlength="2048"
									required
									minlength="2"
									[ngClass]="{
										'is-invalid': form.controls.project_application_horizon2020?.invalid,
										'is-valid': form.controls.project_application_horizon2020?.valid
									}"
									[(ngModel)]="application.project_application_horizon2020"
									placeholder="Name of the project"
								/>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-md-4 form-control-label" for="id_project_application_elixir_switch"
								><strong>Elixir Project</strong></label
							>
							<div class="col-md-8">
								<div class="form-check">
									<input
										class="form-check-input"
										type="checkbox"
										data-test-id="project_application_elixir_switch"
										id="id_project_application_elixir_switch"
										#part_elixir
										[defaultChecked]="application?.project_application_elixir_project?.length > 1"
										(click)="toggleProjectPart(part_elixir.checked, 'elixir')"
									/>
									<span class="help-block">Is your project part of an Elixir project?</span>
								</div>
								<input
									type="text"
									id="id_project_application_elixir_project"
									*ngIf="part_elixir.checked"
									data-test-id="project_application_elixir_project_input"
									name="project_application_elixir_project"
									class="form-control"
									maxlength="2048"
									required
									minlength="2"
									[ngClass]="{
										'is-invalid': form.controls.project_application_elixir_project?.invalid,
										'is-valid': form.controls.project_application_elixir_project?.valid
									}"
									[(ngModel)]="application.project_application_elixir_project"
									placeholder="Name of the project"
								/>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-md-4 form-control-label" for="id_project_application_dfg_switch"
								><strong>DFG</strong></label
							>
							<div class="col-md-8">
								<div class="form-check">
									<input
										class="form-check-input"
										type="checkbox"
										id="id_project_application_dfg_switch"
										#part_dfg
										[defaultChecked]="application?.project_application_dfg?.length > 1"
										(click)="toggleProjectPart(part_dfg.checked, 'dfg')"
									/>
									<span class="help-block">Is your project part of a DFG project?</span>
								</div>

								<input
									type="text"
									id="id_project_application_dfg"
									*ngIf="part_dfg.checked"
									name="project_application_dfg"
									class="form-control"
									maxlength="2048"
									required
									minlength="2"
									[ngClass]="{
										'is-invalid': form.controls.project_application_dfg?.invalid,
										'is-valid': form.controls.project_application_dfg?.valid
									}"
									[(ngModel)]="application.project_application_dfg"
									placeholder="Name of the project"
								/>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-md-4 form-control-label" for="id_project_application_bmbf_switch"
								><strong>BMBF</strong></label
							>
							<div class="col-md-8">
								<div class="form-check">
									<input
										class="form-check-input"
										type="checkbox"
										data-test-id="project_application_bmbf_switch"
										id="id_project_application_bmbf_switch"
										#part_bmbf
										[defaultChecked]="application?.project_application_bmbf_project?.length > 1"
										(click)="toggleProjectPart(part_bmbf.checked, 'bmbf')"
									/>
									<span class="help-block">Is your project part of a BMBF project?</span>
								</div>

								<input
									type="text"
									id="id_project_application_bmbf_project"
									*ngIf="part_bmbf.checked"
									name="project_application_bmbf_project"
									class="form-control"
									data-test-id="project_application_bmbf_project-input"
									maxlength="2048"
									required
									minlength="2"
									[ngClass]="{
										'is-invalid': form.controls.project_application_bmbf_project?.invalid,
										'is-valid': form.controls.project_application_bmbf_project?.valid
									}"
									[(ngModel)]="application.project_application_bmbf_project"
									placeholder="Name of the project"
								/>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-md-4 form-control-label" for="id_project_application_bmbf_switch"
								><strong>NFDI</strong></label
							>
							<div class="col-md-8">
								<div class="form-check">
									<input
										class="form-check-input"
										type="checkbox"
										#part_nfdi
										id="id_project_application_nfdi_switch"
										[defaultChecked]="application?.project_application_nfdi?.length > 1"
										(click)="toggleProjectPart(part_nfdi.checked, 'nfdi')"
									/>
									<span class="help-block">Is your project part of a NFDI project?</span>
								</div>
								<input
									type="text"
									id="id_project_application_nfdi_project"
									*ngIf="part_nfdi.checked"
									name="project_application_nfdi_project"
									class="form-control"
									maxlength="2048"
									required
									minlength="2"
									[ngClass]="{
										'is-invalid': form.controls.project_application_nfdi?.invalid,
										'is-valid': form.controls.project_application_nfdi?.valid
									}"
									[(ngModel)]="application.project_application_nfdi"
									placeholder="Name of the project"
								/>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-md-4 form-control-label" for="id_project_application_report_allowed"
								><strong>Dissemination</strong></label
							>
							<div class="col-md-8">
								<div class="form-check">
									<input
										class="form-check-input"
										type="checkbox"
										name="project_application_report_allowed"
										id="id_project_application_report_allowed"
										data-test-id="project_application_report_allowed_switch"
										[(ngModel)]="application.project_application_report_allowed"
									/>
									<span class="help-block">
										Do you permit the de.NBI Cloud to publicly mention your project's participation?</span
									>
								</div>
							</div>
						</div>
						<div *ngIf="application?.project_application_report_allowed">
							<div class="form-group row col-md-12">
								<div class="alert alert-primary col-md-auto">
									<span
										>Please specify which information about your project and which platforms may be used to publish
										information. Select or deselect options by enabling or disabling the switches within the fields
										below. To do this, open the Dissemination Options. If publication is permitted, at least the title
										(or optionally a public title) and at least one platform must be selected.</span
									>
								</div>
							</div>

							<accordion>
								<accordion-group
									[isOpen]="dissemination_information_open"
									id="dissemination_information_accordion"
									#dissemination_information_accordion
								>
									<div accordion-heading style="width: 100%; cursor: pointer">
										Dissemination Options
										<i
											class="pull-right float-right"
											style="font-size: 25px"
											[ngClass]="{
												'icon-arrow-up': dissemination_information_accordion.isOpen,
												'icon-arrow-down': !dissemination_information_accordion.isOpen
											}"
										></i>
									</div>

									<div class="form-group row">
										<div class="col-md-4">
											<h6><strong>Type of Information</strong></h6>
										</div>
									</div>
									<div class="form-group row">
										<label class="col-md-4 form-control-label"><strong>All</strong></label>
										<div class="col-md-2">
											<div class="form-check">
												<input
													class="form-check-input"
													type="checkbox"
													name="information_all"
													[(ngModel)]="all_dissemination_checked"
													(ngModelChange)="onAllDissChange($event)"
												/>
											</div>
										</div>
									</div>

									<div class="form-group row">
										<label class="col-md-4 form-control-label">Project Title</label>
										<div class="col-md-2">
											<div class="form-check">
												<input type="checkbox" class="form-check-input" name="information_title" checked disabled />
											</div>
										</div>

										<div class="col-md-6">
											<input
												type="text"
												class="form-control"
												name="information_public_title_input"
												maxlength="512"
												data-test-id="information_public_title_input"
												placeholder="Choose a public title - Leave blank for existing title."
												[(ngModel)]="application.dissemination.information_title"
											/>
										</div>
									</div>
									<div class="form-group row">
										<label class="col-md-4 form-control-label">Research Topics</label>
										<div class="col-md-2">
											<div class="form-check">
												<input
													type="checkbox"
													class="form-check-input"
													name="information_edam_terms"
													checked
													disabled
												/>
											</div>
										</div>
										<div class="col-md-6">
											<h5>
												<span
													*ngFor="let term of application?.project_application_edam_terms"
													style="margin-right: 5px"
													class="badge bg-info"
												>
													{{ term.term }}
												</span>
											</h5>
										</div>
									</div>

									<div class="form-group row">
										<label class="col-md-4 form-control-label">Description</label>
										<div class="col-md-2">
											<div class="form-check">
												<input
													type="checkbox"
													class="form-check-input"
													id="public_description_enabled"
													data-test-id="public_description_enabled_switch"
													[(ngModel)]="application.dissemination.information_description_allowed"
													name="information_description_allowed"
												/>
											</div>
										</div>
										<div *ngIf="application?.dissemination.information_description_allowed" class="col-md-6">
											<textarea
												type="text"
												class="form-control"
												maxlength="8192"
												placeholder="Enter public description. Leave blank for existing description."
												name="information_description"
												data-test-id="information_description_input"
												[(ngModel)]="application.dissemination.information_description"
											></textarea>
										</div>
									</div>
									<div class="form-group row">
										<label class="col-md-4 form-control-label">Resources</label>
										<div class="col-md-4">
											<div class="form-check">
												<input
													type="checkbox"
													class="form-check-input"
													name="information_resources"
													id="information_resources_checkbox"
													data-test-id="information_resources_checkbox"
													[(ngModel)]="application.dissemination.information_resources"
												/>
											</div>
										</div>
									</div>

									<div class="form-group row">
										<label class="col-md-4 form-control-label">Lifetime</label>
										<div class="col-md-4">
											<div class="form-check">
												<input
													type="checkbox"
													class="form-check-input"
													name="information_lifetime"
													id="information_lifetime_checkbox"
													data-test-id="information_lifetime_checkbox"
													[(ngModel)]="application.dissemination.information_lifetime"
												/>
											</div>
										</div>
									</div>

									<div class="form-group row">
										<label class="col-md-4 form-control-label">Project Type</label>
										<div class="col-md-4">
											<div class="form-check">
												<input
													type="checkbox"
													class="form-check-input"
													name="information_project_type"
													data-test-id="information_project_type_checkbox"
													id="information_project_type_checkbox"
													[(ngModel)]="application.dissemination.information_project_type"
												/>
											</div>
										</div>
									</div>

									<div class="form-group row">
										<label class="col-md-4 form-control-label">Name of PI</label>
										<div class="col-md-4">
											<div class="form-check">
												<input
													type="checkbox"
													class="form-check-input"
													name="information_pi_name"
													id="information_pi_name_checkbox"
													data-test-id="information_pi_name_checkbox"
													[(ngModel)]="application.dissemination.information_pi_name"
												/>
											</div>
										</div>
									</div>

									<div class="form-group row">
										<label class="col-md-4 form-control-label">Institution</label>
										<div class="col-md-4">
											<div class="form-check">
												<input
													type="checkbox"
													class="form-check-input"
													name="information_institution"
													id="information_institution_checkbox"
													data-test-id="information_institution_checkbox"
													[(ngModel)]="application.dissemination.information_institution"
												/>
											</div>
										</div>
									</div>

									<div class="form-group row">
										<label class="col-md-4 form-control-label">Workgroup</label>
										<div class="col-md-4">
											<div class="form-check">
												<input
													type="checkbox"
													class="form-check-input"
													name="information_workgroup"
													id="information_workgroup_checkbox"
													data-test-id="information_workgroup_checkbox"
													[(ngModel)]="application.dissemination.information_workgroup"
												/>
											</div>
										</div>
									</div>

									<div class="form-group row">
										<label class="col-md-4 form-control-label">Project Affiliation</label>
										<div class="col-md-4">
											<div class="form-check">
												<input
													type="checkbox"
													class="form-check-input"
													name="information_project_affiliation"
													id="information_project_affiliation_checkbox"
													data-test-id="information_project_affiliation_checkbox"
													[(ngModel)]="application.dissemination.information_project_affiliation"
												/>
											</div>
										</div>
									</div>

									<hr class="my-4" />

									<div class="form-group row">
										<div class="col-md-4">
											<h6><strong>Platforms</strong></h6>
										</div>
									</div>

									<div
										class="alert-danger alert"
										*ngIf="
											!application?.dissemination?.isPlatformSelected() &&
											application?.project_application_report_allowed
										"
									>
										Please select at least one Platform.
									</div>
									<div class="form-group row">
										<label class="col-md-4 form-control-label">de.NBI Platforms</label>
										<div class="col-md-4">
											<div class="form-check">
												<input
													type="checkbox"
													class="form-check-input"
													id="platform_denbi_checkbox"
													data-test-id="platform_denbi_checkbox"
													[(ngModel)]="application.dissemination.platform_denbi"
													name="platform_denbi"
												/>
											</div>
										</div>
									</div>

									<div class="form-group row">
										<label class="col-md-4 form-control-label">Twitter</label>
										<div class="col-md-4">
											<div class="form-check">
												<input
													type="checkbox"
													class="form-check-input"
													#twitter
													id="platform_twitter_checkbox"
													data-test-id="platform_twitter_checkbox"
													[(ngModel)]="application.dissemination.platform_twitter"
													name="platform_twitter"
													(change)="count_platform(twitter.checked)"
												/>
											</div>
										</div>
									</div>
								</accordion-group>
							</accordion>
						</div>

						<div class="form-group row" *ngIf="!is_validation">
							<label class="col-md-4 form-control-label"
								><strong
									>Principal Investigator<i class="fa fa-asterisk" aria-hidden="true"></i>
									<i
										data-balloon="Only applications which have been approved/submitted by an principal investigator will be accepted. If you are not a principal investigator please provide their email."
										data-balloon-pos="right"
										data-balloon-length="large"
										><i class="icon-question menu_links" style="cursor: pointer"></i></i></strong
							></label>
							<div class="col-md-8">
								<div class="form-check">
									<input
										type="checkbox"
										class="form-check-input"
										id="project_application_pi_approved_checkbox"
										data-test-id="project_application_pi_approved_checkbox"
										[(ngModel)]="application.project_application_pi_approved"
										name="project_application_pi_approved"
									/>
									<span class="help-block"> Are you a principal investigator?</span><br />
									<a
										href="{{ WIKI_PRINCIPAL_INVESTIGATOR }}"
										target="_blank"
										style="text-decoration: none; font-weight: bold"
										>What is a principal investigator?</a
									>
								</div>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-md-4 form-control-label"
								><strong
									>Link to PI verification
									<i
										data-balloon="It is possible to provide a link to verifies the PI status of the stated PI"
										data-balloon-pos="right"
										data-balloon-length="large"
										><i class="icon-question menu_links" style="cursor: pointer"></i></i></strong
							></label>
							<div class="col-md-8">
								<input
									type="text"
									id="project_application_pi_link_input"
									class="form-control"
									maxlength="256"
									data-test-id="project_application_pi_link_input"
									placeholder="https://www.uni-bielefeld.de/einrichtungen/cebitec/forschung/arbeitsgruppen/arbeitsgruppe-12/"
									name="project_application_pi_link_input"
									[(ngModel)]="application.project_application_pi_link"
									pattern="^https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_\+.~#?&\/=]*)$"
									[ngClass]="{
										'is-invalid':
											form.controls.project_application_pi_link_input?.invalid &&
											(form.controls.project_application_pi_link_input?.dirty ||
												form.controls.project_application_pi_link_input?.touched) &&
											application.project_application_pi_link !== '',
										'is-valid':
											(form.controls.project_application_pi_link_input?.valid ||
												application.project_application_pi_link === '') &&
											(form.controls.project_application_pi_link_input?.dirty ||
												form.controls.project_application_pi_link_input?.touched)
									}"
								/>
								<span class="help-block"> </span>Provide a link to the institute or workgroup website of the PI<br />
							</div>
						</div>
						<div class="row">
							<div class="col-md-4"></div>
							<div class="col-md-8">
								<div class="alert alert-info">
									<strong
										>Please provide a link here to a page showing that the PI you have specified is the head of the
										specified institute or working group.</strong
									>
									This speeds up the application process tremendously.
								</div>
							</div>
						</div>

						<div *ngIf="application?.project_application_pi_approved" class="form-group row">
							<label
								class="col-md-4 form-control-label"
								for="project_application_responsibility"
								id="project_application_responsibility_checkbox"
							>
								<strong>Confirmation of Responsibility*</strong>
							</label>
							<div class="form-check col-md-8">
								<input
									class="form-check-input"
									name="project_application_responsibility"
									data-test-id="project_application_responsibility_checkbox"
									type="checkbox"
									id="project_application_responsibility_no_validation"
									data-test-id="project_application_responsibility_checkbox_no_validation"
									[(ngModel)]="pi_responsibility_checked"
									required
								/>
								<label class="form-check-label" for="project_application_responsibility">
									I hereby confirm that I am responsible for the project and any action of the project members in the
									de.NBI Cloud.
								</label>
							</div>
							<div *ngIf="pi_responsibility_checked && !valid_pi_affiliations" class="row justify-content-center">
								<div class="col-md-8">
									<div
										class="alert"
										[ngClass]="{
											'alert-warning': !unknownPiAffiliationsConfirmation,
											'alert-success': unknownPiAffiliationsConfirmation
										}"
									>
										<p>
											According to the current session information of your LifeScience<span
												title="Authentication and Authorization Infrastructure"
												style="text-decoration: underline dotted; cursor: help"
												>AAI</span
											>
											account, we were unable to confirm your association with a university or research institute.<br />
											Your affiliations are:
										</p>
										<ul>
											<li *ngFor="let affiliation of userinfo?.Affiliations">{{ affiliation }}</li>
										</ul>
										<p>
											We kindly ask you to verify whether your account is already linked with a university or research
											institute via the LifeScienceAAI <a href="{{ LIFESCIENCE_LINKING_ACCOUNTS }}">profile page</a> to
											speed up the approval process for both the current and future applications. If your account is
											already listed as being associated with a university or research institution on your profile page,
											no further action is necessary. If this is not the case, we recommend that you try to link your
											account via your LifeScienceAAI profile page. This can also be done after the confirmation of your
											project application. If you can not link your account, we will need to verify your principal
											investigator status manually, which can prolong the approval process.
										</p>
										<div class="form-check my-3">
											<input
												class="form-check-input"
												type="checkbox"
												id="id-unknown-pi-affiliations-checkbox"
												name="unknown-pi-affiliations-checkbox"
												data-test-id="unknown-pi-affiliations-checkbox"
												[(ngModel)]="unknownPiAffiliationsConfirmation"
											/>
											<label class="form-check-label font-weight-bold" for="id-unknown-pi-affiliations-checkbox"
												>I have read and understood the information in the box above.</label
											>
										</div>
										<p>
											<a
												href="{{ WIKI_LINKING_ACCOUNTS }}"
												target="_blank"
												style="text-decoration: none; font-weight: bold"
												rel="noopener noreferrer"
												>How to link your account with other identities?</a
											>
										</p>
									</div>
								</div>
							</div>
						</div>
						<div
							*ngIf="!application?.project_application_pi_approved && !is_validation"
							class="form-group row justify-content-center"
						>
							<div class="col-md-4"></div>
							<div class="col-md-8">
								<div class="alert alert-primary">
									Only applications approved by a principal investigator of a german university or research facility
									will be accepted. You are able to enter an email address of your principal investigator whom we will
									send an email, containing your name and email address and a link informing them about the requested
									resources, where they will be able to approve this application.
								</div>
							</div>
							<div class="col-md-4"></div>
						</div>
						<div *ngIf="!application?.project_application_pi_approved && !is_validation" class="form-group row">
							<label class="col-md-4 form-control-label" for="id_project_application_pi_email"
								><strong>Principal Investigator Email<i class="fa fa-asterisk" aria-hidden="true"></i> </strong
							></label>
							<div class="col-md-8">
								<input
									*ngIf="!application?.project_application_pi_approved && !is_validation"
									required
									type="text"
									id="id_project_application_pi_email"
									name="project_application_pi_email"
									class="form-control"
									maxlength="256"
									data-test-id="project_application_pi_email_input"
									placeholder="example@domain.com"
									[(ngModel)]="application.project_application_pi.email"
									pattern="(?!(^[.-].*|[^@]*[.-]@|.*\.{2,}.*)|^.{254}.)([a-zA-Z0-9!#$%&'*+\/=?^_`{|}~.-]+@)(?!-.*|.*-\.)([a-zA-Z0-9-]{1,63}\.)+[a-zA-Z]{2,15}"
									[ngClass]="{
										'is-invalid':
											form.controls.project_application_pi_email?.invalid &&
											(form.controls.project_application_pi_email?.dirty ||
												form.controls.project_application_pi_email?.touched),
										'is-valid':
											form.controls.project_application_pi_email?.valid &&
											(form.controls.project_application_pi_email?.dirty ||
												form.controls.project_application_pi_email?.touched)
									}"
								/>
								<p *ngIf="!application?.project_application_pi_approved && !is_validation">
									Please enter the e-mail address of your principal investigator. An email with further information on
									how to verify the application will be sent to this email.
								</p>
							</div>
						</div>
					</form>
					<div *ngIf="is_validation" class="row">
						<div class="col-4"></div>
						<div class="col-8 alert-warning">
							If you do not approve of this application, please contact
							<a href="mailto:{{ CLOUD_PORTAL_SUPPORT_MAIL }}">{{ CLOUD_PORTAL_SUPPORT_MAIL }}</a>
						</div>
					</div>
				</div>
				<div class="card-footer">
					<div
						*ngIf="application?.flavors.length === 0 && !application?.project_application_openstack_project"
						class="form-group row alert alert-danger"
					>
						Please select at least one flavor.
					</div>
					<div
						*ngIf="
							form.invalid ||
							application?.project_application_edam_terms.length === 0 ||
							application?.project_application_edam_terms.length > 10 ||
							(application?.flavors.length === 0 && !application?.project_application_openstack_project) ||
							(!application?.dissemination.isPlatformSelected() && application?.project_application_report_allowed)
						"
						class="form-group row"
					>
						<div class="alert alert warning">
							Some required fields are incorrect or not filled in yet. Please check if all required (
							<i class="fa fa-asterisk" aria-hidden="true"></i>) fields are filled in correctly.
						</div>
					</div>
					<div class="form-group row" *ngIf="!is_validation">
						<p class="col-md-12 form-control-label">
							By submitting this application you agree to the
							<a [href]="POLICY_LINK" target="_blank">cloud usage policy</a>.
						</p>
					</div>
					<div *ngIf="is_validation" class="form-group row">
						<label class="col-md-4 form-control-label" for="project_application_responsibility">
							<strong>Confirmation of Responsibility<i class="fa fa-asterisk" aria-hidden="true"></i> </strong>
						</label>
						<div class="col-md-8">
							<div class="form-check">
								<input
									#respCheck
									class="form-check-input"
									id="project_application_responsibility"
									name="project_application_responsibility"
									[(ngModel)]="pi_responsibility_checked"
									required
									type="checkbox"
								/>
								<label class="form-check-label" for="project_application_responsibility">
									I hereby confirm that I am responsible for the project and any action of the project members in the
									de.NBI Cloud.
								</label>
							</div>
						</div>
						<div *ngIf="pi_responsibility_checked && !valid_pi_affiliations" class="row justify-content-center">
							<div
								class="col-md-8 alert"
								[ngClass]="{
									'alert-warning': !unknownPiAffiliationsConfirmation,
									'alert-success': unknownPiAffiliationsConfirmation
								}"
							>
								<p>
									According to the current session information of your LifeScience<span
										title="Authentication and Authorization Infrastructure"
										>AAI</span
									>
									account, we were unable to confirm your association with a university or research institute.<br />
									Your affiliations are:
								</p>
								<ul>
									<li *ngFor="let affiliation of userinfo?.Affiliations">{{ affiliation }}</li>
								</ul>
								<p>
									We kindly ask you to verify whether your account is already linked with a university or research
									institute via the LifeScienceAAI <a href="{{ LIFESCIENCE_LINKING_ACCOUNTS }}">profile page</a> to
									speed up the approval process for both the current and future applications. If your account is already
									listed as being associated with a university or research institution on your profile page, no further
									action is necessary. If this is not the case, we recommend that you try to link your account via your
									LifeScienceAAI profile page. This can also be done after the confirmation of your project application.
									If you can not link your account, we will need to verify your principal investigator status manually,
									which can prolong the approval process.
								</p>
								<div class="form-check my-3">
									<input
										class="form-check-input"
										type="checkbox"
										id="unknown-pi-affiliations-checkbox"
										name="unknown-pi-affiliations-checkbox"
										data-test-id="project_application_responsibility_checkbox"
										[(ngModel)]="unknownPiAffiliationsConfirmation"
									/>
									<label class="form-check-label font-weight-bold" for="id-unknown-pi-affiliations-checkbox"
										>I have read and understood the information in the box above.</label
									>
								</div>
								<p>
									<a
										href="{{ WIKI_LINKING_ACCOUNTS }}"
										target="_blank"
										rel="noopener noreferrer"
										style="text-decoration: none; font-weight: bold"
										>How to link your account with other identities?</a
									>
								</p>
							</div>
						</div>

						<label class="col-md-4 form-control-label">
							<button
								(click)="notificationModal.show(); approveApplication(form)"
								[disabled]="
									!pi_responsibility_checked ||
									(!unknownPiAffiliationsConfirmation && !valid_pi_affiliations) ||
									form.invalid ||
									application?.project_application_edam_terms.length === 0 ||
									application?.project_application_edam_terms.length > 10 ||
									(application?.flavors.length === 0 && !application?.project_application_openstack_project) ||
									(!application?.dissemination?.isPlatformSelected() && application?.project_application_report_allowed)
								"
								id="approveApplicationButtonPI"
								class="btn btn-sm btn-success"
							>
								<i class="far fa-dot-circle"></i>
								Approve Application
							</button>
						</label>
					</div>
					<div>
						<button
							*ngIf="!is_validation"
							(click)="calculateInitialCredits(form); submitModal.show()"
							id="submit_btn"
							data-test-id="submit_application_btn"
							[disabled]="
								submitting ||
								form.invalid ||
								(!unknownPiAffiliationsConfirmation &&
									!valid_pi_affiliations &&
									application?.project_application_pi_approved &&
									!is_validation) ||
								(!application?.project_application_comment && extraResourceCommentRequired) ||
								application?.project_application_edam_terms.length === 0 ||
								application?.project_application_edam_terms.length > 10 ||
								(application?.flavors.length === 0 && !application?.project_application_openstack_project) ||
								(!application?.dissemination?.isPlatformSelected() &&
									application?.project_application_report_allowed) ||
								!checkValidityComment()
							"
							class="btn btn-sm btn-success"
							type="button"
						>
							<i class="far fa-dot-circle"></i> Submit Application
						</button>
					</div>
				</div>
			</div>
		</div>
		<!--/.col-->
	</div>
</div>

<div
	bsModal
	#notificationModal="bs-modal"
	class="modal fade"
	tabindex="-1"
	role="dialog"
	aria-labelledby="Label"
	aria-hidden="true"
>
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">{{ notificationModalTitle }}</h4>
				<button
					type="button"
					class="close"
					style="cursor: pointer"
					(click)="notificationModal.hide()"
					aria-label="Close"
				>
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div
					class="alert alert-{{ notificationModalType }}"
					id="notification_message"
					data-test-id="notification_message"
					role="alert"
				>
					{{ notificationModalMessage }}
				</div>
				<div class="alert alert-primary" id="survey" role="alert" *ngIf="survey_link_visible">
					We are very interested in making the application process understandable, clear and easy to complete, so we
					would appreciate it if you would fill out this short anonymous survey:<br />
					<a [href]="SURVEY_LINK" target="_blank">Application Process Survey</a>
				</div>
			</div>
			<div class="modal-footer">
				<button
					id="notification_btn_redirect"
					*ngIf="notificationModalIsClosable === true && notificationModalStay === true"
					type="button"
					(click)="notificationModal.hide(); resetNotificationModal()"
					class="btn btn-secondary"
				>
					Close
				</button>
				<a
					*ngIf="notificationModalIsClosable === true && notificationModalStay === false"
					[routerLink]="['/project-management/' + application_id]"
				>
					<button
						type="button"
						id="notification_btn_redirect"
						(click)="notificationModal.hide(); resetNotificationModal()"
						class="btn btn-secondary"
					>
						Close
					</button>
				</a>
			</div>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div
	bsModal
	#acknowledgemodal="bs-modal"
	class="modal fade"
	tabindex="-1"
	role="dialog"
	aria-labelledby="Label"
	aria-hidden="true"
>
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">{{ acknowledgeModalTitle }}</h4>
				<button
					type="button"
					class="close"
					style="cursor: pointer"
					(click)="acknowledgemodal.hide()"
					aria-label="Close"
				>
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="alert alert-{{ acknowledgeModalType }}" role="alert">
					The development and support of the cloud is possible above all through the funding of the cloud infrastructure
					by the Federal Ministry of Education and Research (BMBF)! We would highly appreciate the following citation in
					your next publication(s): This work was supported by the BMBF-funded de.NBI Cloud within the German Network
					for Bioinformatics Infrastructure (de.NBI) (031A537B, 031A533A, 031A538A, 031A533B, 031A535A, 031A537C,
					031A534A, 031A532B).
				</div>
			</div>
			<div class="modal-footer">
				<button
					id="acknowledge_approve_btn"
					type="button"
					data-test-id="acknowledge_approve_btn"
					(click)="acknowledgemodal.hide(); onSubmit(); notificationModal.show()"
					class="btn btn-success"
					name="_save"
					form="application_form"
				>
					Accept
				</button>

				<button type="button" (click)="acknowledgemodal.hide()" class="btn btn-danger">Close</button>
			</div>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div
	bsModal
	#submitModal="bs-modal"
	class="modal fade"
	tabindex="-1"
	role="dialog"
	aria-labelledby="Label"
	aria-hidden="true"
>
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">{{ projectName }}</h4>
				<button
					type="button"
					class="close"
					style="cursor: pointer"
					(click)="submitModal.hide()"
					data-dismiss="modal"
					aria-label="Close"
				>
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="alert alert-primary">
					<strong>Please check the data you have entered and confirm your application below.</strong><br />
					If the entered data mismatches with your requirements cancel this confirmation and take changes.
				</div>
				<div class="table-responsive">
					<table class="table table-striped">
						<tr>
							<td><strong>Project Information</strong></td>
						</tr>
						<tr>
							<td>Shortname: {{ application?.project_application_shortname }}</td>
						</tr>
						<tr>
							<td>Description: {{ application?.project_application_description }}</td>
						</tr>
						<tr>
							<td>
								Lifetime: {{ application?.project_application_lifetime }}
								<span *ngIf="application?.project_application_lifetime === 1">month</span
								><span *ngIf="application?.project_application_lifetime > 1">months</span>
							</td>
						</tr>
						<tr>
							<td>Institute: {{ application?.project_application_institute }}</td>
						</tr>
						<tr>
							<td>Workgroup: {{ application?.project_application_workgroup }}</td>
						</tr>
						<tr>
							<td>
								Research Topics:
								<span
									*ngFor="let topic of application?.project_application_edam_terms"
									class="badge bg-info"
									style="margin: 2px"
									>{{ topic.term }}</span
								>
							</td>
						</tr>
						<tr>
							<td>
								Workshop planed: <span *ngIf="application?.project_application_workshop">Yes</span
								><span *ngIf="!application?.project_application_workshop">No</span>
							</td>
						</tr>
						<ng-container *ngIf="application?.project_application_openstack_project">
							<tr>
								<td>
									Service:
									<span
										*ngIf="
											application?.project_application_cloud_service &&
											!application?.project_application_cloud_service_develop
										"
										>Existing: {{ application?.project_application_cloud_service_user_number }} unique users per
										month</span
									>
									<span
										*ngIf="
											application?.project_application_cloud_service &&
											application?.project_application_cloud_service_develop
										"
										>In development</span
									>
								</td>
							</tr>
						</ng-container>
						<tr *ngIf="application?.project_application_openstack_project">
							<td>
								OpenStack Basic Introduction:
								<span *ngIf="application?.project_application_openstack_basic_introduction">Yes</span>
								<span *ngIf="!application?.project_application_openstack_basic_introduction">No</span>
							</td>
						</tr>

						<tr>
							<td>
								Dissemination Allowed: <span *ngIf="application?.dissemination?.someAllowed()">Yes</span
								><span *ngIf="!application?.dissemination.someAllowed()">No</span>
							</td>
						</tr>
						<tr *ngIf="application?.dissemination.someAllowed()">
							<td>
								- for:
								<span
									class="badge bg-info"
									style="margin: 2px"
									*ngFor="let information of application?.dissemination.allowed_informations"
									>{{ information }}</span
								>
							</td>
						</tr>
						<tr *ngIf="application?.dissemination.someAllowed()">
							<td>
								- on:
								<span
									class="badge bg-info"
									style="margin: 2px"
									*ngFor="let platform of application?.dissemination.allowed_platforms"
									>{{ platform }}</span
								>
							</td>
						</tr>
						<tr *ngIf="application?.project_application_comment">
							<td>Comment: {{ application?.project_application_comment }}</td>
						</tr>
						<tr>
							<td *ngIf="application?.project_application_person_related_data">Person Related Data: Yes</td>
							<td *ngIf="!application?.project_application_person_related_data">Person Related Data: No</td>
						</tr>
						<tr *ngIf="application?.project_application_person_related_data">
							<td *ngIf="application?.project_application_no_personal_data">No Personal Data (Anonymous): Yes</td>
							<td *ngIf="!application?.project_application_no_personal_data">No Personal Data (Anonymous): No</td>
						</tr>
						<tr *ngIf="application?.project_application_person_related_data">
							<td *ngIf="application?.project_application_nonsensitive_data">Nonsensitive Data: Yes</td>
							<td *ngIf="!application?.project_application_nonsensitive_data">Nonsensitive Data: No</td>
						</tr>
						<tr *ngIf="application?.project_application_person_related_data">
							<td *ngIf="application?.project_application_sensitive_data">Sensitive Data: Yes</td>
							<td *ngIf="!application?.project_application_sensitive_data">Sensitive Data: No</td>
						</tr>
						<ng-container
							*ngIf="
								application?.project_application_horizon2020 ||
								application?.project_application_elixir_project ||
								application?.project_application_bmbf_project ||
								application?.project_application_nfdi
							"
						>
							<tr>
								<td>
									Project Affiliations:
									<span class="badge bg-info" style="margin: 2px" *ngIf="application?.project_application_horizon2020">
										Horizon 2020: {{ application?.project_application_horizon2020 }}</span
									>
									<span
										class="badge bg-info"
										style="margin: 2px"
										*ngIf="application?.project_application_elixir_project"
									>
										Elixir Project: {{ application?.project_application_elixir_project }}</span
									>
									<span class="badge bg-info" style="margin: 2px" *ngIf="application?.project_application_bmbf_project">
										BMBF Project: {{ application?.project_application_bmbf_project }}</span
									>
									<span class="badge bg-info" style="margin: 2px" *ngIf="application?.project_application_nfdi">
										NFDI Project: {{ application?.project_application_nfdi }}</span
									>
								</td>
							</tr>
						</ng-container>

						<tr>
							<td><strong>Resources</strong></td>
						</tr>
						<ng-container *ngFor="let flavor of application?.flavors">
							<tr *ngIf="flavor.counter > 0">
								<td>{{ flavor.name }}: {{ flavor.counter }}</td>
							</tr>
						</ng-container>
						<tr>
							<td>Volumes: {{ application?.project_application_volume_counter }}</td>
						</tr>
						<tr *ngIf="application?.project_application_volume_counter > 0">
							<td>Volume Total Limit: {{ application?.project_application_volume_limit }} GBs</td>
						</tr>
						<tr *ngIf="application?.project_application_openstack_project">
							<td>Object Storage: {{ application?.project_application_object_storage }} GBs</td>
						</tr>
						<tr>
							<td>
								<strong
									>Initial Cloud Credits: {{ application?.project_application_initial_credits.toString() }}</strong
								>
								<br />
								<div class="alert alert-primary">
									We are slowly rolling out the implementation of Cloud Credits which assist in tracking resource usage.
									We show the initial Cloud Credits to all new project applications but will track the used Cloud
									Credits only for a few selected projects. If your project is one of the few selected projects, you
									will get an E-Mail notification which will contain more information on the goals, the implementation
									and the usage of Cloud Credits. In the case that you are already interested in learning more about
									Cloud Credits, please visit
									<a href="{{ CREDITS_WIKI }}" target="_blank" rel="noopener noreferrer">our Wiki page</a>.<br />
									This value is only an approximation. The final value may differ because some flavors have a different
									amount of resources depending on the facility in which your project will run.
								</div>
							</td>
						</tr>
						<tr>
							<td>
								<strong>Number of cores in total: {{ totalNumberOfCores.toString() }}</strong>
							</td>
						</tr>
						<tr>
							<td>
								<strong>Value of RAM in total: {{ totalRAM.toString() }} GBs</strong>
							</td>
						</tr>
						<tr
							*ngIf="
								!application?.project_application_pi_approved &&
								!is_validation &&
								application?.project_application_pi?.email
							"
						>
							<td>Principal Investigator Mail: {{ application?.project_application_pi?.email }}</td>
						</tr>
					</table>
				</div>
			</div>

			<div class="modal-footer">
				<button
					class="btn btn-success col-md4"
					type="button"
					id="verification_btn"
					data-test-id="verification_application_btn"
					(click)="acknowledgemodal.show(); submitModal.hide()"
				>
					Confirm Application
				</button>
				<button class="btn btn-warning col-md-4" type="reset" (click)="submitModal.hide()">Cancel</button>
			</div>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<!-- /.modal -->
